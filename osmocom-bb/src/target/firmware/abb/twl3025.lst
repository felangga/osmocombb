   1              		.file	"twl3025.c"
   9              	.Ltext0:
  10              		.global	twl3025_default_ramp
  11              		.section	.rodata
  12              		.align	1
  15              	twl3025_default_ramp:
  16 0000 0000     		.short	0
  17 0002 6001     		.short	352
  18 0004 E003     		.short	992
  19 0006 E003     		.short	992
  20 0008 E003     		.short	992
  21 000a 0003     		.short	768
  22 000c 0000     		.short	0
  23 000e 0000     		.short	0
  24 0010 0900     		.short	9
  25 0012 1200     		.short	18
  26 0014 1900     		.short	25
  27 0016 1F00     		.short	31
  28 0018 1E00     		.short	30
  29 001a 0F00     		.short	15
  30 001c 0000     		.short	0
  31 001e 0000     		.short	0
  32              		.section	.text.tpu_enq_at,"ax",%progbits
  33              		.align	2
  35              	tpu_enq_at:
  36              	.LFB5:
  37              		.file 1 "include/calypso/tpu.h"
   1:include/calypso/tpu.h **** #ifndef _CALYPSO_TPU_H
   2:include/calypso/tpu.h **** #define _CALYPSO_TPU_H
   3:include/calypso/tpu.h **** 
   4:include/calypso/tpu.h **** #define BITS_PER_TDMA		1250
   5:include/calypso/tpu.h **** #define QBITS_PER_TDMA		(BITS_PER_TDMA * 4)	/* 5000 */
   6:include/calypso/tpu.h **** #define TPU_RANGE		QBITS_PER_TDMA
   7:include/calypso/tpu.h **** #define	SWITCH_TIME		(TPU_RANGE-10)
   8:include/calypso/tpu.h **** 
   9:include/calypso/tpu.h **** /* Assert or de-assert TPU reset */
  10:include/calypso/tpu.h **** void tpu_reset(int active);
  11:include/calypso/tpu.h **** /* Enable or Disable a new scenario loaded into the TPU */
  12:include/calypso/tpu.h **** void tpu_enable(int active);
  13:include/calypso/tpu.h **** /* Enable or Disable the clock of the TPU Module */
  14:include/calypso/tpu.h **** void tpu_clk_enable(int active);
  15:include/calypso/tpu.h **** /* Enable Frame Interrupt generation on next frame.  DSP will reset it */
  16:include/calypso/tpu.h **** void tpu_dsp_frameirq_enable(void);
  17:include/calypso/tpu.h **** /* Is a Frame interrupt still pending for the DSP ? */
  18:include/calypso/tpu.h **** int tpu_dsp_fameirq_pending(void);
  19:include/calypso/tpu.h **** /* Rewind the TPU, i.e. restart enqueueing instructions at the base addr */
  20:include/calypso/tpu.h **** void tpu_rewind(void);
  21:include/calypso/tpu.h **** /* Enqueue a raw TPU instruction */
  22:include/calypso/tpu.h **** void tpu_enqueue(uint16_t instr);
  23:include/calypso/tpu.h **** /* Initialize TPU and TPU driver */
  24:include/calypso/tpu.h **** void tpu_init(void);
  25:include/calypso/tpu.h **** /* (Busy)Wait until TPU is idle */
  26:include/calypso/tpu.h **** void tpu_wait_idle(void);
  27:include/calypso/tpu.h **** /* Enable FRAME interrupt generation */
  28:include/calypso/tpu.h **** void tpu_frame_irq_en(int mcu, int dsp);
  29:include/calypso/tpu.h **** /* Force the generation of a DSP interrupt */
  30:include/calypso/tpu.h **** void tpu_force_dsp_frame_irq(void);
  31:include/calypso/tpu.h **** 
  32:include/calypso/tpu.h **** /* Get the current TPU SYNCHRO register */
  33:include/calypso/tpu.h **** uint16_t tpu_get_synchro(void);
  34:include/calypso/tpu.h **** /* Get the current TPU OFFSET register */
  35:include/calypso/tpu.h **** uint16_t tpu_get_offset(void);
  36:include/calypso/tpu.h **** 
  37:include/calypso/tpu.h **** enum tpu_instr {
  38:include/calypso/tpu.h **** 	TPU_INSTR_AT		= (1 << 13),
  39:include/calypso/tpu.h **** 	TPU_INSTR_OFFSET	= (2 << 13),
  40:include/calypso/tpu.h **** 	TPU_INSTR_SYNCHRO	= (3 << 13),	/* Loading delta synchro value in TPU synchro register */
  41:include/calypso/tpu.h **** 	TPU_INSTR_WAIT		= (5 << 13),	/* Wait a certain period (in GSM qbits) */
  42:include/calypso/tpu.h **** 	TPU_INSTR_SLEEP		= (0 << 13),	/* Stop the sequencer by disabling TPU ENABLE bit in ctrl reg */
  43:include/calypso/tpu.h **** 	/* data processing */
  44:include/calypso/tpu.h **** 	TPU_INSTR_MOVE		= (4 << 13),
  45:include/calypso/tpu.h **** };
  46:include/calypso/tpu.h **** 
  47:include/calypso/tpu.h **** /* Addresses internal to the TPU, only accessible via MOVE */
  48:include/calypso/tpu.h **** enum tpu_reg_int {
  49:include/calypso/tpu.h **** 	TPUI_TSP_CTRL1	= 0x00,
  50:include/calypso/tpu.h **** 	TPUI_TSP_CTRL2	= 0x01,
  51:include/calypso/tpu.h **** 	TPUI_TX_1	= 0x04,
  52:include/calypso/tpu.h **** 	TPUI_TX_2	= 0x03,
  53:include/calypso/tpu.h **** 	TPUI_TX_3	= 0x02,
  54:include/calypso/tpu.h **** 	TPUI_TX_4	= 0x05,
  55:include/calypso/tpu.h **** 	TPUI_TSP_ACT_L	= 0x06,
  56:include/calypso/tpu.h **** 	TPUI_TSP_ACT_U	= 0x07,
  57:include/calypso/tpu.h **** 	TPUI_TSP_SET1	= 0x09,
  58:include/calypso/tpu.h **** 	TPUI_TSP_SET2	= 0x0a,
  59:include/calypso/tpu.h **** 	TPUI_TSP_SET3	= 0x0b,
  60:include/calypso/tpu.h **** 	TPUI_DSP_INT_PG	= 0x10,
  61:include/calypso/tpu.h **** 	TPUI_GAUGING_EN = 0x11,
  62:include/calypso/tpu.h **** };
  63:include/calypso/tpu.h **** 
  64:include/calypso/tpu.h **** enum tpui_ctrl2_bits {
  65:include/calypso/tpu.h **** 	TPUI_CTRL2_RD		= (1 << 0),
  66:include/calypso/tpu.h **** 	TPUI_CTRL2_WR		= (1 << 1),
  67:include/calypso/tpu.h **** };
  68:include/calypso/tpu.h **** 
  69:include/calypso/tpu.h **** static inline uint16_t tpu_mod5000(int16_t time)
  70:include/calypso/tpu.h **** {
  71:include/calypso/tpu.h **** 	if (time < 0)
  72:include/calypso/tpu.h **** 		return time + 5000;
  73:include/calypso/tpu.h **** 	if (time >= 5000)
  74:include/calypso/tpu.h **** 		return time - 5000;
  75:include/calypso/tpu.h **** 	return time;
  76:include/calypso/tpu.h **** }
  77:include/calypso/tpu.h **** 
  78:include/calypso/tpu.h **** /* Enqueue a SLEEP operation (stop sequencer by disabling TPU ENABLE bit) */
  79:include/calypso/tpu.h **** static inline void tpu_enq_sleep(void)
  80:include/calypso/tpu.h **** {
  81:include/calypso/tpu.h **** 	tpu_enqueue(TPU_INSTR_SLEEP);
  82:include/calypso/tpu.h **** }
  83:include/calypso/tpu.h **** 
  84:include/calypso/tpu.h **** /* Enqueue a MOVE operation */
  85:include/calypso/tpu.h **** static inline void tpu_enq_move(uint8_t addr, uint8_t data)
  86:include/calypso/tpu.h **** {
  87:include/calypso/tpu.h **** 	tpu_enqueue(TPU_INSTR_MOVE | (data << 5) | (addr & 0x1f));
  88:include/calypso/tpu.h **** }
  89:include/calypso/tpu.h **** 
  90:include/calypso/tpu.h **** /* Enqueue an AT operation */
  91:include/calypso/tpu.h **** static inline void tpu_enq_at(int16_t time)
  92:include/calypso/tpu.h **** {
  38              		.loc 1 92 0
  39              		@ args = 0, pretend = 0, frame = 0
  40              		@ frame_needed = 0, uses_anonymous_args = 0
  41              		@ link register save eliminated.
  42              	.LVL0:
  43 0000 0008A0E1 		mov	r0, r0, asl #16
  44              	.LVL1:
  45 0004 2028A0E1 		mov	r2, r0, lsr #16
  46              	.LVL2:
  47              	.LBB2:
  48              	.LBB3:
  49              		.loc 1 72 0
  50 0008 4E3D82E2 		add	r3, r2, #4992
  51 000c 083083E2 		add	r3, r3, #8
  52              		.loc 1 71 0
  53 0010 0218A0E1 		mov	r1, r2, asl #16
  54              		.loc 1 72 0
  55 0014 0338A0E1 		mov	r3, r3, asl #16
  56              		.loc 1 71 0
  57 0018 41C8B0E1 		movs	ip, r1, asr #16
  58              	.LBE3:
  59              	.LBE2:
  60              		.loc 1 92 0
  61              		@ lr needed for prologue
  62              	.LBB4:
  63              	.LBB5:
  64              		.loc 1 72 0
  65 001c 2308A0E1 		mov	r0, r3, lsr #16
  66              		.loc 1 71 0
  67 0020 0E00004A 		bmi	.L4
  68              		.loc 1 74 0
  69 0024 4E3D42E2 		sub	r3, r2, #4992
  70              		.loc 1 73 0
  71 0028 18209FE5 		ldr	r2, .L8
  72              	.LVL3:
  73              		.loc 1 74 0
  74 002c 083043E2 		sub	r3, r3, #8
  75 0030 0338A0E1 		mov	r3, r3, asl #16
  76              		.loc 1 73 0
  77 0034 02005CE1 		cmp	ip, r2
  78              		.loc 1 74 0
  79 0038 2308A0E1 		mov	r0, r3, lsr #16
  80              		.loc 1 75 0
  81 003c 2108A0D1 		movle	r0, r1, lsr #16
  82              	.LVL4:
  83              	.L4:
  84              	.LBE5:
  85              	.LBE4:
  93:include/calypso/tpu.h **** 	tpu_enqueue(TPU_INSTR_AT | tpu_mod5000(time));
  86              		.loc 1 93 0
  87 0040 020A80E3 		orr	r0, r0, #8192
  94:include/calypso/tpu.h **** }
  88              		.loc 1 94 0
  89              		.loc 1 93 0
  90 0044 FEFFFFEA 		b	tpu_enqueue
  91              	.LVL5:
  92              	.L9:
  93              		.align	2
  94              	.L8:
  95 0048 87130000 		.word	4999
  96              	.LFE5:
  98              		.section	.text.tpu_enq_wait,"ax",%progbits
  99              		.align	2
 101              	tpu_enq_wait:
 102              	.LFB7:
  95:include/calypso/tpu.h **** 
  96:include/calypso/tpu.h **** /* Enqueue a SYNC operation */
  97:include/calypso/tpu.h **** static inline void tpu_enq_sync(int16_t time)
  98:include/calypso/tpu.h **** {
  99:include/calypso/tpu.h **** 	tpu_enqueue(TPU_INSTR_SYNCHRO | time);
 100:include/calypso/tpu.h **** }
 101:include/calypso/tpu.h **** 
 102:include/calypso/tpu.h **** /* Enqueue a WAIT operation */
 103:include/calypso/tpu.h **** static inline void tpu_enq_wait(int16_t time)
 104:include/calypso/tpu.h **** {
 103              		.loc 1 104 0
 104              		@ args = 0, pretend = 0, frame = 0
 105              		@ frame_needed = 0, uses_anonymous_args = 0
 106              		@ link register save eliminated.
 107              	.LVL6:
 108 0000 0008A0E1 		mov	r0, r0, asl #16
 109              	.LVL7:
 105:include/calypso/tpu.h **** 	tpu_enqueue(TPU_INSTR_WAIT | time);
 110              		.loc 1 105 0
 111 0004 0A0280E3 		orr	r0, r0, #-1610612736
 112 0008 2008A0E1 		mov	r0, r0, lsr #16
 113              		.loc 1 104 0
 114              		@ lr needed for prologue
 106:include/calypso/tpu.h **** }
 115              		.loc 1 106 0
 116              		.loc 1 105 0
 117 000c FEFFFFEA 		b	tpu_enqueue
 118              	.LFE7:
 120              		.section	.text.twl3025_reg_write,"ax",%progbits
 121              		.align	2
 122              		.global	twl3025_reg_write
 124              	twl3025_reg_write:
 125              	.LFB15:
 126              		.file 2 "abb/twl3025.c"
   1:abb/twl3025.c **** /* Driver for Analog Baseband Circuit (TWL3025) */
   2:abb/twl3025.c **** 
   3:abb/twl3025.c **** /* (C) 2010 by Harald Welte <laforge@gnumonks.org>
   4:abb/twl3025.c ****  *
   5:abb/twl3025.c ****  * All Rights Reserved
   6:abb/twl3025.c ****  *
   7:abb/twl3025.c ****  * This program is free software; you can redistribute it and/or modify
   8:abb/twl3025.c ****  * it under the terms of the GNU General Public License as published by
   9:abb/twl3025.c ****  * the Free Software Foundation; either version 2 of the License, or
  10:abb/twl3025.c ****  * (at your option) any later version.
  11:abb/twl3025.c ****  *
  12:abb/twl3025.c ****  * This program is distributed in the hope that it will be useful,
  13:abb/twl3025.c ****  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  14:abb/twl3025.c ****  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  15:abb/twl3025.c ****  * GNU General Public License for more details.
  16:abb/twl3025.c ****  *
  17:abb/twl3025.c ****  * You should have received a copy of the GNU General Public License along
  18:abb/twl3025.c ****  * with this program; if not, write to the Free Software Foundation, Inc.,
  19:abb/twl3025.c ****  * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
  20:abb/twl3025.c ****  *
  21:abb/twl3025.c ****  */
  22:abb/twl3025.c **** 
  23:abb/twl3025.c **** #include <stdint.h>
  24:abb/twl3025.c **** #include <stdio.h>
  25:abb/twl3025.c **** 
  26:abb/twl3025.c **** #include <debug.h>
  27:abb/twl3025.c **** #include <delay.h>
  28:abb/twl3025.c **** #include <memory.h>
  29:abb/twl3025.c **** #include <spi.h>
  30:abb/twl3025.c **** #include <calypso/irq.h>
  31:abb/twl3025.c **** #include <calypso/tsp.h>
  32:abb/twl3025.c **** #include <calypso/tpu.h>
  33:abb/twl3025.c **** #include <abb/twl3025.h>
  34:abb/twl3025.c **** #include <asm/system.h>
  35:abb/twl3025.c **** 
  36:abb/twl3025.c **** /* TWL3025 */
  37:abb/twl3025.c **** #define REG_PAGE(n)	(n >> 7)
  38:abb/twl3025.c **** #define REG_ADDR(n)	(n & 0x3f)
  39:abb/twl3025.c **** 
  40:abb/twl3025.c **** #define TWL3025_DEV_IDX		0	/* On the SPI bus */
  41:abb/twl3025.c **** #define TWL3025_TSP_DEV_IDX	0	/* On the TSP bus */
  42:abb/twl3025.c **** 
  43:abb/twl3025.c **** /* values encountered on a GTA-02 for GSM900 (the same for GSM1800!?) */
  44:abb/twl3025.c **** const uint16_t twl3025_default_ramp[16] = {
  45:abb/twl3025.c **** 	ABB_RAMP_VAL( 0,  0),
  46:abb/twl3025.c **** 	ABB_RAMP_VAL( 0, 11),
  47:abb/twl3025.c **** 	ABB_RAMP_VAL( 0, 31),
  48:abb/twl3025.c **** 	ABB_RAMP_VAL( 0, 31),
  49:abb/twl3025.c **** 	ABB_RAMP_VAL( 0, 31),
  50:abb/twl3025.c **** 	ABB_RAMP_VAL( 0, 24),
  51:abb/twl3025.c **** 	ABB_RAMP_VAL( 0,  0),
  52:abb/twl3025.c **** 	ABB_RAMP_VAL( 0,  0),
  53:abb/twl3025.c **** 	ABB_RAMP_VAL( 9,  0),
  54:abb/twl3025.c **** 	ABB_RAMP_VAL(18,  0),
  55:abb/twl3025.c **** 	ABB_RAMP_VAL(25,  0),
  56:abb/twl3025.c **** 	ABB_RAMP_VAL(31,  0),
  57:abb/twl3025.c **** 	ABB_RAMP_VAL(30,  0),
  58:abb/twl3025.c **** 	ABB_RAMP_VAL(15,  0),
  59:abb/twl3025.c **** 	ABB_RAMP_VAL( 0,  0),
  60:abb/twl3025.c **** 	ABB_RAMP_VAL( 0,  0),
  61:abb/twl3025.c **** };
  62:abb/twl3025.c **** 
  63:abb/twl3025.c **** typedef enum pwon_state {
  64:abb/twl3025.c **** 	PWON_IDLE,
  65:abb/twl3025.c **** 	PWON_DETECTED,
  66:abb/twl3025.c **** 	PWON_REPORTED,
  67:abb/twl3025.c **** } pwon_state_t;
  68:abb/twl3025.c **** 
  69:abb/twl3025.c **** struct twl3025 {
  70:abb/twl3025.c **** 	uint8_t page;
  71:abb/twl3025.c **** 	pwon_state_t pwon;
  72:abb/twl3025.c **** };
  73:abb/twl3025.c **** static struct twl3025 twl3025_state;
  74:abb/twl3025.c **** 
  75:abb/twl3025.c **** /* Switch the register page of the TWL3025 */
  76:abb/twl3025.c **** static void twl3025_switch_page(uint8_t page)
  77:abb/twl3025.c **** {
  78:abb/twl3025.c **** 	if (page == 0)
  79:abb/twl3025.c **** 		twl3025_reg_write(PAGEREG, 1 << 0);
  80:abb/twl3025.c **** 	else
  81:abb/twl3025.c **** 		twl3025_reg_write(PAGEREG, 1 << 1);
  82:abb/twl3025.c **** 
  83:abb/twl3025.c **** 	twl3025_state.page = page;
  84:abb/twl3025.c **** }
  85:abb/twl3025.c **** 
  86:abb/twl3025.c **** static void handle_charger(void)
  87:abb/twl3025.c **** {
  88:abb/twl3025.c **** 	uint16_t status;
  89:abb/twl3025.c **** 	printd("handle_charger();");
  90:abb/twl3025.c **** 
  91:abb/twl3025.c **** 	status = twl3025_reg_read(VRPCSTS);
  92:abb/twl3025.c **** //	printd("\nvrpcsts: 0x%02x", status);
  93:abb/twl3025.c **** 
  94:abb/twl3025.c **** 	if (status & 0x40) {
  95:abb/twl3025.c **** 		printd(" inserted\n");
  96:abb/twl3025.c **** 	} else {
  97:abb/twl3025.c **** 		printd(" removed\n");
  98:abb/twl3025.c **** 	}
  99:abb/twl3025.c **** 
 100:abb/twl3025.c **** //	twl3025_dump_madc();
 101:abb/twl3025.c **** }
 102:abb/twl3025.c **** 
 103:abb/twl3025.c **** static void handle_adc_done(void)
 104:abb/twl3025.c **** {
 105:abb/twl3025.c **** 	printd("handle_adc_done();");
 106:abb/twl3025.c **** }
 107:abb/twl3025.c **** 
 108:abb/twl3025.c **** static void twl3025_irq(enum irq_nr nr)
 109:abb/twl3025.c **** {
 110:abb/twl3025.c **** 	uint16_t src;
 111:abb/twl3025.c **** 	printd("twl3025_irq: 0x%02x\n",nr);
 112:abb/twl3025.c **** 	switch (nr){
 113:abb/twl3025.c **** 	case IRQ_EXTERNAL: // charger in/out, pwrbtn, adc done
 114:abb/twl3025.c **** 		src = twl3025_reg_read(ITSTATREG);
 115:abb/twl3025.c **** //		printd("itstatreg 0x%02x\n", src);
 116:abb/twl3025.c **** 		if ((src & 0x04) && twl3025_state.pwon == PWON_IDLE)
 117:abb/twl3025.c **** 			twl3025_state.pwon = PWON_DETECTED;
 118:abb/twl3025.c **** 		if (src & 0x08)
 119:abb/twl3025.c **** 			handle_charger();
 120:abb/twl3025.c **** 		if (src & 0x20)
 121:abb/twl3025.c **** 			handle_adc_done();
 122:abb/twl3025.c **** 		break;
 123:abb/twl3025.c **** 	case IRQ_EXTERNAL_FIQ: // vcc <2.8V emergency power off
 124:abb/twl3025.c **** 		puts("\nBROWNOUT!1!");
 125:abb/twl3025.c **** 		twl3025_power_off();
 126:abb/twl3025.c **** 		break;
 127:abb/twl3025.c **** 	default:
 128:abb/twl3025.c **** 		return;
 129:abb/twl3025.c **** 	}
 130:abb/twl3025.c **** }
 131:abb/twl3025.c **** 
 132:abb/twl3025.c **** void twl3025_init(void)
 133:abb/twl3025.c **** {
 134:abb/twl3025.c **** 	spi_init();
 135:abb/twl3025.c **** 	twl3025_switch_page(0);
 136:abb/twl3025.c **** 	twl3025_clk13m(1);
 137:abb/twl3025.c **** 	twl3025_reg_write(AFCCTLADD, 0x01);	/* AFCCK(1:0) must not be zero! */
 138:abb/twl3025.c **** 	twl3025_unit_enable(TWL3025_UNIT_AFC, 1);
 139:abb/twl3025.c **** 	twl3025_state.pwon = PWON_IDLE;
 140:abb/twl3025.c **** 
 141:abb/twl3025.c **** 	irq_register_handler(IRQ_EXTERNAL, &twl3025_irq);
 142:abb/twl3025.c **** 	irq_config(IRQ_EXTERNAL, 0, 0, 0);
 143:abb/twl3025.c **** 	irq_enable(IRQ_EXTERNAL);
 144:abb/twl3025.c **** 
 145:abb/twl3025.c **** 	irq_register_handler(IRQ_EXTERNAL_FIQ, &twl3025_irq);
 146:abb/twl3025.c **** 	irq_config(IRQ_EXTERNAL_FIQ, 1, 0, 0);
 147:abb/twl3025.c **** 	irq_enable(IRQ_EXTERNAL_FIQ);
 148:abb/twl3025.c **** }
 149:abb/twl3025.c **** 
 150:abb/twl3025.c **** void twl3025_reg_write(uint8_t reg, uint16_t data)
 151:abb/twl3025.c **** {
 127              		.loc 2 151 0
 128              		@ args = 0, pretend = 0, frame = 4
 129              		@ frame_needed = 0, uses_anonymous_args = 0
 130              	.LVL8:
 131 0000 30402DE9 		stmfd	sp!, {r4, r5, lr}
 132              	.LCFI0:
 133 0004 FF4000E2 		and	r4, r0, #255
 134 0008 0118A0E1 		mov	r1, r1, asl #16
 135              	.LVL9:
 152:abb/twl3025.c **** 	uint16_t tx;
 153:abb/twl3025.c **** 
 154:abb/twl3025.c **** 	printd("tw3025_reg_write(%u,%u)=0x%04x\n", REG_PAGE(reg),
 155:abb/twl3025.c **** 		REG_ADDR(reg), data);
 156:abb/twl3025.c **** 
 157:abb/twl3025.c **** 	if (reg != PAGEREG && REG_PAGE(reg) != twl3025_state.page)
 136              		.loc 2 157 0
 137 000c 010054E3 		cmp	r4, #1
 138              		.loc 2 151 0
 139 0010 04D04DE2 		sub	sp, sp, #4
 140              	.LCFI1:
 141              	.LVL10:
 142              		.loc 2 157 0
 143 0014 A403A0E1 		mov	r0, r4, lsr #7
 144              	.LVL11:
 145              		.loc 2 151 0
 146 0018 2158A0E1 		mov	r5, r1, lsr #16
 147              	.LVL12:
 148              		.loc 2 157 0
 149 001c 0A00000A 		beq	.L13
 150 0020 3C309FE5 		ldr	r3, .L17
 151 0024 0030D3E5 		ldrb	r3, [r3, #0]	@ zero_extendqisi2
 152 0028 000053E1 		cmp	r3, r0
 158:abb/twl3025.c **** 		twl3025_switch_page(REG_PAGE(reg));
 153              		.loc 2 158 0
 154 002c FEFFFF1B 		blne	twl3025_switch_page
 155              	.L13:
 159:abb/twl3025.c **** 
 160:abb/twl3025.c **** 	tx = ((data & 0x3ff) << 6) | (REG_ADDR(reg) << 1);
 156              		.loc 2 160 0
 157 0030 053BA0E1 		mov	r3, r5, asl #22
 158 0034 3FC004E2 		and	ip, r4, #63
 159 0038 233BA0E1 		mov	r3, r3, lsr #22
 160 003c 8CC0A0E1 		mov	ip, ip, asl #1
 161 0040 03C38CE1 		orr	ip, ip, r3, asl #6
 162 0044 04208DE2 		add	r2, sp, #4
 161:abb/twl3025.c **** 
 162:abb/twl3025.c **** 	spi_xfer(TWL3025_DEV_IDX, 16, &tx, NULL);
 163              		.loc 2 162 0
 164 0048 0000A0E3 		mov	r0, #0
 165 004c 1010A0E3 		mov	r1, #16
 166              		.loc 2 160 0
 167 0050 B2C062E1 		strh	ip, [r2, #-2]!	@ movhi
 168              	.LVL13:
 169              		.loc 2 162 0
 170 0054 0030A0E1 		mov	r3, r0
 171 0058 FEFFFFEB 		bl	spi_xfer
 163:abb/twl3025.c **** }
 172              		.loc 2 163 0
 173 005c 04D08DE2 		add	sp, sp, #4
 174 0060 3080BDE8 		ldmfd	sp!, {r4, r5, pc}
 175              	.L18:
 176              		.align	2
 177              	.L17:
 178 0064 00000000 		.word	twl3025_state
 179              	.LFE15:
 181              		.section	.text.twl3025_unit_enable,"ax",%progbits
 182              		.align	2
 183              		.global	twl3025_unit_enable
 185              	twl3025_unit_enable:
 186              	.LFB27:
 164:abb/twl3025.c **** 
 165:abb/twl3025.c **** void twl3025_tsp_write(uint8_t data)
 166:abb/twl3025.c **** {
 167:abb/twl3025.c **** 	tsp_write(TWL3025_TSP_DEV_IDX, 7, data);
 168:abb/twl3025.c **** }
 169:abb/twl3025.c **** 
 170:abb/twl3025.c **** uint16_t twl3025_reg_read(uint8_t reg)
 171:abb/twl3025.c **** {
 172:abb/twl3025.c **** 	uint16_t tx, rx;
 173:abb/twl3025.c **** 
 174:abb/twl3025.c **** 	if (REG_PAGE(reg) != twl3025_state.page)
 175:abb/twl3025.c **** 		twl3025_switch_page(REG_PAGE(reg));
 176:abb/twl3025.c **** 
 177:abb/twl3025.c **** 	tx = (REG_ADDR(reg) << 1) | 1;
 178:abb/twl3025.c **** 
 179:abb/twl3025.c **** 	/* A read cycle contains two SPI transfers */
 180:abb/twl3025.c **** 	spi_xfer(TWL3025_DEV_IDX, 16, &tx, &rx);
 181:abb/twl3025.c **** 	delay_ms(1);
 182:abb/twl3025.c **** 	spi_xfer(TWL3025_DEV_IDX, 16, &tx, &rx);
 183:abb/twl3025.c **** 
 184:abb/twl3025.c **** 	rx >>= 6;
 185:abb/twl3025.c **** 
 186:abb/twl3025.c **** 	printd("tw3025_reg_read(%u,%u)=0x%04x\n", REG_PAGE(reg),
 187:abb/twl3025.c **** 		REG_ADDR(reg), rx);
 188:abb/twl3025.c **** 
 189:abb/twl3025.c **** 	return rx;
 190:abb/twl3025.c **** }
 191:abb/twl3025.c **** 
 192:abb/twl3025.c **** static void twl3025_wait_ibic_access(void)
 193:abb/twl3025.c **** {
 194:abb/twl3025.c **** 	/* Wait 6 * 32kHz clock cycles for first IBIC access (187us + 10% = 210us) */
 195:abb/twl3025.c **** 	delay_ms(1);
 196:abb/twl3025.c **** }
 197:abb/twl3025.c **** 
 198:abb/twl3025.c **** int twl3025_get_pwon(void)
 199:abb/twl3025.c **** {
 200:abb/twl3025.c **** 	switch (twl3025_state.pwon) {
 201:abb/twl3025.c **** 	case PWON_DETECTED:
 202:abb/twl3025.c **** 		twl3025_state.pwon = PWON_REPORTED;
 203:abb/twl3025.c **** 		break;
 204:abb/twl3025.c **** 	case PWON_REPORTED:
 205:abb/twl3025.c **** 		if (twl3025_reg_read(VRPCSTS) & 0x10)
 206:abb/twl3025.c **** 			twl3025_state.pwon = PWON_IDLE;
 207:abb/twl3025.c **** 		break;
 208:abb/twl3025.c **** 	case PWON_IDLE:
 209:abb/twl3025.c **** 	default:
 210:abb/twl3025.c **** 		break;
 211:abb/twl3025.c **** 	}
 212:abb/twl3025.c **** 
 213:abb/twl3025.c **** 	return (twl3025_state.pwon != PWON_IDLE);
 214:abb/twl3025.c **** }
 215:abb/twl3025.c **** 
 216:abb/twl3025.c **** void twl3025_power_off(void)
 217:abb/twl3025.c **** {
 218:abb/twl3025.c **** 	unsigned long flags;
 219:abb/twl3025.c **** 
 220:abb/twl3025.c **** 	/* turn off all IRQs, since received frames cannot be
 221:abb/twl3025.c **** 	 * handled form here. (otherwise the message allocation
 222:abb/twl3025.c **** 	 * runs out of memory) */
 223:abb/twl3025.c **** 	local_firq_save(flags);
 224:abb/twl3025.c **** 
 225:abb/twl3025.c **** 	/* poll PWON status and power off the phone when the
 226:abb/twl3025.c **** 	 * powerbutton has been released (otherwise it will
 227:abb/twl3025.c **** 	 * poweron immediately again) */
 228:abb/twl3025.c **** 	while (!(twl3025_reg_read(VRPCSTS) & 0x10)) { };
 229:abb/twl3025.c **** 	twl3025_reg_write(VRPCDEV, 0x01);
 230:abb/twl3025.c **** }
 231:abb/twl3025.c **** 
 232:abb/twl3025.c **** void twl3025_power_off_now(void)
 233:abb/twl3025.c **** {
 234:abb/twl3025.c **** 	/* The phone will restart if the power butten has not been released.
 235:abb/twl3025.c **** 	 * This can be useful for development. */
 236:abb/twl3025.c **** 	unsigned long flags;
 237:abb/twl3025.c **** 	local_firq_save(flags);
 238:abb/twl3025.c **** 	twl3025_reg_write(VRPCDEV, 0x01);
 239:abb/twl3025.c **** }
 240:abb/twl3025.c **** 
 241:abb/twl3025.c **** void twl3025_clk13m(int enable)
 242:abb/twl3025.c **** {
 243:abb/twl3025.c **** 	if (enable) {
 244:abb/twl3025.c **** 		twl3025_reg_write(TOGBR2, TOGBR2_ACTS);
 245:abb/twl3025.c **** 		twl3025_wait_ibic_access();
 246:abb/twl3025.c **** 		/* for whatever reason we need to do this twice */
 247:abb/twl3025.c **** 		twl3025_reg_write(TOGBR2, TOGBR2_ACTS);
 248:abb/twl3025.c **** 		twl3025_wait_ibic_access();
 249:abb/twl3025.c **** 	} else {
 250:abb/twl3025.c **** 		twl3025_reg_write(TOGBR2, TOGBR2_ACTR);
 251:abb/twl3025.c **** 		twl3025_wait_ibic_access();
 252:abb/twl3025.c **** 	}
 253:abb/twl3025.c **** }
 254:abb/twl3025.c **** 
 255:abb/twl3025.c **** #define	TSP_DELAY	6	/* 13* Tclk6M5 = ~ 3 GSM Qbits + 3 TPU instructions */
 256:abb/twl3025.c **** #define BDLON_TO_BDLCAL	6
 257:abb/twl3025.c **** #define BDLCAL_DURATION	66
 258:abb/twl3025.c **** #define BDLON_TO_BDLENA	7
 259:abb/twl3025.c **** #define BULON_TO_BULENA	16
 260:abb/twl3025.c **** #define BULON_TO_BULCAL	17
 261:abb/twl3025.c **** #define BULCAL_DURATION	143	/* really that long? */
 262:abb/twl3025.c **** 
 263:abb/twl3025.c **** /* bdl_ena - TSP_DELAY - BDLCAL_DURATION - TSP_DELAY - BDLON_TO_BDLCAL - TSP_DELAY */
 264:abb/twl3025.c **** #define DOWNLINK_DELAY	(3 * TSP_DELAY + BDLCAL_DURATION + BDLON_TO_BDLCAL)
 265:abb/twl3025.c **** 
 266:abb/twl3025.c **** /* Enqueue a series of TSP commands in the TPU to (de)activate the downlink path */
 267:abb/twl3025.c **** void twl3025_downlink(int on, int16_t at)
 268:abb/twl3025.c **** {
 269:abb/twl3025.c **** 	int16_t bdl_ena = at - TSP_DELAY - 6;
 270:abb/twl3025.c **** 
 271:abb/twl3025.c **** 	if (on) {
 272:abb/twl3025.c **** 		if (bdl_ena < 0)
 273:abb/twl3025.c **** 			printf("BDLENA time negative (%d)\n", bdl_ena);
 274:abb/twl3025.c **** 		/* calibration should be done just before BDLENA */
 275:abb/twl3025.c **** 		tpu_enq_at(bdl_ena - DOWNLINK_DELAY);
 276:abb/twl3025.c **** 		/* bdl_ena - TSP_DELAY - BDLCAL_DURATION - TSP_DELAY - BDLON_TO_BDLCAL - TSP_DELAY */
 277:abb/twl3025.c **** 		twl3025_tsp_write(BDLON);
 278:abb/twl3025.c **** 		/* bdl_ena - TSP_DELAY - BDLCAL_DURATION - TSP_DELAY - BDLON_TO_BDLCAL */
 279:abb/twl3025.c **** 		tpu_enq_wait(BDLON_TO_BDLCAL - TSP_DELAY);
 280:abb/twl3025.c **** 		/* bdl_ena - TSP_DELAY - BDLCAL_DURATION - TSP_DELAY */
 281:abb/twl3025.c **** 		twl3025_tsp_write(BDLON | BDLCAL);
 282:abb/twl3025.c **** 		/* bdl_ena - TSP_DELAY - BDLCAL_DURATION */
 283:abb/twl3025.c **** 		tpu_enq_wait(BDLCAL_DURATION - TSP_DELAY);
 284:abb/twl3025.c **** 		/* bdl_ena - TSP_DELAY */
 285:abb/twl3025.c **** 		twl3025_tsp_write(BDLON);
 286:abb/twl3025.c **** 		//tpu_enq_wait(BDLCAL_TO_BDLENA)	this is only 3.7us == 4 qbits, i.e. less than the TSP_DELAY
 287:abb/twl3025.c **** 		tpu_enq_at(bdl_ena);
 288:abb/twl3025.c **** 		twl3025_tsp_write(BDLON | BDLENA);
 289:abb/twl3025.c **** 	} else {
 290:abb/twl3025.c **** 		tpu_enq_at(bdl_ena);
 291:abb/twl3025.c **** 		twl3025_tsp_write(BDLON);
 292:abb/twl3025.c **** 		//tpu_enq_wait(nBDLENA_TO_nBDLON)	this is only 3.7us == 4 qbits, i.e. less than the TSP_DELAY
 293:abb/twl3025.c **** 		twl3025_tsp_write(0);
 294:abb/twl3025.c **** 	}
 295:abb/twl3025.c **** }
 296:abb/twl3025.c **** 
 297:abb/twl3025.c **** /* bdl_ena - 35 - TSP_DELAY - BULCAL_DURATION - TSP_DELAY - BULON_TO_BULCAL - TSP_DELAY */
 298:abb/twl3025.c **** #define UPLINK_DELAY (3 * TSP_DELAY + BULCAL_DURATION + BULON_TO_BULCAL + 35)
 299:abb/twl3025.c **** 
 300:abb/twl3025.c **** void twl3025_uplink(int on, int16_t at)
 301:abb/twl3025.c **** {
 302:abb/twl3025.c **** 	int16_t bul_ena = at - TSP_DELAY - 6;
 303:abb/twl3025.c **** 
 304:abb/twl3025.c **** 	if (bul_ena < 0)
 305:abb/twl3025.c **** 		printf("BULENA time negative (%d)\n", bul_ena);
 306:abb/twl3025.c **** 	if (on) {
 307:abb/twl3025.c **** 		/* calibration should  be done just before BULENA */
 308:abb/twl3025.c **** 		tpu_enq_at(bul_ena - UPLINK_DELAY);
 309:abb/twl3025.c **** 		/* bdl_ena - 35 - TSP_DELAY - BULCAL_DURATION - TSP_DELAY - BULON_TO_BULCAL - TSP_DELAY */
 310:abb/twl3025.c **** 		twl3025_tsp_write(BULON);
 311:abb/twl3025.c **** 		/* bdl_ena - 35 - TSP_DELAY - BULCAL_DURATION - TSP_DELAY - BULON_TO_BULCAL */
 312:abb/twl3025.c **** 		tpu_enq_wait(BULON_TO_BULCAL - TSP_DELAY);
 313:abb/twl3025.c **** 		/* bdl_ena - 35 - TSP_DELAY - BULCAL_DURATION - TSP_DELAY */
 314:abb/twl3025.c **** 		twl3025_tsp_write(BULON | BULCAL);
 315:abb/twl3025.c **** 		/* bdl_ena - 35 - TSP_DELAY - BULCAL_DURATION */
 316:abb/twl3025.c **** 		tpu_enq_wait(BULCAL_DURATION - TSP_DELAY);
 317:abb/twl3025.c **** 		/* bdl_ena - 35 - TSP_DELAY */
 318:abb/twl3025.c **** 		twl3025_tsp_write(BULON);
 319:abb/twl3025.c **** 		/* bdl_ena - 35 */
 320:abb/twl3025.c **** 		tpu_enq_wait(35);	/* minimum time required to bring the ramp up (really needed?) */
 321:abb/twl3025.c **** 		tpu_enq_at(bul_ena);
 322:abb/twl3025.c **** 		twl3025_tsp_write(BULON | BULENA);
 323:abb/twl3025.c **** 	} else {
 324:abb/twl3025.c **** 		tpu_enq_at(bul_ena);
 325:abb/twl3025.c **** 		twl3025_tsp_write(BULON);
 326:abb/twl3025.c **** 		tpu_enq_wait(35);	/* minimum time required to bring the ramp down (needed!) */
 327:abb/twl3025.c **** 		twl3025_tsp_write(0);
 328:abb/twl3025.c **** 	}
 329:abb/twl3025.c **** }
 330:abb/twl3025.c **** 
 331:abb/twl3025.c **** void twl3025_afc_set(int16_t val)
 332:abb/twl3025.c **** {
 333:abb/twl3025.c **** 	printf("twl3025_afc_set(%d)\n", val);
 334:abb/twl3025.c **** 
 335:abb/twl3025.c **** 	if (val > 4095)
 336:abb/twl3025.c **** 		val = 4095;
 337:abb/twl3025.c **** 	else if (val <= -4096)
 338:abb/twl3025.c **** 		val = -4096;
 339:abb/twl3025.c **** 
 340:abb/twl3025.c **** 	/* FIXME: we currently write from the USP rather than BSP */
 341:abb/twl3025.c **** 	twl3025_reg_write(AUXAFC2, val >> 10);
 342:abb/twl3025.c **** 	twl3025_reg_write(AUXAFC1, val & 0x3ff);
 343:abb/twl3025.c **** }
 344:abb/twl3025.c **** 
 345:abb/twl3025.c **** int16_t twl3025_afc_get(void)
 346:abb/twl3025.c **** {
 347:abb/twl3025.c **** 	int16_t val;
 348:abb/twl3025.c **** 
 349:abb/twl3025.c **** 	val = (twl3025_reg_read(AUXAFC2) & 0x7);
 350:abb/twl3025.c **** 	val = val << 10;
 351:abb/twl3025.c **** 	val = val | (twl3025_reg_read(AUXAFC1) & 0x3ff);
 352:abb/twl3025.c **** 
 353:abb/twl3025.c **** 	if (val > 4095)
 354:abb/twl3025.c **** 		val = -(8192 - val);
 355:abb/twl3025.c **** 	return val;
 356:abb/twl3025.c **** }
 357:abb/twl3025.c **** 
 358:abb/twl3025.c **** void twl3025_unit_enable(enum twl3025_unit unit, int on)
 359:abb/twl3025.c **** {
 187              		.loc 2 359 0
 188              		@ args = 0, pretend = 0, frame = 0
 189              		@ frame_needed = 0, uses_anonymous_args = 0
 190              		@ link register save eliminated.
 191              	.LVL14:
 192              		@ lr needed for prologue
 360:abb/twl3025.c **** 	uint16_t togbr1 = 0;
 361:abb/twl3025.c **** 
 362:abb/twl3025.c **** 	switch (unit) {
 193              		.loc 2 362 0
 194 0000 040050E3 		cmp	r0, #4
 195 0004 00F19F97 		ldrls	pc, [pc, r0, asl #2]
 196 0008 060000EA 		b	.L20
 197              		.p2align 2
 198              	.L25:
 199 000c 28000000 		.word	.L21
 200 0010 38000000 		.word	.L22
 201 0014 48000000 		.word	.L23
 202 0018 48000000 		.word	.L23
 203 001c 58000000 		.word	.L24
 204              	.L20:
 205 0020 0010A0E3 		mov	r1, #0
 206              	.LVL15:
 207 0024 170000EA 		b	.L26
 208              	.LVL16:
 209              	.L21:
 363:abb/twl3025.c **** 	case TWL3025_UNIT_AFC:
 364:abb/twl3025.c **** 		if (on)
 210              		.loc 2 364 0
 211 0028 000051E3 		cmp	r1, #0
 212 002c 4010A003 		moveq	r1, #64
 213              	.LVL17:
 214 0030 8010A013 		movne	r1, #128
 215 0034 170000EA 		b	.L26
 216              	.LVL18:
 217              	.L22:
 365:abb/twl3025.c **** 			togbr1 = (1 << 7);
 366:abb/twl3025.c **** 		else
 367:abb/twl3025.c **** 			togbr1 = (1 << 6);
 368:abb/twl3025.c **** 		break;
 369:abb/twl3025.c **** 	case TWL3025_UNIT_MAD:
 370:abb/twl3025.c **** 		if (on)
 218              		.loc 2 370 0
 219 0038 000051E3 		cmp	r1, #0
 220 003c 011CA003 		moveq	r1, #256
 221              	.LVL19:
 222 0040 021CA013 		movne	r1, #512
 223 0044 170000EA 		b	.L26
 224              	.LVL20:
 225              	.L23:
 371:abb/twl3025.c **** 			togbr1 = (1 << 9);
 372:abb/twl3025.c **** 		else
 373:abb/twl3025.c **** 			togbr1 = (1 << 8);
 374:abb/twl3025.c **** 		break;
 375:abb/twl3025.c **** 	case TWL3025_UNIT_ADA:
 376:abb/twl3025.c **** 		if (on)
 377:abb/twl3025.c **** 			togbr1 = (1 << 5);
 378:abb/twl3025.c **** 		else
 379:abb/twl3025.c **** 			togbr1 = (1 << 4);
 380:abb/twl3025.c **** 	case TWL3025_UNIT_VDL:
 381:abb/twl3025.c **** 		if (on)
 226              		.loc 2 381 0
 227 0048 000051E3 		cmp	r1, #0
 228 004c 0410A003 		moveq	r1, #4
 229              	.LVL21:
 230 0050 0810A013 		movne	r1, #8
 231 0054 170000EA 		b	.L26
 232              	.LVL22:
 233              	.L24:
 382:abb/twl3025.c **** 			togbr1 = (1 << 3);
 383:abb/twl3025.c **** 		else
 384:abb/twl3025.c **** 			togbr1 = (1 << 2);
 385:abb/twl3025.c **** 		break;
 386:abb/twl3025.c **** 	case TWL3025_UNIT_VUL:
 387:abb/twl3025.c **** 		if (on)
 234              		.loc 2 387 0
 235 0058 000051E3 		cmp	r1, #0
 236 005c 0110A003 		moveq	r1, #1
 237              	.LVL23:
 238 0060 0210A013 		movne	r1, #2
 239              	.L26:
 388:abb/twl3025.c **** 			togbr1 = (1 << 1);
 389:abb/twl3025.c **** 		else
 390:abb/twl3025.c **** 			togbr1 = (1 << 0);
 391:abb/twl3025.c **** 		break;
 392:abb/twl3025.c **** 	}
 393:abb/twl3025.c **** 	twl3025_reg_write(TOGBR1, togbr1);
 240              		.loc 2 393 0
 241 0064 0400A0E3 		mov	r0, #4
 242              	.LVL24:
 394:abb/twl3025.c **** }
 243              		.loc 2 394 0
 244              		.loc 2 393 0
 245 0068 FEFFFFEA 		b	twl3025_reg_write
 246              	.LVL25:
 247              	.LFE27:
 249              		.section	.text.twl3025_switch_page,"ax",%progbits
 250              		.align	2
 252              	twl3025_switch_page:
 253              	.LFB10:
 254              		.loc 2 77 0
 255              		@ args = 0, pretend = 0, frame = 0
 256              		@ frame_needed = 0, uses_anonymous_args = 0
 257              	.LVL26:
 258 0000 0030A0E1 		mov	r3, r0
 259 0004 10402DE9 		stmfd	sp!, {r4, lr}
 260              	.LCFI2:
 261              		.loc 2 79 0
 262 0008 0100A0E3 		mov	r0, #1
 263              	.LVL27:
 264              		.loc 2 78 0
 265 000c FF4013E2 		ands	r4, r3, #255
 266              		.loc 2 79 0
 267 0010 0010A0E1 		mov	r1, r0
 268              		.loc 2 81 0
 269 0014 0100A013 		movne	r0, #1
 270 0018 0210A013 		movne	r1, #2
 271 001c FEFFFFEB 		bl	twl3025_reg_write
 272              	.LVL28:
 273              		.loc 2 83 0
 274 0020 04309FE5 		ldr	r3, .L42
 275 0024 0040C3E5 		strb	r4, [r3, #0]
 276              		.loc 2 84 0
 277 0028 1080BDE8 		ldmfd	sp!, {r4, pc}
 278              	.L43:
 279              		.align	2
 280              	.L42:
 281 002c 00000000 		.word	twl3025_state
 282              	.LFE10:
 284              		.section	.text.twl3025_tsp_write,"ax",%progbits
 285              		.align	2
 286              		.global	twl3025_tsp_write
 288              	twl3025_tsp_write:
 289              	.LFB16:
 290              		.loc 2 166 0
 291              		@ args = 0, pretend = 0, frame = 0
 292              		@ frame_needed = 0, uses_anonymous_args = 0
 293              		@ link register save eliminated.
 294              	.LVL29:
 295 0000 FF2000E2 		and	r2, r0, #255
 296              		.loc 2 167 0
 297 0004 0710A0E3 		mov	r1, #7
 298 0008 0000A0E3 		mov	r0, #0
 299              	.LVL30:
 300              		.loc 2 166 0
 301              		@ lr needed for prologue
 302              		.loc 2 168 0
 303              		.loc 2 167 0
 304 000c FEFFFFEA 		b	tsp_write
 305              	.LVL31:
 306              	.LFE16:
 308              		.section	.text.twl3025_reg_read,"ax",%progbits
 309              		.align	2
 310              		.global	twl3025_reg_read
 312              	twl3025_reg_read:
 313              	.LFB17:
 314              		.loc 2 171 0
 315              		@ args = 0, pretend = 0, frame = 4
 316              		@ frame_needed = 0, uses_anonymous_args = 0
 317              	.LVL32:
 318 0000 70402DE9 		stmfd	sp!, {r4, r5, r6, lr}
 319              	.LCFI3:
 320              		.loc 2 174 0
 321 0004 70309FE5 		ldr	r3, .L50
 322              		.loc 2 171 0
 323 0008 0040A0E1 		mov	r4, r0
 324              		.loc 2 174 0
 325 000c 0030D3E5 		ldrb	r3, [r3, #0]	@ zero_extendqisi2
 326              		.loc 2 171 0
 327 0010 FF0000E2 		and	r0, r0, #255
 328              		.loc 2 174 0
 329 0014 A003A0E1 		mov	r0, r0, lsr #7
 330              	.LVL33:
 331              		.loc 2 171 0
 332 0018 04D04DE2 		sub	sp, sp, #4
 333              	.LCFI4:
 334              	.LVL34:
 335              		.loc 2 174 0
 336 001c 000053E1 		cmp	r3, r0
 337              		.loc 2 177 0
 338 0020 04508DE2 		add	r5, sp, #4
 339              		.loc 2 180 0
 340 0024 0D60A0E1 		mov	r6, sp
 341              		.loc 2 174 0
 342              		.loc 2 175 0
 343 0028 FEFFFF1B 		blne	twl3025_switch_page
 344              	.L47:
 345              		.loc 2 177 0
 346 002c 3F3004E2 		and	r3, r4, #63
 347 0030 8330A0E1 		mov	r3, r3, asl #1
 348 0034 013083E3 		orr	r3, r3, #1
 349 0038 B23065E1 		strh	r3, [r5, #-2]!	@ movhi
 350              	.LVL35:
 351              		.loc 2 180 0
 352 003c 1010A0E3 		mov	r1, #16
 353 0040 0520A0E1 		mov	r2, r5
 354 0044 0D30A0E1 		mov	r3, sp
 355 0048 0000A0E3 		mov	r0, #0
 356 004c FEFFFFEB 		bl	spi_xfer
 357              		.loc 2 181 0
 358 0050 0100A0E3 		mov	r0, #1
 359 0054 FEFFFFEB 		bl	delay_ms
 360              		.loc 2 182 0
 361 0058 0520A0E1 		mov	r2, r5
 362 005c 0D30A0E1 		mov	r3, sp
 363 0060 1010A0E3 		mov	r1, #16
 364 0064 0000A0E3 		mov	r0, #0
 365 0068 FEFFFFEB 		bl	spi_xfer
 366              	.LVL36:
 367 006c B000DDE1 		ldrh	r0, [sp, #0]
 368              		.loc 2 190 0
 369 0070 2003A0E1 		mov	r0, r0, lsr #6
 370 0074 04D08DE2 		add	sp, sp, #4
 371 0078 7080BDE8 		ldmfd	sp!, {r4, r5, r6, pc}
 372              	.L51:
 373              		.align	2
 374              	.L50:
 375 007c 00000000 		.word	twl3025_state
 376              	.LFE17:
 378              		.section	.text.twl3025_power_off,"ax",%progbits
 379              		.align	2
 380              		.global	twl3025_power_off
 382              	twl3025_power_off:
 383              	.LFB20:
 384              		.loc 2 217 0
 385              		@ args = 0, pretend = 0, frame = 0
 386              		@ frame_needed = 0, uses_anonymous_args = 0
 387              	.LVL37:
 388 0000 04E02DE5 		str	lr, [sp, #-4]!
 389              	.LCFI5:
 390              	.LBB6:
 391              		.loc 2 223 0
 392 0004 00200FE1 		mrs	r2, cpsr		@ local_firq_save
 393 0008 C03082E3 		orr	r3, r2, #0xC0
 394 000c 03F021E1 		msr	cpsr_c, r3
 395              	.LVL38:
 396              	.L53:
 397              	.LBE6:
 398              		.loc 2 228 0
 399 0010 1F00A0E3 		mov	r0, #31
 400 0014 FEFFFFEB 		bl	twl3025_reg_read
 401              	.LVL39:
 402 0018 100010E3 		tst	r0, #16
 403 001c 0200000A 		beq	.L53
 404              		.loc 2 229 0
 405 0020 1E00A0E3 		mov	r0, #30
 406 0024 0110A0E3 		mov	r1, #1
 407              		.loc 2 230 0
 408 0028 04E09DE4 		ldr	lr, [sp], #4
 409              		.loc 2 229 0
 410 002c FEFFFFEA 		b	twl3025_reg_write
 411              	.LFE20:
 413              		.section	.rodata.str1.4,"aMS",%progbits,1
 414              		.align	2
 415              	.LC0:
 416 0000 0A42524F 		.ascii	"\012BROWNOUT!1!\000"
 416      574E4F55 
 416      54213121 
 416      00
 417              		.section	.text.twl3025_irq,"ax",%progbits
 418              		.align	2
 420              	twl3025_irq:
 421              	.LFB13:
 422              		.loc 2 109 0
 423              		@ args = 0, pretend = 0, frame = 0
 424              		@ frame_needed = 0, uses_anonymous_args = 0
 425              	.LVL40:
 426 0000 0030A0E1 		mov	r3, r0
 427              		.loc 2 112 0
 428 0004 0C0053E3 		cmp	r3, #12
 429              		.loc 2 109 0
 430 0008 04E02DE5 		str	lr, [sp, #-4]!
 431              	.LCFI6:
 432              		.loc 2 114 0
 433 000c 1B00A0E3 		mov	r0, #27
 434              	.LVL41:
 435              		.loc 2 112 0
 436 0010 0600000A 		beq	.L60
 437 0014 110053E3 		cmp	r3, #17
 438 0018 04F09D14 		ldrne	pc, [sp], #4
 439 001c 140000EA 		b	.L61
 440              	.L60:
 441              		.loc 2 114 0
 442 0020 FEFFFFEB 		bl	twl3025_reg_read
 443              	.LVL42:
 444 0024 0020A0E1 		mov	r2, r0
 445              		.loc 2 116 0
 446 0028 040012E3 		tst	r2, #4
 447              	.LBB7:
 448              	.LBB8:
 449              		.loc 2 91 0
 450 002c 1F00A0E3 		mov	r0, #31
 451              	.LBE8:
 452              	.LBE7:
 453              		.loc 2 116 0
 454 0030 30109FE5 		ldr	r1, .L67
 455 0034 1000000A 		beq	.L62
 456 0038 043091E5 		ldr	r3, [r1, #4]
 457 003c 000053E3 		cmp	r3, #0
 458              		.loc 2 117 0
 459 0040 01308302 		addeq	r3, r3, #1
 460 0044 04308105 		streq	r3, [r1, #4]
 461              	.L62:
 462              		.loc 2 118 0
 463 0048 080012E3 		tst	r2, #8
 464 004c 04F09D04 		ldreq	pc, [sp], #4
 465              		.loc 2 130 0
 466 0050 04E09DE4 		ldr	lr, [sp], #4
 467              	.LBB9:
 468              	.LBB10:
 469              		.loc 2 91 0
 470 0054 FEFFFFEA 		b	twl3025_reg_read
 471              	.LVL43:
 472              	.L61:
 473              	.LBE10:
 474              	.LBE9:
 475              		.loc 2 124 0
 476 0058 0C009FE5 		ldr	r0, .L67+4
 477 005c FEFFFFEB 		bl	puts
 478              	.LVL44:
 479              		.loc 2 130 0
 480 0060 04E09DE4 		ldr	lr, [sp], #4
 481              		.loc 2 125 0
 482 0064 FEFFFFEA 		b	twl3025_power_off
 483              	.L68:
 484              		.align	2
 485              	.L67:
 486 0068 00000000 		.word	twl3025_state
 487 006c 00000000 		.word	.LC0
 488              	.LFE13:
 490              		.section	.text.twl3025_wait_ibic_access,"ax",%progbits
 491              		.align	2
 493              	twl3025_wait_ibic_access:
 494              	.LFB18:
 495              		.loc 2 193 0
 496              		@ args = 0, pretend = 0, frame = 0
 497              		@ frame_needed = 0, uses_anonymous_args = 0
 498              		@ link register save eliminated.
 499              	.LVL45:
 500              		.loc 2 195 0
 501 0000 0100A0E3 		mov	r0, #1
 502              		.loc 2 193 0
 503              		@ lr needed for prologue
 504              		.loc 2 196 0
 505              		.loc 2 195 0
 506 0004 FEFFFFEA 		b	delay_ms
 507              	.LFE18:
 509              		.section	.text.twl3025_clk13m,"ax",%progbits
 510              		.align	2
 511              		.global	twl3025_clk13m
 513              	twl3025_clk13m:
 514              	.LFB22:
 515              		.loc 2 242 0
 516              		@ args = 0, pretend = 0, frame = 0
 517              		@ frame_needed = 0, uses_anonymous_args = 0
 518              	.LVL46:
 519              		.loc 2 243 0
 520 0000 000050E3 		cmp	r0, #0
 521              		.loc 2 244 0
 522 0004 0810A0E3 		mov	r1, #8
 523 0008 0500A0E3 		mov	r0, #5
 524              	.LVL47:
 525              		.loc 2 242 0
 526 000c 04E02DE5 		str	lr, [sp, #-4]!
 527              	.LCFI7:
 528              		.loc 2 250 0
 529 0010 0500A003 		moveq	r0, #5
 530 0014 0410A003 		moveq	r1, #4
 531              		.loc 2 243 0
 532 0018 0900000A 		beq	.L76
 533              		.loc 2 244 0
 534 001c FEFFFFEB 		bl	twl3025_reg_write
 535              		.loc 2 245 0
 536 0020 FEFFFFEB 		bl	twl3025_wait_ibic_access
 537              		.loc 2 247 0
 538 0024 0500A0E3 		mov	r0, #5
 539 0028 0810A0E3 		mov	r1, #8
 540              	.L76:
 541              		.loc 2 250 0
 542 002c FEFFFFEB 		bl	twl3025_reg_write
 543              		.loc 2 253 0
 544 0030 04E09DE4 		ldr	lr, [sp], #4
 545              		.loc 2 251 0
 546 0034 FEFFFFEA 		b	twl3025_wait_ibic_access
 547              	.LFE22:
 549              		.section	.text.twl3025_init,"ax",%progbits
 550              		.align	2
 551              		.global	twl3025_init
 553              	twl3025_init:
 554              	.LFB14:
 555              		.loc 2 133 0
 556              		@ args = 0, pretend = 0, frame = 0
 557              		@ frame_needed = 0, uses_anonymous_args = 0
 558              	.LVL48:
 559 0000 30402DE9 		stmfd	sp!, {r4, r5, lr}
 560              	.LCFI8:
 561              		.loc 2 134 0
 562 0004 FEFFFFEB 		bl	spi_init
 563              		.loc 2 135 0
 564 0008 0000A0E3 		mov	r0, #0
 565 000c FEFFFFEB 		bl	twl3025_switch_page
 566              		.loc 2 136 0
 567 0010 0100A0E3 		mov	r0, #1
 568 0014 FEFFFFEB 		bl	twl3025_clk13m
 569              		.loc 2 137 0
 570 0018 9500A0E3 		mov	r0, #149
 571 001c 0110A0E3 		mov	r1, #1
 572 0020 FEFFFFEB 		bl	twl3025_reg_write
 573              		.loc 2 138 0
 574 0024 0000A0E3 		mov	r0, #0
 575 0028 0110A0E3 		mov	r1, #1
 576 002c FEFFFFEB 		bl	twl3025_unit_enable
 577              		.loc 2 141 0
 578 0030 5C509FE5 		ldr	r5, .L79
 579              		.loc 2 139 0
 580 0034 5C309FE5 		ldr	r3, .L79+4
 581 0038 0040A0E3 		mov	r4, #0
 582              		.loc 2 141 0
 583 003c 0510A0E1 		mov	r1, r5
 584              		.loc 2 139 0
 585 0040 044083E5 		str	r4, [r3, #4]
 586              		.loc 2 141 0
 587 0044 0C00A0E3 		mov	r0, #12
 588 0048 FEFFFFEB 		bl	irq_register_handler
 589              		.loc 2 142 0
 590 004c 0420A0E1 		mov	r2, r4
 591 0050 0430A0E1 		mov	r3, r4
 592 0054 0410A0E1 		mov	r1, r4
 593 0058 0C00A0E3 		mov	r0, #12
 594 005c FEFFFFEB 		bl	irq_config
 595              		.loc 2 143 0
 596 0060 0C00A0E3 		mov	r0, #12
 597 0064 FEFFFFEB 		bl	irq_enable
 598              		.loc 2 145 0
 599 0068 0510A0E1 		mov	r1, r5
 600 006c 1100A0E3 		mov	r0, #17
 601 0070 FEFFFFEB 		bl	irq_register_handler
 602              		.loc 2 146 0
 603 0074 0420A0E1 		mov	r2, r4
 604 0078 1100A0E3 		mov	r0, #17
 605 007c 0110A0E3 		mov	r1, #1
 606 0080 0430A0E1 		mov	r3, r4
 607 0084 FEFFFFEB 		bl	irq_config
 608              		.loc 2 147 0
 609 0088 1100A0E3 		mov	r0, #17
 610              		.loc 2 148 0
 611 008c 3040BDE8 		ldmfd	sp!, {r4, r5, lr}
 612              		.loc 2 147 0
 613 0090 FEFFFFEA 		b	irq_enable
 614              	.L80:
 615              		.align	2
 616              	.L79:
 617 0094 00000000 		.word	twl3025_irq
 618 0098 00000000 		.word	twl3025_state
 619              	.LFE14:
 621              		.section	.text.twl3025_get_pwon,"ax",%progbits
 622              		.align	2
 623              		.global	twl3025_get_pwon
 625              	twl3025_get_pwon:
 626              	.LFB19:
 627              		.loc 2 199 0
 628              		@ args = 0, pretend = 0, frame = 0
 629              		@ frame_needed = 0, uses_anonymous_args = 0
 630              	.LVL49:
 631 0000 10402DE9 		stmfd	sp!, {r4, lr}
 632              	.LCFI9:
 633              		.loc 2 200 0
 634 0004 48409FE5 		ldr	r4, .L88
 635 0008 043094E5 		ldr	r3, [r4, #4]
 636 000c 010053E3 		cmp	r3, #1
 637 0010 0600000A 		beq	.L83
 638 0014 020053E3 		cmp	r3, #2
 639 0018 0E00001A 		bne	.L82
 640 001c 080000EA 		b	.L84
 641              	.L83:
 642              		.loc 2 202 0
 643 0020 0230A0E3 		mov	r3, #2
 644 0024 0D0000EA 		b	.L87
 645              	.L84:
 646              		.loc 2 205 0
 647 0028 1F00A0E3 		mov	r0, #31
 648 002c FEFFFFEB 		bl	twl3025_reg_read
 649 0030 100010E3 		tst	r0, #16
 650 0034 0E00000A 		beq	.L82
 651              		.loc 2 206 0
 652 0038 0030A0E3 		mov	r3, #0
 653              	.L87:
 654 003c 043084E5 		str	r3, [r4, #4]
 655              	.L82:
 656 0040 0C309FE5 		ldr	r3, .L88
 657 0044 040093E5 		ldr	r0, [r3, #4]
 658              		.loc 2 214 0
 659 0048 000050E2 		subs	r0, r0, #0
 660 004c 0100A013 		movne	r0, #1
 661 0050 1080BDE8 		ldmfd	sp!, {r4, pc}
 662              	.L89:
 663              		.align	2
 664              	.L88:
 665 0054 00000000 		.word	twl3025_state
 666              	.LFE19:
 668              		.section	.text.twl3025_power_off_now,"ax",%progbits
 669              		.align	2
 670              		.global	twl3025_power_off_now
 672              	twl3025_power_off_now:
 673              	.LFB21:
 674              		.loc 2 233 0
 675              		@ args = 0, pretend = 0, frame = 0
 676              		@ frame_needed = 0, uses_anonymous_args = 0
 677              		@ link register save eliminated.
 678              	.LVL50:
 679              		@ lr needed for prologue
 680              	.LBB11:
 681              		.loc 2 237 0
 682 0000 00200FE1 		mrs	r2, cpsr		@ local_firq_save
 683 0004 C03082E3 		orr	r3, r2, #0xC0
 684 0008 03F021E1 		msr	cpsr_c, r3
 685              	.LVL51:
 686              	.LBE11:
 687              		.loc 2 238 0
 688 000c 1E00A0E3 		mov	r0, #30
 689 0010 0110A0E3 		mov	r1, #1
 690              		.loc 2 239 0
 691              		.loc 2 238 0
 692 0014 FEFFFFEA 		b	twl3025_reg_write
 693              	.LVL52:
 694              	.LFE21:
 696              		.section	.rodata.str1.4
 697 000d 000000   		.align	2
 698              	.LC1:
 699 0010 42444C45 		.ascii	"BDLENA time negative (%d)\012\000"
 699      4E412074 
 699      696D6520 
 699      6E656761 
 699      74697665 
 700              		.section	.text.twl3025_downlink,"ax",%progbits
 701              		.align	2
 702              		.global	twl3025_downlink
 704              	twl3025_downlink:
 705              	.LFB23:
 706              		.loc 2 268 0
 707              		@ args = 0, pretend = 0, frame = 0
 708              		@ frame_needed = 0, uses_anonymous_args = 0
 709              	.LVL53:
 710 0000 0118A0E1 		mov	r1, r1, asl #16
 711              	.LVL54:
 712 0004 30402DE9 		stmfd	sp!, {r4, r5, lr}
 713              	.LCFI10:
 714 0008 033741E2 		sub	r3, r1, #786432
 715              		.loc 2 271 0
 716 000c 005050E2 		subs	r5, r0, #0
 717              		.loc 2 269 0
 718 0010 2148A0E1 		mov	r4, r1, lsr #16
 719              	.LVL55:
 720              		.loc 2 290 0
 721 0014 4308A0E1 		mov	r0, r3, asr #16
 722              	.LVL56:
 723              		.loc 2 271 0
 724 0018 1B00000A 		beq	.L93
 725              		.loc 2 272 0
 726 001c 4358B0E1 		movs	r5, r3, asr #16
 727              	.LVL57:
 728              		.loc 2 273 0
 729 0020 0510A0E1 		mov	r1, r5
 730 0024 60009FE5 		ldr	r0, .L100
 731              		.loc 2 272 0
 732              		.loc 2 273 0
 733 0028 FEFFFF4B 		blmi	printf
 734              	.L95:
 735              		.loc 2 275 0
 736 002c 660044E2 		sub	r0, r4, #102
 737 0030 0008A0E1 		mov	r0, r0, asl #16
 738 0034 4008A0E1 		mov	r0, r0, asr #16
 739 0038 FEFFFFEB 		bl	tpu_enq_at
 740              		.loc 2 277 0
 741 003c 1000A0E3 		mov	r0, #16
 742 0040 FEFFFFEB 		bl	twl3025_tsp_write
 743              		.loc 2 279 0
 744 0044 0000A0E3 		mov	r0, #0
 745 0048 FEFFFFEB 		bl	tpu_enq_wait
 746              		.loc 2 281 0
 747 004c 1800A0E3 		mov	r0, #24
 748 0050 FEFFFFEB 		bl	twl3025_tsp_write
 749              		.loc 2 283 0
 750 0054 3C00A0E3 		mov	r0, #60
 751 0058 FEFFFFEB 		bl	tpu_enq_wait
 752              		.loc 2 285 0
 753 005c 1000A0E3 		mov	r0, #16
 754 0060 FEFFFFEB 		bl	twl3025_tsp_write
 755              		.loc 2 287 0
 756 0064 0500A0E1 		mov	r0, r5
 757 0068 FEFFFFEB 		bl	tpu_enq_at
 758              		.loc 2 288 0
 759 006c 1400A0E3 		mov	r0, #20
 760 0070 1F0000EA 		b	.L99
 761              	.LVL58:
 762              	.L93:
 763              		.loc 2 290 0
 764 0074 FEFFFFEB 		bl	tpu_enq_at
 765              		.loc 2 291 0
 766 0078 1000A0E3 		mov	r0, #16
 767 007c FEFFFFEB 		bl	twl3025_tsp_write
 768              		.loc 2 293 0
 769 0080 0500A0E1 		mov	r0, r5
 770              	.LVL59:
 771              	.L99:
 772              		.loc 2 295 0
 773 0084 3040BDE8 		ldmfd	sp!, {r4, r5, lr}
 774              		.loc 2 293 0
 775 0088 FEFFFFEA 		b	twl3025_tsp_write
 776              	.LVL60:
 777              	.L101:
 778              		.align	2
 779              	.L100:
 780 008c 10000000 		.word	.LC1
 781              	.LFE23:
 783              		.section	.rodata.str1.4
 784 002b 00       		.align	2
 785              	.LC2:
 786 002c 42554C45 		.ascii	"BULENA time negative (%d)\012\000"
 786      4E412074 
 786      696D6520 
 786      6E656761 
 786      74697665 
 787              		.section	.text.twl3025_uplink,"ax",%progbits
 788              		.align	2
 789              		.global	twl3025_uplink
 791              	twl3025_uplink:
 792              	.LFB24:
 793              		.loc 2 301 0
 794              		@ args = 0, pretend = 0, frame = 0
 795              		@ frame_needed = 0, uses_anonymous_args = 0
 796              	.LVL61:
 797 0000 0128A0E1 		mov	r2, r1, asl #16
 798              		.loc 2 304 0
 799 0004 033742E2 		sub	r3, r2, #786432
 800              		.loc 2 301 0
 801 0008 70402DE9 		stmfd	sp!, {r4, r5, r6, lr}
 802              	.LCFI11:
 803              		.loc 2 304 0
 804 000c 4358B0E1 		movs	r5, r3, asr #16
 805              		.loc 2 301 0
 806 0010 0060A0E1 		mov	r6, r0
 807              		.loc 2 305 0
 808 0014 0510A0E1 		mov	r1, r5
 809              	.LVL62:
 810 0018 80009FE5 		ldr	r0, .L110
 811              	.LVL63:
 812              		.loc 2 302 0
 813 001c 2248A0E1 		mov	r4, r2, lsr #16
 814              	.LVL64:
 815              		.loc 2 304 0
 816              		.loc 2 305 0
 817 0020 FEFFFF4B 		blmi	printf
 818              	.L103:
 819              		.loc 2 308 0
 820 0024 E10044E2 		sub	r0, r4, #225
 821 0028 0008A0E1 		mov	r0, r0, asl #16
 822              		.loc 2 306 0
 823 002c 000056E3 		cmp	r6, #0
 824              		.loc 2 308 0
 825 0030 4008A0E1 		mov	r0, r0, asr #16
 826              		.loc 2 306 0
 827 0034 1D00000A 		beq	.L105
 828              		.loc 2 308 0
 829 0038 FEFFFFEB 		bl	tpu_enq_at
 830              		.loc 2 310 0
 831 003c 8000A0E3 		mov	r0, #128
 832 0040 FEFFFFEB 		bl	twl3025_tsp_write
 833              		.loc 2 312 0
 834 0044 0B00A0E3 		mov	r0, #11
 835 0048 FEFFFFEB 		bl	tpu_enq_wait
 836              		.loc 2 314 0
 837 004c C000A0E3 		mov	r0, #192
 838 0050 FEFFFFEB 		bl	twl3025_tsp_write
 839              		.loc 2 316 0
 840 0054 8900A0E3 		mov	r0, #137
 841 0058 FEFFFFEB 		bl	tpu_enq_wait
 842              		.loc 2 318 0
 843 005c 8000A0E3 		mov	r0, #128
 844 0060 FEFFFFEB 		bl	twl3025_tsp_write
 845              		.loc 2 320 0
 846 0064 2300A0E3 		mov	r0, #35
 847 0068 FEFFFFEB 		bl	tpu_enq_wait
 848              		.loc 2 321 0
 849 006c 0500A0E1 		mov	r0, r5
 850 0070 FEFFFFEB 		bl	tpu_enq_at
 851              		.loc 2 322 0
 852 0074 A000A0E3 		mov	r0, #160
 853 0078 240000EA 		b	.L109
 854              	.L105:
 855              		.loc 2 324 0
 856 007c 0500A0E1 		mov	r0, r5
 857 0080 FEFFFFEB 		bl	tpu_enq_at
 858              		.loc 2 325 0
 859 0084 8000A0E3 		mov	r0, #128
 860 0088 FEFFFFEB 		bl	twl3025_tsp_write
 861              		.loc 2 326 0
 862 008c 2300A0E3 		mov	r0, #35
 863 0090 FEFFFFEB 		bl	tpu_enq_wait
 864              		.loc 2 327 0
 865 0094 0600A0E1 		mov	r0, r6
 866              	.L109:
 867              		.loc 2 329 0
 868 0098 7040BDE8 		ldmfd	sp!, {r4, r5, r6, lr}
 869              		.loc 2 327 0
 870 009c FEFFFFEA 		b	twl3025_tsp_write
 871              	.L111:
 872              		.align	2
 873              	.L110:
 874 00a0 2C000000 		.word	.LC2
 875              	.LFE24:
 877              		.section	.rodata.str1.4
 878 0047 00       		.align	2
 879              	.LC3:
 880 0048 74776C33 		.ascii	"twl3025_afc_set(%d)\012\000"
 880      3032355F 
 880      6166635F 
 880      73657428 
 880      2564290A 
 881 005d 000000   		.section	.text.twl3025_afc_set,"ax",%progbits
 882              		.align	2
 883              		.global	twl3025_afc_set
 885              	twl3025_afc_set:
 886              	.LFB25:
 887              		.loc 2 332 0
 888              		@ args = 0, pretend = 0, frame = 0
 889              		@ frame_needed = 0, uses_anonymous_args = 0
 890              	.LVL65:
 891 0000 0038A0E1 		mov	r3, r0, asl #16
 892 0004 30402DE9 		stmfd	sp!, {r4, r5, lr}
 893              	.LCFI12:
 894              		.loc 2 333 0
 895 0008 4358A0E1 		mov	r5, r3, asr #16
 896 000c 0510A0E1 		mov	r1, r5
 897 0010 4C009FE5 		ldr	r0, .L118
 898              	.LVL66:
 899 0014 2348A0E1 		mov	r4, r3, lsr #16
 900              	.LVL67:
 901 0018 FEFFFFEB 		bl	printf
 902              		.loc 2 335 0
 903 001c 44309FE5 		ldr	r3, .L118+4
 904 0020 030055E1 		cmp	r5, r3
 905 0024 0340A0C1 		movgt	r4, r3
 906 0028 0B0000CA 		bgt	.L115
 907              		.loc 2 337 0
 908 002c 010A75E3 		cmn	r5, #4096
 909 0030 0F4AA0D3 		movle	r4, #61440
 910              	.L115:
 911              		.loc 2 341 0
 912 0034 0448A0E1 		mov	r4, r4, asl #16
 913              	.LVL68:
 914 0038 441DA0E1 		mov	r1, r4, asr #26
 915 003c 0118A0E1 		mov	r1, r1, asl #16
 916 0040 0800A0E3 		mov	r0, #8
 917 0044 2118A0E1 		mov	r1, r1, lsr #16
 918 0048 FEFFFFEB 		bl	twl3025_reg_write
 919              		.loc 2 342 0
 920 004c 2448A0E1 		mov	r4, r4, lsr #16
 921 0050 041BA0E1 		mov	r1, r4, asl #22
 922 0054 211BA0E1 		mov	r1, r1, lsr #22
 923 0058 0700A0E3 		mov	r0, #7
 924              		.loc 2 343 0
 925 005c 3040BDE8 		ldmfd	sp!, {r4, r5, lr}
 926              		.loc 2 342 0
 927 0060 FEFFFFEA 		b	twl3025_reg_write
 928              	.L119:
 929              		.align	2
 930              	.L118:
 931 0064 48000000 		.word	.LC3
 932 0068 FF0F0000 		.word	4095
 933              	.LFE25:
 935              		.section	.text.twl3025_afc_get,"ax",%progbits
 936              		.align	2
 937              		.global	twl3025_afc_get
 939              	twl3025_afc_get:
 940              	.LFB26:
 941              		.loc 2 346 0
 942              		@ args = 0, pretend = 0, frame = 0
 943              		@ frame_needed = 0, uses_anonymous_args = 0
 944              	.LVL69:
 945 0000 10402DE9 		stmfd	sp!, {r4, lr}
 946              	.LCFI13:
 947              		.loc 2 349 0
 948 0004 0800A0E3 		mov	r0, #8
 949 0008 FEFFFFEB 		bl	twl3025_reg_read
 950              		.loc 2 350 0
 951 000c 074000E2 		and	r4, r0, #7
 952              		.loc 2 351 0
 953 0010 0700A0E3 		mov	r0, #7
 954 0014 FEFFFFEB 		bl	twl3025_reg_read
 955              		.loc 2 350 0
 956 0018 0445A0E1 		mov	r4, r4, asl #10
 957              	.LVL70:
 958              		.loc 2 351 0
 959 001c 3F0BC0E3 		bic	r0, r0, #64512
 960 0020 004084E1 		orr	r4, r4, r0
 961              	.LVL71:
 962 0024 0448A0E1 		mov	r4, r4, asl #16
 963 0028 2408A0E1 		mov	r0, r4, lsr #16
 964              	.LVL72:
 965              		.loc 2 353 0
 966 002c 010A50E3 		cmp	r0, #4096
 967              		.loc 2 354 0
 968 0030 023A40A2 		subge	r3, r0, #8192
 969 0034 0338A0A1 		movge	r3, r3, asl #16
 970 0038 2308A0A1 		movge	r0, r3, lsr #16
 971 003c 0008A0E1 		mov	r0, r0, asl #16
 972              	.LVL73:
 973              		.loc 2 356 0
 974 0040 4008A0E1 		mov	r0, r0, asr #16
 975 0044 1080BDE8 		ldmfd	sp!, {r4, pc}
 976              	.LFE26:
 978              		.section	.text.twl3025_afcout_get,"ax",%progbits
 979              		.align	2
 980              		.global	twl3025_afcout_get
 982              	twl3025_afcout_get:
 983              	.LFB28:
 395:abb/twl3025.c **** 
 396:abb/twl3025.c **** uint8_t twl3025_afcout_get(void)
 397:abb/twl3025.c **** {
 984              		.loc 2 397 0
 985              		@ args = 0, pretend = 0, frame = 0
 986              		@ frame_needed = 0, uses_anonymous_args = 0
 987              	.LVL74:
 988 0000 04E02DE5 		str	lr, [sp, #-4]!
 989              	.LCFI14:
 398:abb/twl3025.c **** 	return twl3025_reg_read(AFCOUT) & 0xff;
 990              		.loc 2 398 0
 991 0004 9600A0E3 		mov	r0, #150
 992 0008 FEFFFFEB 		bl	twl3025_reg_read
 993 000c FF0000E2 		and	r0, r0, #255
 399:abb/twl3025.c **** }
 994              		.loc 2 399 0
 995 0010 04F09DE4 		ldr	pc, [sp], #4
 996              	.LFE28:
 998              		.section	.text.twl3025_afcout_set,"ax",%progbits
 999              		.align	2
 1000              		.global	twl3025_afcout_set
 1002              	twl3025_afcout_set:
 1003              	.LFB29:
 400:abb/twl3025.c **** 
 401:abb/twl3025.c **** void twl3025_afcout_set(uint8_t val)
 402:abb/twl3025.c **** {
 1004              		.loc 2 402 0
 1005              		@ args = 0, pretend = 0, frame = 0
 1006              		@ frame_needed = 0, uses_anonymous_args = 0
 1007              	.LVL75:
 1008 0000 10402DE9 		stmfd	sp!, {r4, lr}
 1009              	.LCFI15:
 403:abb/twl3025.c **** 	twl3025_reg_write(AFCCTLADD, 0x05);
 1010              		.loc 2 403 0
 1011 0004 0510A0E3 		mov	r1, #5
 1012              		.loc 2 402 0
 1013 0008 FF4000E2 		and	r4, r0, #255
 1014              		.loc 2 403 0
 1015 000c 9500A0E3 		mov	r0, #149
 1016              	.LVL76:
 1017 0010 FEFFFFEB 		bl	twl3025_reg_write
 404:abb/twl3025.c **** 	twl3025_reg_write(AFCOUT, val);
 1018              		.loc 2 404 0
 1019 0014 0410A0E1 		mov	r1, r4
 1020 0018 9600A0E3 		mov	r0, #150
 405:abb/twl3025.c **** }
 1021              		.loc 2 405 0
 1022 001c 1040BDE8 		ldmfd	sp!, {r4, lr}
 1023              		.loc 2 404 0
 1024 0020 FEFFFFEA 		b	twl3025_reg_write
 1025              	.LFE29:
 1027              		.bss
 1028              		.align	2
 1029              	twl3025_state:
 1030 0000 00000000 		.space	8
 1030      00000000 
 1338              	.Letext0:
DEFINED SYMBOLS
                            *ABS*:0000000000000000 twl3025.c
     /tmp/ccwXytif.s:15     .rodata:0000000000000000 twl3025_default_ramp
     /tmp/ccwXytif.s:35     .text.tpu_enq_at:0000000000000000 tpu_enq_at
     /tmp/ccwXytif.s:43     .text.tpu_enq_at:0000000000000000 $a
     /tmp/ccwXytif.s:95     .text.tpu_enq_at:0000000000000048 $d
     /tmp/ccwXytif.s:101    .text.tpu_enq_wait:0000000000000000 tpu_enq_wait
     /tmp/ccwXytif.s:108    .text.tpu_enq_wait:0000000000000000 $a
     /tmp/ccwXytif.s:124    .text.twl3025_reg_write:0000000000000000 twl3025_reg_write
     /tmp/ccwXytif.s:131    .text.twl3025_reg_write:0000000000000000 $a
     /tmp/ccwXytif.s:252    .text.twl3025_switch_page:0000000000000000 twl3025_switch_page
     /tmp/ccwXytif.s:178    .text.twl3025_reg_write:0000000000000064 $d
     /tmp/ccwXytif.s:1029   .bss:0000000000000000 twl3025_state
     /tmp/ccwXytif.s:185    .text.twl3025_unit_enable:0000000000000000 twl3025_unit_enable
     /tmp/ccwXytif.s:194    .text.twl3025_unit_enable:0000000000000000 $a
     /tmp/ccwXytif.s:199    .text.twl3025_unit_enable:000000000000000c $d
     /tmp/ccwXytif.s:205    .text.twl3025_unit_enable:0000000000000020 $a
     /tmp/ccwXytif.s:258    .text.twl3025_switch_page:0000000000000000 $a
     /tmp/ccwXytif.s:281    .text.twl3025_switch_page:000000000000002c $d
     /tmp/ccwXytif.s:288    .text.twl3025_tsp_write:0000000000000000 twl3025_tsp_write
     /tmp/ccwXytif.s:295    .text.twl3025_tsp_write:0000000000000000 $a
     /tmp/ccwXytif.s:312    .text.twl3025_reg_read:0000000000000000 twl3025_reg_read
     /tmp/ccwXytif.s:318    .text.twl3025_reg_read:0000000000000000 $a
     /tmp/ccwXytif.s:375    .text.twl3025_reg_read:000000000000007c $d
     /tmp/ccwXytif.s:382    .text.twl3025_power_off:0000000000000000 twl3025_power_off
     /tmp/ccwXytif.s:388    .text.twl3025_power_off:0000000000000000 $a
     /tmp/ccwXytif.s:420    .text.twl3025_irq:0000000000000000 twl3025_irq
     /tmp/ccwXytif.s:426    .text.twl3025_irq:0000000000000000 $a
     /tmp/ccwXytif.s:486    .text.twl3025_irq:0000000000000068 $d
     /tmp/ccwXytif.s:493    .text.twl3025_wait_ibic_access:0000000000000000 twl3025_wait_ibic_access
     /tmp/ccwXytif.s:501    .text.twl3025_wait_ibic_access:0000000000000000 $a
     /tmp/ccwXytif.s:513    .text.twl3025_clk13m:0000000000000000 twl3025_clk13m
     /tmp/ccwXytif.s:520    .text.twl3025_clk13m:0000000000000000 $a
     /tmp/ccwXytif.s:553    .text.twl3025_init:0000000000000000 twl3025_init
     /tmp/ccwXytif.s:559    .text.twl3025_init:0000000000000000 $a
     /tmp/ccwXytif.s:617    .text.twl3025_init:0000000000000094 $d
     /tmp/ccwXytif.s:625    .text.twl3025_get_pwon:0000000000000000 twl3025_get_pwon
     /tmp/ccwXytif.s:631    .text.twl3025_get_pwon:0000000000000000 $a
     /tmp/ccwXytif.s:665    .text.twl3025_get_pwon:0000000000000054 $d
     /tmp/ccwXytif.s:672    .text.twl3025_power_off_now:0000000000000000 twl3025_power_off_now
     /tmp/ccwXytif.s:682    .text.twl3025_power_off_now:0000000000000000 $a
     /tmp/ccwXytif.s:704    .text.twl3025_downlink:0000000000000000 twl3025_downlink
     /tmp/ccwXytif.s:710    .text.twl3025_downlink:0000000000000000 $a
     /tmp/ccwXytif.s:780    .text.twl3025_downlink:000000000000008c $d
     /tmp/ccwXytif.s:791    .text.twl3025_uplink:0000000000000000 twl3025_uplink
     /tmp/ccwXytif.s:797    .text.twl3025_uplink:0000000000000000 $a
     /tmp/ccwXytif.s:874    .text.twl3025_uplink:00000000000000a0 $d
     /tmp/ccwXytif.s:885    .text.twl3025_afc_set:0000000000000000 twl3025_afc_set
     /tmp/ccwXytif.s:891    .text.twl3025_afc_set:0000000000000000 $a
     /tmp/ccwXytif.s:931    .text.twl3025_afc_set:0000000000000064 $d
     /tmp/ccwXytif.s:939    .text.twl3025_afc_get:0000000000000000 twl3025_afc_get
     /tmp/ccwXytif.s:945    .text.twl3025_afc_get:0000000000000000 $a
     /tmp/ccwXytif.s:982    .text.twl3025_afcout_get:0000000000000000 twl3025_afcout_get
     /tmp/ccwXytif.s:988    .text.twl3025_afcout_get:0000000000000000 $a
     /tmp/ccwXytif.s:1002   .text.twl3025_afcout_set:0000000000000000 twl3025_afcout_set
     /tmp/ccwXytif.s:1008   .text.twl3025_afcout_set:0000000000000000 $a
                             .bss:0000000000000000 $d

UNDEFINED SYMBOLS
tpu_enqueue
spi_xfer
tsp_write
delay_ms
puts
spi_init
irq_register_handler
irq_config
irq_enable
printf
