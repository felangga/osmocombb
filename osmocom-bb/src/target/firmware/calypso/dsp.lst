   1              		.file	"dsp.c"
   9              	.Ltext0:
  10              		.global	dsp_api
  11              		.data
  12              		.align	2
  15              	dsp_api:
  16 0000 A801D0FF 		.word	-3145304
  17 0004 5000D0FF 		.word	-3145648
  18 0008 0000D0FF 		.word	-3145728
  19 000c 6208D0FF 		.word	-3143582
  20 0010 00000000 		.word	0
  21 0014 00000000 		.word	0
  22 0018 00000000 		.space	8
  22      00000000 
  23              		.section	.rodata
  24              		.align	2
  27              	dsp_dumpcode:
  28 0000 00100000 		.word	4096
  29 0004 5B000000 		.word	91
  30 0008 20000000 		.word	__compound_literal.0
  31 000c 00000000 		.word	0
  32 0010 00000000 		.word	0
  33 0014 00000000 		.word	0
  34              		.data
  35              		.align	1
  38              	__compound_literal.0:
  39 0020 F869     		.short	27128
  40 0022 2900     		.short	41
  41 0024 0200     		.short	2
  42 0026 1FEA     		.short	-5601
  43 0028 1877     		.short	30488
  44 002a 0011     		.short	4352
  45 002c 1477     		.short	30484
  46 002e 0000     		.short	0
  47 0030 1277     		.short	30482
  48 0032 0008     		.short	2048
  49 0034 7F76     		.short	30335
  50 0036 0100     		.short	1
  51 0038 7F60     		.short	24703
  52 003a FFFF     		.short	-1
  53 003c 20F8     		.short	-2016
  54 003e 1410     		.short	4116
  55 0040 73F2     		.short	-3469
  56 0042 0810     		.short	4104
  57 0044 8276     		.short	30338
  58 0046 0001     		.short	256
  59 0048 7F60     		.short	24703
  60 004a 0400     		.short	4
  61 004c 20F8     		.short	-2016
  62 004e 1C10     		.short	4124
  63 0050 73F2     		.short	-3469
  64 0052 0810     		.short	4104
  65 0054 1472     		.short	29204
  66 0056 0008     		.short	2048
  67 0058 7F60     		.short	24703
  68 005a 0200     		.short	2
  69 005c 20F8     		.short	-2016
  70 005e 0C10     		.short	4108
  71 0060 7E12     		.short	4734
  72 0062 1388     		.short	-30701
  73 0064 7C3C     		.short	15484
  74 0066 7D13     		.short	4989
  75 0068 1189     		.short	-30447
  76 006a 4CF8     		.short	-1972
  77 006c 2810     		.short	4136
  78 006e E2F4     		.short	-2846
  79 0070 1577     		.short	30485
  80 0072 1400     		.short	20
  81 0074 3D96     		.short	-27075
  82 0076 30FA     		.short	-1488
  83 0078 4B10     		.short	4171
  84 007a 896D     		.short	28041
  85 007c 3F96     		.short	-27073
  86 007e 30FA     		.short	-1488
  87 0080 3F10     		.short	4159
  88 0082 3E96     		.short	-27074
  89 0084 95F4     		.short	-2923
  90 0086 30F8     		.short	-2000
  91 0088 3A10     		.short	4154
  92 008a F847     		.short	18424
  93 008c 1100     		.short	17
  94 008e 927F     		.short	32658
  95 0090 73F0     		.short	-3981
  96 0092 0810     		.short	4104
  97 0094 F847     		.short	18424
  98 0096 1100     		.short	17
  99 0098 927E     		.short	32402
 100 009a 73F0     		.short	-3981
 101 009c 0810     		.short	4104
 102 009e 30F8     		.short	-2000
 103 00a0 4610     		.short	4166
 104 00a2 F847     		.short	18424
 105 00a4 1100     		.short	17
 106 00a6 89E5     		.short	-6775
 107 00a8 73F0     		.short	-3981
 108 00aa 0810     		.short	4104
 109 00ac F847     		.short	18424
 110 00ae 1100     		.short	17
 111 00b0 98E5     		.short	-6760
 112 00b2 73F0     		.short	-3981
 113 00b4 0810     		.short	4104
 114 00b6 1149     		.short	18705
 115 00b8 1A89     		.short	-30438
 116 00ba 30F8     		.short	-2000
 117 00bc 5510     		.short	4181
 118 00be 72F0     		.short	-3982
 119 00c0 5210     		.short	4178
 120 00c2 74F0     		.short	-3980
 121 00c4 1372     		.short	29203
 122 00c6 73F0     		.short	-3981
 123 00c8 0810     		.short	4104
 124 00ca 72F0     		.short	-3982
 125 00cc 5810     		.short	4184
 126 00ce 74F0     		.short	-3980
 127 00d0 B8E4     		.short	-6984
 128 00d2 73F0     		.short	-3981
 129 00d4 0810     		.short	4104
 130              		.bss
 131              		.align	2
 132              	dsp_bootcode:
 133 0000 00000000 		.space	4
 134              		.data
 135 00d6 0000     		.align	2
 138              	dsp_params:
 139 00d8 6666     		.short	26214
 140 00da 0F00     		.short	15
 141 00dc 0C00     		.short	12
 142 00de 0500     		.short	5
 143 00e0 0400     		.short	4
 144 00e2 0270     		.short	28674
 145 00e4 0100     		.short	1
 146 00e6 0E00     		.short	14
 147 00e8 0000     		.short	0
 148 00ea 0000     		.short	0
 149 00ec 0000     		.short	0
 150 00ee 0000     		.short	0
 151 00f0 1800     		.short	24
 152 00f2 1600     		.short	22
 153 00f4 2801     		.short	296
 154 00f6 1E00     		.short	30
 155 00f8 3333     		.short	13107
 156 00fa F628     		.short	10486
 157 00fc FF7F     		.short	32767
 158 00fe 0044     		.short	17408
 159 0100 0068     		.short	26624
 160 0102 B84E     		.short	20152
 161 0104 C01E     		.short	7872
 162 0106 FCFF     		.short	-4
 163 0108 C01E     		.short	7872
 164 010a 8C16     		.short	5772
 165 010c C01E     		.short	7872
 166 010e 3500     		.short	53
 167 0110 84FC     		.short	-892
 168 0112 D000     		.short	208
 169 0114 1000     		.short	16
 170 0116 4000     		.short	64
 171 0118 FA00     		.short	250
 172 011a 0A00     		.short	10
 173 011c FBFF     		.short	-5
 174 011e 6419     		.short	6500
 175 0120 6419     		.short	6500
 176 0122 3C0A     		.short	2620
 177 0124 740E     		.short	3700
 178 0126 B600     		.short	182
 179 0128 B8F9     		.short	-1608
 180 012a 3500     		.short	53
 181 012c FCFF     		.short	-4
 182 012e 401F     		.short	8000
 183 0130 401F     		.short	8000
 184 0132 AA11     		.short	4522
 185 0134 6419     		.short	6500
 186 0136 AE00     		.short	174
 187 0138 92FC     		.short	-878
 188 013a 3500     		.short	53
 189 013c 0F00     		.short	15
 190 013e E202     		.short	738
 191 0140 A406     		.short	1700
 192 0142 6300     		.short	99
 193 0144 2500     		.short	37
 194 0146 5801     		.short	344
 195 0148 3507     		.short	1845
 196 014a 7F08     		.short	2175
 197 014c 8A00     		.short	138
 198 014e 0F00     		.short	15
 199 0150 E202     		.short	738
 200 0152 CE04     		.short	1230
 201 0154 6300     		.short	99
 202 0156 2A12     		.short	4650
 203 0158 007C     		.short	31744
 204 015a 0F00     		.short	15
 205 015c 1700     		.short	23
 206 015e 8700     		.short	135
 207 0160 BF02     		.short	703
 208 0162 9C09     		.short	2460
 209 0164 9601     		.short	406
 210 0166 C814     		.short	5320
 211 0168 0000     		.short	0
 212 016a 0800     		.short	8
 213 016c 503F     		.short	16208
 214 016e 0040     		.short	16384
 215 0170 0500     		.short	5
 216 0172 0800     		.short	8
 217 0174 0000     		.short	0
 218 0176 00000000 		.space	134
 218      00000000 
 218      00000000 
 218      00000000 
 218      00000000 
 219              		.section	.rodata.str1.4,"aMS",%progbits,1
 220              		.align	2
 221              	.LC0:
 222 0000 44535020 		.ascii	"DSP Download Status: 0x%04x\012\000"
 222      446F776E 
 222      6C6F6164 
 222      20537461 
 222      7475733A 
 223 001d 000000   		.align	2
 224              	.LC1:
 225 0020 44535020 		.ascii	"DSP API Version: 0x%04x 0x%04x\012\000"
 225      41504920 
 225      56657273 
 225      696F6E3A 
 225      20307825 
 226              		.section	.text.dsp_dump_version,"ax",%progbits
 227              		.align	2
 228              		.global	dsp_dump_version
 230              	dsp_dump_version:
 231              	.LFB14:
 232              		.file 1 "calypso/dsp.c"
   1:calypso/dsp.c **** #define DEBUG
   2:calypso/dsp.c **** /* Driver for the Calypso integrated DSP */
   3:calypso/dsp.c **** 
   4:calypso/dsp.c **** /* (C) 2010 by Harald Welte <laforge@gnumonks.org>
   5:calypso/dsp.c ****  *
   6:calypso/dsp.c ****  * All Rights Reserved
   7:calypso/dsp.c ****  *
   8:calypso/dsp.c ****  * This program is free software; you can redistribute it and/or modify
   9:calypso/dsp.c ****  * it under the terms of the GNU General Public License as published by
  10:calypso/dsp.c ****  * the Free Software Foundation; either version 2 of the License, or
  11:calypso/dsp.c ****  * (at your option) any later version.
  12:calypso/dsp.c ****  *
  13:calypso/dsp.c ****  * This program is distributed in the hope that it will be useful,
  14:calypso/dsp.c ****  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  15:calypso/dsp.c ****  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  16:calypso/dsp.c ****  * GNU General Public License for more details.
  17:calypso/dsp.c ****  *
  18:calypso/dsp.c ****  * You should have received a copy of the GNU General Public License along
  19:calypso/dsp.c ****  * with this program; if not, write to the Free Software Foundation, Inc.,
  20:calypso/dsp.c ****  * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
  21:calypso/dsp.c ****  *
  22:calypso/dsp.c ****  */
  23:calypso/dsp.c **** 
  24:calypso/dsp.c **** #include <stdint.h>
  25:calypso/dsp.c **** #include <stdio.h>
  26:calypso/dsp.c **** 
  27:calypso/dsp.c **** #include <debug.h>
  28:calypso/dsp.c **** #include <delay.h>
  29:calypso/dsp.c **** #include <memory.h>
  30:calypso/dsp.c **** #include <calypso/clock.h>
  31:calypso/dsp.c **** #include <calypso/dsp.h>
  32:calypso/dsp.c **** #include <calypso/dsp_api.h>
  33:calypso/dsp.c **** #include <calypso/tpu.h>
  34:calypso/dsp.c **** 
  35:calypso/dsp.c **** #include <abb/twl3025.h>
  36:calypso/dsp.c **** 
  37:calypso/dsp.c **** #include <osmocom/gsm/gsm_utils.h>
  38:calypso/dsp.c **** 
  39:calypso/dsp.c **** 
  40:calypso/dsp.c **** #define REG_API_CONTROL		0xfffe0000
  41:calypso/dsp.c **** #define APIC_R_SMODE_HOM	(1 << 1)	/* API is configured in HOM mode */
  42:calypso/dsp.c **** #define APIC_R_HINT		(1 << 3)	/* Host processor interrupt (DSP->MCU) */
  43:calypso/dsp.c **** #define APIC_W_DSPINT		(1 << 2)	/* ARM issues interrupt to DSP */
  44:calypso/dsp.c **** 
  45:calypso/dsp.c **** #define REG_API_WS		0xfffff902	/* Number of wait states for ARM access to API memory */
  46:calypso/dsp.c **** #define REG_ARM_RHEA_CTL	0xfffff904	/* Write buffer bypassing */
  47:calypso/dsp.c **** #define REG_EXT_RHEA_CTL	0xfffff906	/* Some timeout */
  48:calypso/dsp.c **** 
  49:calypso/dsp.c **** #define API_SIZE		0x2000U		/* in words */
  50:calypso/dsp.c **** 
  51:calypso/dsp.c **** #define BASE_API_RAM		0xffd00000	/* Base address of API RAM from ARM point of view */
  52:calypso/dsp.c **** 
  53:calypso/dsp.c **** #define DSP_BASE_API		0x0800		/* Base address of API RAM for DSP */
  54:calypso/dsp.c **** #define DSP_BASE_API_MIRROR	0xe000		/* Base address of API RAM for DSP (API boot mirror) */
  55:calypso/dsp.c **** #define DSP_START		0x7000		/* DSP Start address */
  56:calypso/dsp.c **** 
  57:calypso/dsp.c **** /* Boot loader */
  58:calypso/dsp.c **** #define BL_CMD_STATUS		(BASE_API_RAM + 0x0ffe)	/* Status / Command var    */
  59:calypso/dsp.c **** #define BL_ADDR_LO		(BASE_API_RAM + 0x0ffc)	/* Address (16 lsbs)       */
  60:calypso/dsp.c **** #define BL_ADDR_HI		(BASE_API_RAM + 0x0ff8)	/* Address (ext page bits) */
  61:calypso/dsp.c **** #define BL_SIZE			(BASE_API_RAM + 0x0ffa) /* Size                    */
  62:calypso/dsp.c **** 
  63:calypso/dsp.c **** #define BL_MAX_BLOCK_SIZE	0x7F0			/* Maximum size of copied block */
  64:calypso/dsp.c **** 
  65:calypso/dsp.c **** 	/* Possible values for the download status */
  66:calypso/dsp.c **** #define BL_STATUS_NA		0
  67:calypso/dsp.c **** #define BL_STATUS_IDLE		1
  68:calypso/dsp.c **** #define BL_CMD_COPY_BLOCK	2
  69:calypso/dsp.c **** #define BL_CMD_COPY_MODE	4
  70:calypso/dsp.c **** 
  71:calypso/dsp.c **** #define BL_MODE_PROG_WRITE	0
  72:calypso/dsp.c **** #define BL_MODE_DATA_WRITE	1
  73:calypso/dsp.c **** #define BL_MODE_PROG_READ	2
  74:calypso/dsp.c **** #define BL_MODE_DATA_READ	3
  75:calypso/dsp.c **** #define BL_MODE_PROM_READ	4
  76:calypso/dsp.c **** #define BL_MODE_DROM_READ	5
  77:calypso/dsp.c **** 
  78:calypso/dsp.c **** 
  79:calypso/dsp.c **** struct dsp_section {
  80:calypso/dsp.c **** 	uint32_t addr;		/* addr for DSP  */
  81:calypso/dsp.c **** 	uint32_t size;		/* size in words */
  82:calypso/dsp.c **** 	const uint16_t *data;
  83:calypso/dsp.c **** };
  84:calypso/dsp.c **** 
  85:calypso/dsp.c **** #include "dsp_params.c"
  86:calypso/dsp.c **** #include "dsp_bootcode.c"
  87:calypso/dsp.c **** #include "dsp_dumpcode.c"
  88:calypso/dsp.c **** 
  89:calypso/dsp.c **** struct dsp_api dsp_api = {
  90:calypso/dsp.c **** 	.ndb	= (T_NDB_MCU_DSP *) BASE_API_NDB,
  91:calypso/dsp.c **** 	.db_r	= (T_DB_DSP_TO_MCU *) BASE_API_R_PAGE_0,
  92:calypso/dsp.c **** 	.db_w	= (T_DB_MCU_TO_DSP *) BASE_API_W_PAGE_0,
  93:calypso/dsp.c **** 	.param	= (T_PARAM_MCU_DSP *) BASE_API_PARAM,
  94:calypso/dsp.c **** 	.r_page	= 0,
  95:calypso/dsp.c **** 	.w_page = 0,
  96:calypso/dsp.c **** };
  97:calypso/dsp.c **** 
  98:calypso/dsp.c **** 
  99:calypso/dsp.c **** void dsp_dump_version(void)
 100:calypso/dsp.c **** {
 233              		.loc 1 100 0
 234              		@ args = 0, pretend = 0, frame = 0
 235              		@ frame_needed = 0, uses_anonymous_args = 0
 236              	.LVL0:
 237 0000 04E02DE5 		str	lr, [sp, #-4]!
 238              	.LCFI0:
 101:calypso/dsp.c **** 	printf("DSP Download Status: 0x%04x\n", readw(BL_CMD_STATUS));
 239              		.loc 1 101 0
 240 0004 24309FE5 		ldr	r3, .L3
 241 0008 24009FE5 		ldr	r0, .L3+4
 242 000c B010D3E1 		ldrh	r1, [r3, #0]
 243 0010 FEFFFFEB 		bl	printf
 102:calypso/dsp.c **** 	printf("DSP API Version: 0x%04x 0x%04x\n",
 244              		.loc 1 102 0
 245 0014 1C309FE5 		ldr	r3, .L3+8
 246 0018 003093E5 		ldr	r3, [r3, #0]
 247 001c 18009FE5 		ldr	r0, .L3+12
 248 0020 BE20D3E1 		ldrh	r2, [r3, #14]
 249 0024 BC10D3E1 		ldrh	r1, [r3, #12]
 103:calypso/dsp.c **** 		dsp_api.ndb->d_version_number1, dsp_api.ndb->d_version_number2);
 104:calypso/dsp.c **** }
 250              		.loc 1 104 0
 251 0028 04E09DE4 		ldr	lr, [sp], #4
 252              		.loc 1 102 0
 253 002c FEFFFFEA 		b	printf
 254              	.L4:
 255              		.align	2
 256              	.L3:
 257 0030 FE0FD0FF 		.word	-3141634
 258 0034 00000000 		.word	.LC0
 259 0038 00000000 		.word	dsp_api
 260 003c 20000000 		.word	.LC1
 261              	.LFE14:
 263              		.section	.text.dsp_upload_sections_api,"ax",%progbits
 264              		.align	2
 266              	dsp_upload_sections_api:
 267              	.LFB18:
 105:calypso/dsp.c **** 
 106:calypso/dsp.c **** static void dsp_bl_wait_ready(void)
 107:calypso/dsp.c **** {
 108:calypso/dsp.c **** 	while (readw(BL_CMD_STATUS) != BL_STATUS_IDLE);
 109:calypso/dsp.c **** }
 110:calypso/dsp.c **** 
 111:calypso/dsp.c **** static void dsp_bl_start_at(uint16_t addr)
 112:calypso/dsp.c **** {
 113:calypso/dsp.c **** 	writew(0, BL_ADDR_HI);
 114:calypso/dsp.c **** 	writew(addr, BL_ADDR_LO);
 115:calypso/dsp.c **** 	writew(0, BL_SIZE);
 116:calypso/dsp.c **** 	writew(BL_CMD_COPY_BLOCK, BL_CMD_STATUS);
 117:calypso/dsp.c **** }
 118:calypso/dsp.c **** 
 119:calypso/dsp.c **** static int dsp_bl_upload_sections(const struct dsp_section *sec)
 120:calypso/dsp.c **** {
 121:calypso/dsp.c **** 	/* Make sure the bootloader is ready */
 122:calypso/dsp.c **** 	dsp_bl_wait_ready();
 123:calypso/dsp.c **** 
 124:calypso/dsp.c **** 	/* Set mode */
 125:calypso/dsp.c **** 	writew(BL_MODE_DATA_WRITE, BASE_API_RAM);
 126:calypso/dsp.c **** 	writew(BL_CMD_COPY_MODE, BL_CMD_STATUS);
 127:calypso/dsp.c **** 	dsp_bl_wait_ready();
 128:calypso/dsp.c **** 
 129:calypso/dsp.c **** 	/* Scan all sections */
 130:calypso/dsp.c **** 	for (; sec->data; sec++) {
 131:calypso/dsp.c **** 		volatile uint16_t *api = (volatile uint16_t *)BASE_API_RAM;
 132:calypso/dsp.c **** 		unsigned int i;
 133:calypso/dsp.c **** 
 134:calypso/dsp.c **** 		if (sec->size > BL_MAX_BLOCK_SIZE)
 135:calypso/dsp.c **** 			return -1; /* not supported for now */
 136:calypso/dsp.c **** 
 137:calypso/dsp.c **** 		/* Copy data to API */
 138:calypso/dsp.c **** 		for (i=0; i<sec->size; i++)
 139:calypso/dsp.c **** 			api[i] = sec->data[i];
 140:calypso/dsp.c **** 
 141:calypso/dsp.c **** 		/* Issue DRAM write */
 142:calypso/dsp.c **** 		writew(sec->addr >> 16, BL_ADDR_HI);
 143:calypso/dsp.c **** 		writew(sec->addr & 0xffff, BL_ADDR_LO);
 144:calypso/dsp.c **** 		writew(sec->size, BL_SIZE);
 145:calypso/dsp.c **** 		writew(BL_CMD_COPY_BLOCK, BL_CMD_STATUS);
 146:calypso/dsp.c **** 
 147:calypso/dsp.c **** 		/* Wait for completion */
 148:calypso/dsp.c **** 		dsp_bl_wait_ready();
 149:calypso/dsp.c **** 	}
 150:calypso/dsp.c **** 
 151:calypso/dsp.c **** 	return 0;
 152:calypso/dsp.c **** }
 153:calypso/dsp.c **** 
 154:calypso/dsp.c **** static int dsp_upload_sections_api(const struct dsp_section *sec, uint16_t dsp_base_api)
 155:calypso/dsp.c **** {
 268              		.loc 1 155 0
 269              		@ args = 0, pretend = 0, frame = 0
 270              		@ frame_needed = 0, uses_anonymous_args = 0
 271              	.LVL1:
 272 0000 30402DE9 		stmfd	sp!, {r4, r5, lr}
 273              	.LCFI1:
 274              		.loc 1 155 0
 275 0004 0118A0E1 		mov	r1, r1, asl #16
 276              	.LVL2:
 277 0008 0040A0E1 		mov	r4, r0
 278 000c 2118A0E1 		mov	r1, r1, lsr #16
 279              	.LVL3:
 280 0010 1A0000EA 		b	.L6
 281              	.LVL4:
 282              	.L7:
 283              	.LBB2:
 156:calypso/dsp.c **** 	for (; sec->data; sec++) {
 157:calypso/dsp.c **** 		unsigned int i;
 158:calypso/dsp.c **** 		volatile uint16_t *dptr;
 159:calypso/dsp.c **** 
 160:calypso/dsp.c **** 		if (sec->addr & ~((1<<16)-1))	/* 64k max addr */
 284              		.loc 1 160 0
 285 0014 00C094E5 		ldr	ip, [r4, #0]
 286              	.LVL5:
 287 0018 2CE8A0E1 		mov	lr, ip, lsr #16
 288 001c 0EE8A0E1 		mov	lr, lr, asl #16
 289 0020 00005EE3 		cmp	lr, #0
 290 0024 1E00001A 		bne	.L8
 161:calypso/dsp.c **** 			return -1;
 162:calypso/dsp.c **** 		if (sec->addr < dsp_base_api)
 291              		.loc 1 162 0
 292 0028 01005CE1 		cmp	ip, r1
 293 002c 1E00003A 		bcc	.L8
 163:calypso/dsp.c **** 			return -1;
 164:calypso/dsp.c **** 		if ((sec->addr + sec->size) > (dsp_base_api + API_SIZE))
 294              		.loc 1 164 0
 295 0030 045094E5 		ldr	r5, [r4, #4]
 296 0034 022A81E2 		add	r2, r1, #8192
 297              	.LVL6:
 298 0038 05308CE0 		add	r3, ip, r5
 299 003c 020053E1 		cmp	r3, r2
 300 0040 1E00008A 		bhi	.L8
 165:calypso/dsp.c **** 			return -1;
 166:calypso/dsp.c **** 
 167:calypso/dsp.c **** 		dptr = (volatile uint16_t *)(BASE_API_RAM + ((sec->addr - dsp_base_api) * sizeof(uint16_t)));
 301              		.loc 1 167 0
 302 0044 0C3061E0 		rsb	r3, r1, ip
 303 0048 8330A0E1 		mov	r3, r3, asl #1
 304 004c 03C643E2 		sub	ip, r3, #3145728
 305              	.LVL7:
 306 0050 0E20A0E1 		mov	r2, lr
 307              	.LVL8:
 308 0054 160000EA 		b	.L12
 309              	.L13:
 168:calypso/dsp.c **** 		for (i=0; i<sec->size; i++)
 169:calypso/dsp.c **** 			*dptr++ = sec->data[i];
 310              		.loc 1 169 0
 311 0058 B230D0E0 		ldrh	r3, [r0], #2
 312 005c B230CCE0 		strh	r3, [ip], #2	@ movhi
 313              	.L12:
 314              		.loc 1 168 0
 315 0060 050052E1 		cmp	r2, r5
 316 0064 012082E2 		add	r2, r2, #1
 317 0068 1400003A 		bcc	.L13
 318              	.LBE2:
 319              		.loc 1 156 0
 320 006c 0C4084E2 		add	r4, r4, #12
 321              	.LVL9:
 322              	.L6:
 323 0070 080094E5 		ldr	r0, [r4, #8]
 324 0074 000050E3 		cmp	r0, #0
 325 0078 0300001A 		bne	.L7
 326 007c 3080BDE8 		ldmfd	sp!, {r4, r5, pc}
 327              	.LVL10:
 328              	.L8:
 329 0080 0000E0E3 		mvn	r0, #0
 170:calypso/dsp.c **** 	}
 171:calypso/dsp.c **** 
 172:calypso/dsp.c **** 	/* FIXME need eioio or wb ? */
 173:calypso/dsp.c **** 
 174:calypso/dsp.c **** 	return 0;
 175:calypso/dsp.c **** }
 330              		.loc 1 175 0
 331 0084 3080BDE8 		ldmfd	sp!, {r4, r5, pc}
 332              	.LFE18:
 334              		.section	.text.dsp_api_memset,"ax",%progbits
 335              		.align	2
 336              		.global	dsp_api_memset
 338              	dsp_api_memset:
 339              	.LFB21:
 176:calypso/dsp.c **** 
 177:calypso/dsp.c **** static void dsp_pre_boot(const struct dsp_section *bootcode)
 178:calypso/dsp.c **** {
 179:calypso/dsp.c **** 	dputs("Assert DSP into Reset\n");
 180:calypso/dsp.c **** 	calypso_reset_set(RESET_DSP, 1);
 181:calypso/dsp.c **** 
 182:calypso/dsp.c **** 	if (bootcode) {
 183:calypso/dsp.c **** 		dputs("Loading initial DSP bootcode (API boot mode)\n");
 184:calypso/dsp.c **** 		dsp_upload_sections_api(bootcode, DSP_BASE_API_MIRROR);
 185:calypso/dsp.c **** 
 186:calypso/dsp.c **** 		writew(BL_STATUS_NA, BL_CMD_STATUS);
 187:calypso/dsp.c **** 	} else
 188:calypso/dsp.c **** 		delay_ms(10);
 189:calypso/dsp.c **** 
 190:calypso/dsp.c **** 	dputs("Releasing DSP from Reset\n");
 191:calypso/dsp.c **** 	calypso_reset_set(RESET_DSP, 0);
 192:calypso/dsp.c **** 
 193:calypso/dsp.c **** 	/* Wait 10 us */
 194:calypso/dsp.c **** 	delay_ms(100);
 195:calypso/dsp.c **** 
 196:calypso/dsp.c **** 	dsp_bl_wait_ready();
 197:calypso/dsp.c **** }
 198:calypso/dsp.c **** 
 199:calypso/dsp.c **** static void dsp_set_params(int16_t *param_tab, int param_size)
 200:calypso/dsp.c **** {
 201:calypso/dsp.c **** 	int i;
 202:calypso/dsp.c **** 	int16_t *param_ptr = (int16_t *) BASE_API_PARAM;
 203:calypso/dsp.c **** 
 204:calypso/dsp.c **** 	/* Start DSP up to bootloader */
 205:calypso/dsp.c **** 	dsp_pre_boot(dsp_bootcode);
 206:calypso/dsp.c **** 
 207:calypso/dsp.c **** 	/* FIXME: Implement Patch download, if any */
 208:calypso/dsp.c **** 
 209:calypso/dsp.c **** 	dputs("Setting some dsp_api.ndb values\n");
 210:calypso/dsp.c **** 	dsp_api.ndb->d_background_enable = 0;
 211:calypso/dsp.c **** 	dsp_api.ndb->d_background_abort = 0;
 212:calypso/dsp.c **** 	dsp_api.ndb->d_background_state = 0;
 213:calypso/dsp.c **** 	dsp_api.ndb->d_debug_ptr = 0x0074;
 214:calypso/dsp.c **** 	dsp_api.ndb->d_debug_bk = 0x0001;
 215:calypso/dsp.c **** 	dsp_api.ndb->d_pll_config = 0x154; //C_PLL_CONFIG;
 216:calypso/dsp.c **** 	dsp_api.ndb->p_debug_buffer = 0x17ff; //C_DEBUG_BUFFER_ADD;
 217:calypso/dsp.c **** 	dsp_api.ndb->d_debug_buffer_size = 7; //C_DEBUG_BUFFER_SIZE;
 218:calypso/dsp.c **** 	dsp_api.ndb->d_debug_trace_type = 0; //C_DEBUG_TRACE_TYPE;
 219:calypso/dsp.c **** 	dsp_api.ndb->d_dsp_state = 3; //C_DSP_IDLE3;
 220:calypso/dsp.c **** 	dsp_api.ndb->d_audio_gain_ul = 0;
 221:calypso/dsp.c **** 	dsp_api.ndb->d_audio_gain_dl = 0;
 222:calypso/dsp.c **** 	dsp_api.ndb->d_es_level_api = 0x5213;
 223:calypso/dsp.c **** 	dsp_api.ndb->d_mu_api = 0x5000;
 224:calypso/dsp.c **** 
 225:calypso/dsp.c **** 	dputs("Setting API NDB parameters\n");
 226:calypso/dsp.c **** 	for (i = 0; i < param_size; i ++)
 227:calypso/dsp.c **** 		*param_ptr++ = param_tab[i];
 228:calypso/dsp.c **** 	
 229:calypso/dsp.c **** 	dsp_dump_version();
 230:calypso/dsp.c **** 
 231:calypso/dsp.c **** 	dputs("Finishing download phase\n");
 232:calypso/dsp.c **** 	dsp_bl_start_at(DSP_START);
 233:calypso/dsp.c **** 
 234:calypso/dsp.c **** 	dsp_dump_version();
 235:calypso/dsp.c **** }
 236:calypso/dsp.c **** 
 237:calypso/dsp.c **** void dsp_api_memset(uint16_t *ptr, int octets)
 238:calypso/dsp.c **** {
 340              		.loc 1 238 0
 341              		@ args = 0, pretend = 0, frame = 0
 342              		@ frame_needed = 0, uses_anonymous_args = 0
 343              		@ link register save eliminated.
 344              	.LVL11:
 345 0000 00C0A0E3 		mov	ip, #0
 346              		@ lr needed for prologue
 347 0004 020000EA 		b	.L19
 348              	.LVL12:
 349              	.L20:
 239:calypso/dsp.c **** 	uint16_t i;
 240:calypso/dsp.c **** 	for (i = 0; i < octets / sizeof(uint16_t); i++)
 241:calypso/dsp.c **** 		*ptr++ = 0;
 350              		.loc 1 241 0
 351 0008 0030A0E3 		mov	r3, #0	@ movhi
 352 000c B23040E1 		strh	r3, [r0, #-2]	@ movhi
 353              	.LVL13:
 354              	.L19:
 355              		.loc 1 240 0
 356 0010 0C28A0E1 		mov	r2, ip, asl #16
 357 0014 A130A0E1 		mov	r3, r1, lsr #1
 358 0018 220853E1 		cmp	r3, r2, lsr #16
 359              	.LVL14:
 360 001c 020080E2 		add	r0, r0, #2
 361 0020 01C08CE2 		add	ip, ip, #1
 362 0024 0000008A 		bhi	.L20
 242:calypso/dsp.c **** }
 363              		.loc 1 242 0
 364 0028 1EFF2FE1 		bx	lr
 365              	.LFE21:
 367              		.section	.text.dsp_memcpy_to_api,"ax",%progbits
 368              		.align	2
 369              		.global	dsp_memcpy_to_api
 371              	dsp_memcpy_to_api:
 372              	.LFB22:
 243:calypso/dsp.c **** 
 244:calypso/dsp.c **** /* memcpy from RAM to DSP API, 16 bits by 16 bits. If odd byte count, last word will
 245:calypso/dsp.c ****  * be zero filled */
 246:calypso/dsp.c **** void dsp_memcpy_to_api(volatile uint16_t *dsp_buf, const uint8_t *mcu_buf, int n, int be)
 247:calypso/dsp.c **** {
 373              		.loc 1 247 0
 374              		@ args = 0, pretend = 0, frame = 0
 375              		@ frame_needed = 0, uses_anonymous_args = 0
 376              	.LVL15:
 248:calypso/dsp.c **** 	int odd, i;
 249:calypso/dsp.c **** 
 250:calypso/dsp.c **** 	odd = n & 1;
 251:calypso/dsp.c **** 	n >>= 1;
 252:calypso/dsp.c **** 
 253:calypso/dsp.c **** 	if (be) {
 377              		.loc 1 253 0
 378 0000 000053E3 		cmp	r3, #0
 379              		.loc 1 247 0
 380 0004 10402DE9 		stmfd	sp!, {r4, lr}
 381              	.LCFI2:
 382              		.loc 1 253 0
 383 0008 03C0A001 		moveq	ip, r3
 384              	.LVL16:
 385              		.loc 1 251 0
 386 000c C2E0A0E1 		mov	lr, r2, asr #1
 387              	.LVL17:
 388              		.loc 1 250 0
 389 0010 014002E2 		and	r4, r2, #1
 390              	.LVL18:
 391              		.loc 1 253 0
 392 0014 00C0A013 		movne	ip, #0
 393              	.LVL19:
 394 0018 0B00001A 		bne	.L27
 395 001c 180000EA 		b	.L26
 396              	.LVL20:
 397              	.L28:
 398              	.LBB3:
 254:calypso/dsp.c **** 		for (i=0; i<n; i++) {
 255:calypso/dsp.c **** 			uint16_t w;
 256:calypso/dsp.c **** 			w  = *(mcu_buf++) << 8;
 399              		.loc 1 256 0
 400 0020 0020D1E5 		ldrb	r2, [r1, #0]	@ zero_extendqisi2
 401              	.LVL21:
 257:calypso/dsp.c **** 			w |= *(mcu_buf++);
 402              		.loc 1 257 0
 403 0024 0130D1E5 		ldrb	r3, [r1, #1]	@ zero_extendqisi2
 404              	.LVL22:
 405 0028 023483E1 		orr	r3, r3, r2, asl #8
 406              	.LVL23:
 258:calypso/dsp.c **** 			*(dsp_buf++) = w;
 407              		.loc 1 258 0
 408 002c B230C0E0 		strh	r3, [r0], #2	@ movhi
 409              		.loc 1 257 0
 410 0030 021081E2 		add	r1, r1, #2
 411              	.LVL24:
 412              	.L27:
 413              	.LBE3:
 414              		.loc 1 254 0
 415 0034 0E005CE1 		cmp	ip, lr
 416 0038 01C08CE2 		add	ip, ip, #1
 417 003c 060000BA 		blt	.L28
 259:calypso/dsp.c **** 		}
 260:calypso/dsp.c **** 		if (odd)
 418              		.loc 1 260 0
 419 0040 000054E3 		cmp	r4, #0
 261:calypso/dsp.c **** 			*dsp_buf = *mcu_buf << 8;
 420              		.loc 1 261 0
 421 0044 0030D115 		ldrneb	r3, [r1, #0]	@ zero_extendqisi2
 422              	.LVL25:
 423 0048 0334A011 		movne	r3, r3, asl #8
 424              		.loc 1 260 0
 425 004c 1080BD08 		ldmeqfd	sp!, {r4, pc}
 426 0050 1E0000EA 		b	.L36
 427              	.LVL26:
 428              	.L32:
 429              	.LBB4:
 262:calypso/dsp.c **** 	} else {
 263:calypso/dsp.c **** 		for (i=0; i<n; i++) {
 264:calypso/dsp.c **** 			uint16_t w;
 265:calypso/dsp.c **** 			w  = *(mcu_buf++);
 266:calypso/dsp.c **** 			w |= *(mcu_buf++) << 8;
 430              		.loc 1 266 0
 431 0054 0030D1E5 		ldrb	r3, [r1, #0]	@ zero_extendqisi2
 432              	.LVL27:
 433 0058 0120D1E5 		ldrb	r2, [r1, #1]	@ zero_extendqisi2
 434              	.LVL28:
 435 005c 023483E1 		orr	r3, r3, r2, asl #8
 436              	.LVL29:
 267:calypso/dsp.c **** 			*(dsp_buf++) = w;
 437              		.loc 1 267 0
 438 0060 B230C0E0 		strh	r3, [r0], #2	@ movhi
 439              		.loc 1 266 0
 440 0064 021081E2 		add	r1, r1, #2
 441              	.LVL30:
 442              	.L26:
 443              	.LVL31:
 444              	.LBE4:
 445              		.loc 1 263 0
 446 0068 0E005CE1 		cmp	ip, lr
 447 006c 01C08CE2 		add	ip, ip, #1
 448 0070 130000BA 		blt	.L32
 268:calypso/dsp.c **** 		}
 269:calypso/dsp.c **** 		if (odd)
 449              		.loc 1 269 0
 450 0074 000054E3 		cmp	r4, #0
 451 0078 1080BD08 		ldmeqfd	sp!, {r4, pc}
 270:calypso/dsp.c **** 			*dsp_buf = *mcu_buf;
 452              		.loc 1 270 0
 453 007c 0030D1E5 		ldrb	r3, [r1, #0]	@ zero_extendqisi2
 454              	.LVL32:
 455              	.L36:
 456 0080 B030C0E1 		strh	r3, [r0, #0]	@ movhi
 457 0084 1080BDE8 		ldmfd	sp!, {r4, pc}
 458              	.LFE22:
 460              		.section	.text.dsp_memcpy_from_api,"ax",%progbits
 461              		.align	2
 462              		.global	dsp_memcpy_from_api
 464              	dsp_memcpy_from_api:
 465              	.LFB23:
 271:calypso/dsp.c **** 	}
 272:calypso/dsp.c **** }
 273:calypso/dsp.c **** 
 274:calypso/dsp.c **** /* memcpy from DSP API to RAM, accessing API 16 bits word at a time */
 275:calypso/dsp.c **** void dsp_memcpy_from_api(uint8_t *mcu_buf, const volatile uint16_t *dsp_buf, int n, int be)
 276:calypso/dsp.c **** {
 466              		.loc 1 276 0
 467              		@ args = 0, pretend = 0, frame = 0
 468              		@ frame_needed = 0, uses_anonymous_args = 0
 469              	.LVL33:
 277:calypso/dsp.c **** 	int odd, i;
 278:calypso/dsp.c **** 
 279:calypso/dsp.c **** 	odd = n & 1;
 280:calypso/dsp.c **** 	n >>= 1;
 281:calypso/dsp.c **** 
 282:calypso/dsp.c **** 	if (be) {
 470              		.loc 1 282 0
 471 0000 000053E3 		cmp	r3, #0
 472              		.loc 1 276 0
 473 0004 10402DE9 		stmfd	sp!, {r4, lr}
 474              	.LCFI3:
 475              		.loc 1 282 0
 476 0008 03C0A001 		moveq	ip, r3
 477              	.LVL34:
 478              		.loc 1 280 0
 479 000c C2E0A0E1 		mov	lr, r2, asr #1
 480              	.LVL35:
 481              		.loc 1 279 0
 482 0010 014002E2 		and	r4, r2, #1
 483              	.LVL36:
 484              		.loc 1 282 0
 485 0014 00C0A013 		movne	ip, #0
 486              	.LVL37:
 487 0018 0D00001A 		bne	.L41
 488 001c 190000EA 		b	.L40
 489              	.LVL38:
 490              	.L42:
 491              	.LBB5:
 283:calypso/dsp.c **** 		for (i=0; i<n; i++) {
 284:calypso/dsp.c **** 			uint16_t w = *(dsp_buf++);
 492              		.loc 1 284 0
 493 0020 B230D1E0 		ldrh	r3, [r1], #2
 494              	.LVL39:
 495 0024 0338A0E1 		mov	r3, r3, asl #16
 285:calypso/dsp.c **** 			*(mcu_buf++) = w >> 8;
 496              		.loc 1 285 0
 497 0028 232CA0E1 		mov	r2, r3, lsr #24
 498              	.LVL40:
 499              		.loc 1 284 0
 500 002c 2338A0E1 		mov	r3, r3, lsr #16
 501              	.LVL41:
 502              		.loc 1 285 0
 503 0030 0020C0E5 		strb	r2, [r0, #0]
 286:calypso/dsp.c **** 			*(mcu_buf++) = w;
 504              		.loc 1 286 0
 505 0034 0130C0E5 		strb	r3, [r0, #1]
 506 0038 020080E2 		add	r0, r0, #2
 507              	.LVL42:
 508              	.L41:
 509              	.LBE5:
 510              		.loc 1 283 0
 511 003c 0E005CE1 		cmp	ip, lr
 512 0040 01C08CE2 		add	ip, ip, #1
 513 0044 060000BA 		blt	.L42
 287:calypso/dsp.c **** 		}
 288:calypso/dsp.c **** 		if (odd)
 514              		.loc 1 288 0
 515 0048 000054E3 		cmp	r4, #0
 289:calypso/dsp.c **** 			*mcu_buf = *(dsp_buf++) >> 8;
 516              		.loc 1 289 0
 517 004c B030D111 		ldrneh	r3, [r1, #0]
 518              	.LVL43:
 519 0050 2334A011 		movne	r3, r3, lsr #8
 520              		.loc 1 288 0
 521 0054 1080BD08 		ldmeqfd	sp!, {r4, pc}
 522 0058 1F0000EA 		b	.L50
 523              	.LVL44:
 524              	.L46:
 525              	.LBB6:
 290:calypso/dsp.c **** 	} else {
 291:calypso/dsp.c **** 		for (i=0; i<n; i++) {
 292:calypso/dsp.c **** 			uint16_t w = *(dsp_buf++);
 526              		.loc 1 292 0
 527 005c B220D1E0 		ldrh	r2, [r1], #2
 528              	.LVL45:
 293:calypso/dsp.c **** 			*(mcu_buf++) = w;
 294:calypso/dsp.c **** 			*(mcu_buf++) = w >> 8;
 529              		.loc 1 294 0
 530 0060 2234A0E1 		mov	r3, r2, lsr #8
 531              	.LVL46:
 532 0064 0130C0E5 		strb	r3, [r0, #1]
 533              		.loc 1 293 0
 534 0068 0220C0E4 		strb	r2, [r0], #2
 535              	.LVL47:
 536              	.L40:
 537              	.LVL48:
 538              	.LBE6:
 539              		.loc 1 291 0
 540 006c 0E005CE1 		cmp	ip, lr
 541 0070 01C08CE2 		add	ip, ip, #1
 542 0074 150000BA 		blt	.L46
 295:calypso/dsp.c **** 		}
 296:calypso/dsp.c **** 		if (odd)
 543              		.loc 1 296 0
 544 0078 000054E3 		cmp	r4, #0
 545 007c 1080BD08 		ldmeqfd	sp!, {r4, pc}
 297:calypso/dsp.c **** 			*mcu_buf = *(dsp_buf++);
 546              		.loc 1 297 0
 547 0080 B030D1E1 		ldrh	r3, [r1, #0]
 548              	.LVL49:
 549              	.L50:
 550 0084 0030C0E5 		strb	r3, [r0, #0]
 551 0088 1080BDE8 		ldmfd	sp!, {r4, pc}
 552              	.LFE23:
 554              		.section	.text.dsp_end_scenario,"ax",%progbits
 555              		.align	2
 556              		.global	dsp_end_scenario
 558              	dsp_end_scenario:
 559              	.LFB29:
 298:calypso/dsp.c **** 	}
 299:calypso/dsp.c **** }
 300:calypso/dsp.c **** 
 301:calypso/dsp.c **** static void dsp_audio_init(void)
 302:calypso/dsp.c **** {
 303:calypso/dsp.c **** 	T_NDB_MCU_DSP *ndb = dsp_api.ndb;
 304:calypso/dsp.c **** 	uint8_t i;
 305:calypso/dsp.c **** 
 306:calypso/dsp.c **** 	ndb->d_vbctrl1  = ABB_VAL_T(VBCTRL1, 0x00B); 	/* VULSWITCH=0, VDLAUX=1, VDLEAR=1 */
 307:calypso/dsp.c **** 	ndb->d_vbctrl2	= ABB_VAL_T(VBCTRL2, 0x000); 	/* MICBIASEL=0, VDLHSO=0, MICAUX=0 */
 308:calypso/dsp.c **** 
 309:calypso/dsp.c **** 	/*
 310:calypso/dsp.c **** 	 * TODO: the following two settings are used to control
 311:calypso/dsp.c **** 	 * the volume and uplink/downlink/sidetone gain. Make them
 312:calypso/dsp.c **** 	 * adjustable by the user.
 313:calypso/dsp.c **** 	 */
 314:calypso/dsp.c **** 
 315:calypso/dsp.c **** 	ndb->d_vbuctrl	= ABB_VAL_T(VBUCTRL, 0x009);	/* Uplink gain amp 3dB, Sidetone gain -5dB */
 316:calypso/dsp.c **** 	ndb->d_vbdctrl	= ABB_VAL_T(VBDCTRL, 0x066);	/* Downlink gain amp 0dB, Volume control -6 dB */
 317:calypso/dsp.c **** 
 318:calypso/dsp.c **** 	ndb->d_toneskb_init = 0;			/* MCU/DSP audio task com. register */
 319:calypso/dsp.c **** 	ndb->d_toneskb_status = 0;			/* MCU/DSP audio task com. register */
 320:calypso/dsp.c **** 
 321:calypso/dsp.c **** 	ndb->d_shiftul = 0x100;
 322:calypso/dsp.c **** 	ndb->d_shiftdl = 0x100;
 323:calypso/dsp.c **** 
 324:calypso/dsp.c **** 	ndb->d_melo_osc_used    = 0;
 325:calypso/dsp.c **** 	ndb->d_melo_osc_active  = 0;
 326:calypso/dsp.c **** 
 327:calypso/dsp.c **** #define SC_END_OSCILLATOR_MASK        0xfffe
 328:calypso/dsp.c **** 
 329:calypso/dsp.c **** 	ndb->a_melo_note0[0] = SC_END_OSCILLATOR_MASK;
 330:calypso/dsp.c **** 	ndb->a_melo_note1[0] = SC_END_OSCILLATOR_MASK;
 331:calypso/dsp.c **** 	ndb->a_melo_note2[0] = SC_END_OSCILLATOR_MASK;
 332:calypso/dsp.c **** 	ndb->a_melo_note3[0] = SC_END_OSCILLATOR_MASK;
 333:calypso/dsp.c **** 	ndb->a_melo_note4[0] = SC_END_OSCILLATOR_MASK;
 334:calypso/dsp.c **** 	ndb->a_melo_note5[0] = SC_END_OSCILLATOR_MASK;
 335:calypso/dsp.c **** 	ndb->a_melo_note6[0] = SC_END_OSCILLATOR_MASK;
 336:calypso/dsp.c **** 	ndb->a_melo_note7[0] = SC_END_OSCILLATOR_MASK;
 337:calypso/dsp.c **** 
 338:calypso/dsp.c **** #define MAX_FIR_COEF  31
 339:calypso/dsp.c **** 
 340:calypso/dsp.c **** 	/* Initialize the FIR as an all band pass */
 341:calypso/dsp.c **** 	dsp_api.param->a_fir31_downlink[0] = 0x4000;
 342:calypso/dsp.c **** 	dsp_api.param->a_fir31_uplink[0]   = 0x4000;
 343:calypso/dsp.c **** 	for (i = 1; i < MAX_FIR_COEF; i++)
 344:calypso/dsp.c **** 	{
 345:calypso/dsp.c **** 		dsp_api.param->a_fir31_downlink[i]  = 0;
 346:calypso/dsp.c **** 		dsp_api.param->a_fir31_uplink[i]    = 0;
 347:calypso/dsp.c **** 	}
 348:calypso/dsp.c **** 
 349:calypso/dsp.c **** #define B_GSM_ONLY	((1L <<  13) | (1L <<  11))	/* GSM normal mode */
 350:calypso/dsp.c **** #define B_BT_CORDLESS	(1L <<  12)			/* Bluetooth cordless mode */
 351:calypso/dsp.c **** #define B_BT_HEADSET	(1L <<  14)			/* Bluetooth headset mode */
 352:calypso/dsp.c **** 
 353:calypso/dsp.c **** 		/* Bit set by the MCU to close the loop between the audio UL and DL path. */
 354:calypso/dsp.c **** 		/* This features is used to find the FIR coefficient. */
 355:calypso/dsp.c **** #define B_FIR_LOOP	(1L <<  1)
 356:calypso/dsp.c **** 
 357:calypso/dsp.c **** 	/* Reset the FIR loopback and the audio mode */
 358:calypso/dsp.c **** 	ndb->d_audio_init &= ~(B_FIR_LOOP | B_GSM_ONLY | B_BT_HEADSET | B_BT_CORDLESS);
 359:calypso/dsp.c **** 
 360:calypso/dsp.c **** 	/* Set the GSM mode  */
 361:calypso/dsp.c **** 	ndb->d_audio_init |= (B_GSM_ONLY);
 362:calypso/dsp.c **** 
 363:calypso/dsp.c **** 	ndb->d_aec_ctrl = 0;
 364:calypso/dsp.c **** 
 365:calypso/dsp.c **** 	/* DSP background task through pending task queue */
 366:calypso/dsp.c **** 	dsp_api.param->d_gsm_bgd_mgt = 0;
 367:calypso/dsp.c **** 
 368:calypso/dsp.c **** 	ndb->d_audio_compressor_ctrl = 0x0401;
 369:calypso/dsp.c **** 
 370:calypso/dsp.c **** #define NO_MELODY_SELECTED    (0)
 371:calypso/dsp.c **** 
 372:calypso/dsp.c **** 	ndb->d_melody_selection = NO_MELODY_SELECTED;
 373:calypso/dsp.c **** }
 374:calypso/dsp.c **** 
 375:calypso/dsp.c **** static void dsp_ndb_init(void)
 376:calypso/dsp.c **** {
 377:calypso/dsp.c **** 	T_NDB_MCU_DSP *ndb = dsp_api.ndb;
 378:calypso/dsp.c **** 	uint8_t i;
 379:calypso/dsp.c **** 
 380:calypso/dsp.c **** 	#define APCDEL_DOWN     (2+0)   // minimum value: 2
 381:calypso/dsp.c **** 	#define APCDEL_UP       (6+3+1) // minimum value: 6
 382:calypso/dsp.c **** 
 383:calypso/dsp.c **** 	/* load APC ramp: set to "no ramp" so that there will be no output if
 384:calypso/dsp.c **** 	 * not properly initialised at some other place. */
 385:calypso/dsp.c **** 	for (i = 0; i < 16; i++)
 386:calypso/dsp.c **** 		dsp_api.ndb->a_ramp[i] = ABB_VAL(APCRAM, ABB_RAMP_VAL(0, 0));
 387:calypso/dsp.c **** 
 388:calypso/dsp.c **** 	/* Iota registers values will be programmed at 1st DSP communication interrupt */
 389:calypso/dsp.c **** 
 390:calypso/dsp.c **** 	/* Enable f_tx delay of 400000 cyc DEBUG */
 391:calypso/dsp.c **** 	ndb->d_debug1 	= ABB_VAL_T(0, 0x000);
 392:calypso/dsp.c **** 	ndb->d_afcctladd= ABB_VAL_T(AFCCTLADD, 0x000);  // Value at reset
 393:calypso/dsp.c **** 	ndb->d_vbuctrl	= ABB_VAL_T(VBUCTRL, 0x0C9);	// Uplink gain amp 0dB, Sidetone gain to mute
 394:calypso/dsp.c **** 	ndb->d_vbdctrl	= ABB_VAL_T(VBDCTRL, 0x006);	// Downlink gain amp 0dB, Volume control 0 dB
 395:calypso/dsp.c **** 	ndb->d_bbctrl	= ABB_VAL_T(BBCTRL,  0x2C1);	// value at reset
 396:calypso/dsp.c **** 	ndb->d_bulgcal	= ABB_VAL_T(BULGCAL, 0x000);	// value at reset
 397:calypso/dsp.c **** 	ndb->d_apcoff	= ABB_VAL_T(APCOFF,  0x040);	// value at reset
 398:calypso/dsp.c **** 	ndb->d_bulioff	= ABB_VAL_T(BULIOFF, 0x0FF);	// value at reset
 399:calypso/dsp.c **** 	ndb->d_bulqoff	= ABB_VAL_T(BULQOFF, 0x0FF);	// value at reset
 400:calypso/dsp.c **** 	ndb->d_dai_onoff= ABB_VAL_T(APCOFF,  0x000);	// value at reset
 401:calypso/dsp.c **** 	ndb->d_auxdac	= ABB_VAL_T(AUXDAC,  0x000);	// value at reset
 402:calypso/dsp.c **** 	ndb->d_vbctrl1  = ABB_VAL_T(VBCTRL1, 0x00B); 	// VULSWITCH=0, VDLAUX=1, VDLEAR=1.
 403:calypso/dsp.c **** 	ndb->d_vbctrl2	= ABB_VAL_T(VBCTRL2, 0x000); 	// MICBIASEL=0, VDLHSO=0, MICAUX=0
 404:calypso/dsp.c **** 
 405:calypso/dsp.c **** 	/* APCDEL will be initialized on rach only */
 406:calypso/dsp.c **** 	ndb->d_apcdel1	= ABB_VAL_T(APCDEL1, ((APCDEL_DOWN-2) << 5) | (APCDEL_UP-6));
 407:calypso/dsp.c **** 	ndb->d_apcdel2	= ABB_VAL_T(APCDEL2, 0x000);
 408:calypso/dsp.c **** 
 409:calypso/dsp.c **** 	ndb->d_fb_mode	= 1;		/* mode 1 FCCH burst detection */
 410:calypso/dsp.c **** 	ndb->d_fb_det	= 0;		/* we have not yet detected a FB */
 411:calypso/dsp.c **** 	ndb->a_cd[0]	= (1<<B_FIRE1);	/* CCCH/SACCH downlink */
 412:calypso/dsp.c **** 	ndb->a_dd_0[0]	= 0;
 413:calypso/dsp.c **** 	ndb->a_dd_0[2]	= 0xffff;
 414:calypso/dsp.c **** 	ndb->a_dd_1[0]	= 0;
 415:calypso/dsp.c **** 	ndb->a_dd_1[2]	= 0xffff;
 416:calypso/dsp.c **** 	ndb->a_du_0[0]	= 0;
 417:calypso/dsp.c **** 	ndb->a_du_0[2]	= 0xffff;
 418:calypso/dsp.c **** 	ndb->a_du_1[0]	= 0;
 419:calypso/dsp.c **** 	ndb->a_du_1[2]	= 0xffff;
 420:calypso/dsp.c **** 	ndb->a_fd[0]	= (1<<B_FIRE1);
 421:calypso/dsp.c **** 	ndb->a_fd[2]	= 0xffff;
 422:calypso/dsp.c **** 	ndb->d_a5mode	= 0;
 423:calypso/dsp.c **** 	ndb->d_tch_mode	= 0x0800; /* Set ABB model to Iota */
 424:calypso/dsp.c **** 
 425:calypso/dsp.c **** 	#define GUARD_BITS 8 // 11 or 9 for TSM30, 7 for Freerunner
 426:calypso/dsp.c **** 	ndb->d_tch_mode |= (((GUARD_BITS - 4) & 0x000F) << 7); //Bit 7..10: guard bits
 427:calypso/dsp.c **** 
 428:calypso/dsp.c **** 	ndb->a_sch26[0]	= (1<<B_SCH_CRC);
 429:calypso/dsp.c **** 
 430:calypso/dsp.c **** 	/* Interrupt RIF transmit if FIFO <= threshold with threshold == 0 */
 431:calypso/dsp.c **** 	/* MCM = 1, XRST = 0, CLKX_AUTO=1, TXM=1, NCLK_EN=1, NCLK13_EN=1,
 432:calypso/dsp.c **** 	 * THRESHOLD = 0, DIV_CLK = 0 (13MHz) */
 433:calypso/dsp.c **** 	ndb->d_spcx_rif	= 0x179;
 434:calypso/dsp.c **** 
 435:calypso/dsp.c **** 	/* Init audio related parameters */
 436:calypso/dsp.c **** 	dsp_audio_init();
 437:calypso/dsp.c **** }
 438:calypso/dsp.c **** 
 439:calypso/dsp.c **** static void dsp_db_init(void)
 440:calypso/dsp.c **** {
 441:calypso/dsp.c **** 	dsp_api_memset((uint16_t *)BASE_API_W_PAGE_0, sizeof(T_DB_MCU_TO_DSP));
 442:calypso/dsp.c **** 	dsp_api_memset((uint16_t *)BASE_API_W_PAGE_1, sizeof(T_DB_MCU_TO_DSP));
 443:calypso/dsp.c **** 	dsp_api_memset((uint16_t *)BASE_API_R_PAGE_0, sizeof(T_DB_DSP_TO_MCU));
 444:calypso/dsp.c **** 	dsp_api_memset((uint16_t *)BASE_API_R_PAGE_1, sizeof(T_DB_DSP_TO_MCU));
 445:calypso/dsp.c **** }
 446:calypso/dsp.c **** 
 447:calypso/dsp.c **** void dsp_power_on(void)
 448:calypso/dsp.c **** {
 449:calypso/dsp.c **** 	/* probably a good idea to initialize the whole API area to a known value */
 450:calypso/dsp.c **** 	dsp_api_memset((uint16_t *)BASE_API_RAM, API_SIZE * 2); // size is in words
 451:calypso/dsp.c **** 
 452:calypso/dsp.c **** 	dsp_set_params((int16_t *)&dsp_params, sizeof(dsp_params)/2);
 453:calypso/dsp.c **** 	dsp_ndb_init();
 454:calypso/dsp.c **** 	dsp_db_init();
 455:calypso/dsp.c **** 	dsp_api.frame_ctr = 0;
 456:calypso/dsp.c **** 	dsp_api.r_page = dsp_api.w_page = dsp_api.r_page_used = 0;
 457:calypso/dsp.c **** }
 458:calypso/dsp.c **** 
 459:calypso/dsp.c **** /* test for frequency burst detection */
 460:calypso/dsp.c **** #define REG_INT_STAT 0xffff1004
 461:calypso/dsp.c **** static void wait_for_frame_irq(void)
 462:calypso/dsp.c **** {
 463:calypso/dsp.c **** 	//puts("Waiting for Frame Interrupt");
 464:calypso/dsp.c **** 	//while (readb(REG_INT_STAT) & 1)
 465:calypso/dsp.c **** 	while (readb((void *)0xffff1000) & (1<<4))
 466:calypso/dsp.c **** 	;//	putchar('.');
 467:calypso/dsp.c **** 	//puts("Done!\n");
 468:calypso/dsp.c **** }
 469:calypso/dsp.c **** 
 470:calypso/dsp.c **** void dsp_end_scenario(void)
 471:calypso/dsp.c **** {
 560              		.loc 1 471 0
 561              		@ args = 0, pretend = 0, frame = 0
 562              		@ frame_needed = 0, uses_anonymous_args = 0
 563              	.LVL50:
 564 0000 04E02DE5 		str	lr, [sp, #-4]!
 565              	.LCFI4:
 472:calypso/dsp.c **** 	/* FIXME: we don't yet deal with the MISC_TASK */
 473:calypso/dsp.c **** 
 474:calypso/dsp.c **** 	/* End the DSP Scenario */
 475:calypso/dsp.c **** 	dsp_api.ndb->d_dsp_page = B_GSM_TASK | dsp_api.w_page;
 566              		.loc 1 475 0
 567 0004 28109FE5 		ldr	r1, .L53
 568 0008 143091E5 		ldr	r3, [r1, #20]
 569 000c 000091E5 		ldr	r0, [r1, #0]
 570 0010 022083E3 		orr	r2, r3, #2
 476:calypso/dsp.c **** 	dsp_api.w_page ^= 1;
 571              		.loc 1 476 0
 572 0014 013023E2 		eor	r3, r3, #1
 573              		.loc 1 475 0
 574 0018 B020C0E1 		strh	r2, [r0, #0]	@ movhi
 575              		.loc 1 476 0
 576 001c 143081E5 		str	r3, [r1, #20]
 477:calypso/dsp.c **** 
 478:calypso/dsp.c **** 	/* Tell TPU to generate a FRAME interrupt to the DSP */
 479:calypso/dsp.c **** 	tpu_dsp_frameirq_enable();
 577              		.loc 1 479 0
 578 0020 FEFFFFEB 		bl	tpu_dsp_frameirq_enable
 480:calypso/dsp.c **** 	tpu_frame_irq_en(1, 1);
 579              		.loc 1 480 0
 580 0024 0100A0E3 		mov	r0, #1
 581 0028 0010A0E1 		mov	r1, r0
 481:calypso/dsp.c **** }
 582              		.loc 1 481 0
 583 002c 04E09DE4 		ldr	lr, [sp], #4
 584              		.loc 1 480 0
 585 0030 FEFFFFEA 		b	tpu_frame_irq_en
 586              	.L54:
 587              		.align	2
 588              	.L53:
 589 0034 00000000 		.word	dsp_api
 590              	.LFE29:
 592              		.section	.text.dsp_load_rx_task,"ax",%progbits
 593              		.align	2
 594              		.global	dsp_load_rx_task
 596              	dsp_load_rx_task:
 597              	.LFB30:
 482:calypso/dsp.c **** 
 483:calypso/dsp.c **** void dsp_load_rx_task(uint16_t task, uint8_t burst_id, uint8_t tsc)
 484:calypso/dsp.c **** {
 598              		.loc 1 484 0
 599              		@ args = 0, pretend = 0, frame = 0
 600              		@ frame_needed = 0, uses_anonymous_args = 0
 601              		@ link register save eliminated.
 602              	.LVL51:
 485:calypso/dsp.c **** 	dsp_api.db_w->d_task_d = task;
 603              		.loc 1 485 0
 604 0000 20309FE5 		ldr	r3, .L57
 605 0004 08C093E5 		ldr	ip, [r3, #8]
 486:calypso/dsp.c **** 	dsp_api.db_w->d_burst_d = burst_id;
 487:calypso/dsp.c **** 	dsp_api.db_w->d_ctrl_system |= tsc & 0x7;
 606              		.loc 1 487 0
 607 0008 B032DCE1 		ldrh	r3, [ip, #32]
 608 000c 072002E2 		and	r2, r2, #7
 609              	.LVL52:
 610 0010 023083E1 		orr	r3, r3, r2
 611              		.loc 1 484 0
 612 0014 FF1001E2 		and	r1, r1, #255
 613              		@ lr needed for prologue
 614              		.loc 1 487 0
 615 0018 B032CCE1 		strh	r3, [ip, #32]	@ movhi
 616              		.loc 1 485 0
 617 001c B000CCE1 		strh	r0, [ip, #0]	@ movhi
 618              		.loc 1 486 0
 619 0020 B210CCE1 		strh	r1, [ip, #2]	@ movhi
 488:calypso/dsp.c **** }
 620              		.loc 1 488 0
 621 0024 1EFF2FE1 		bx	lr
 622              	.L58:
 623              		.align	2
 624              	.L57:
 625 0028 00000000 		.word	dsp_api
 626              	.LFE30:
 628              		.section	.text.dsp_load_tx_task,"ax",%progbits
 629              		.align	2
 630              		.global	dsp_load_tx_task
 632              	dsp_load_tx_task:
 633              	.LFB31:
 489:calypso/dsp.c **** 
 490:calypso/dsp.c **** void dsp_load_tx_task(uint16_t task, uint8_t burst_id, uint8_t tsc)
 491:calypso/dsp.c **** {
 634              		.loc 1 491 0
 635              		@ args = 0, pretend = 0, frame = 0
 636              		@ frame_needed = 0, uses_anonymous_args = 0
 637              		@ link register save eliminated.
 638              	.LVL53:
 492:calypso/dsp.c **** 	dsp_api.db_w->d_task_u = task;
 639              		.loc 1 492 0
 640 0000 20309FE5 		ldr	r3, .L61
 641 0004 08C093E5 		ldr	ip, [r3, #8]
 493:calypso/dsp.c **** 	dsp_api.db_w->d_burst_u = burst_id;
 494:calypso/dsp.c **** 	dsp_api.db_w->d_ctrl_system |= tsc & 0x7;
 642              		.loc 1 494 0
 643 0008 B032DCE1 		ldrh	r3, [ip, #32]
 644 000c 072002E2 		and	r2, r2, #7
 645              	.LVL54:
 646 0010 023083E1 		orr	r3, r3, r2
 647              		.loc 1 491 0
 648 0014 FF1001E2 		and	r1, r1, #255
 649              		@ lr needed for prologue
 650              		.loc 1 494 0
 651 0018 B032CCE1 		strh	r3, [ip, #32]	@ movhi
 652              		.loc 1 492 0
 653 001c B400CCE1 		strh	r0, [ip, #4]	@ movhi
 654              		.loc 1 493 0
 655 0020 B610CCE1 		strh	r1, [ip, #6]	@ movhi
 495:calypso/dsp.c **** }
 656              		.loc 1 495 0
 657 0024 1EFF2FE1 		bx	lr
 658              	.L62:
 659              		.align	2
 660              	.L61:
 661 0028 00000000 		.word	dsp_api
 662              	.LFE31:
 664              		.global	__umodsi3
 665              		.section	.text.dsp_load_tch_param,"ax",%progbits
 666              		.align	2
 667              		.global	dsp_load_tch_param
 669              	dsp_load_tch_param:
 670              	.LFB32:
 496:calypso/dsp.c **** 
 497:calypso/dsp.c **** /* no AMR yet */
 498:calypso/dsp.c **** void dsp_load_tch_param(struct gsm_time *next_time,
 499:calypso/dsp.c ****                         uint8_t chan_mode, uint8_t chan_type, uint8_t chan_sub,
 500:calypso/dsp.c ****                         uint8_t tch_loop, uint8_t sync_tch, uint8_t tn)
 501:calypso/dsp.c **** {
 671              		.loc 1 501 0
 672              		@ args = 12, pretend = 0, frame = 0
 673              		@ frame_needed = 0, uses_anonymous_args = 0
 674              	.LVL55:
 675 0000 F0402DE9 		stmfd	sp!, {r4, r5, r6, r7, lr}
 676              	.LCFI5:
 677              		.loc 1 501 0
 678 0004 01C0A0E1 		mov	ip, r1
 679 0008 FFE002E2 		and	lr, r2, #255
 680 000c FFC00CE2 		and	ip, ip, #255
 681 0010 FF4003E2 		and	r4, r3, #255
 682 0014 1820DDE5 		ldrb	r2, [sp, #24]	@ zero_extendqisi2
 683              	.LVL56:
 502:calypso/dsp.c **** 	uint16_t d_ctrl_tch;
 503:calypso/dsp.c **** 	uint16_t fn, a5fn0, a5fn1;
 504:calypso/dsp.c **** 
 505:calypso/dsp.c **** 	/* d_ctrl_tch
 506:calypso/dsp.c **** 	   ----------
 507:calypso/dsp.c **** 	    bit [0..3]   -> b_chan_mode
 508:calypso/dsp.c **** 	    bit [4..7]   -> b_chan_type
 509:calypso/dsp.c **** 	    bit [8]      -> b_sync_tch_ul
 510:calypso/dsp.c **** 	    bit [9]      -> b_sync_tch_dl
 511:calypso/dsp.c **** 	    bit [10]     -> b_stop_tch_ul
 512:calypso/dsp.c **** 	    bit [11]     -> b_stop_tch_dl
 513:calypso/dsp.c **** 	    bit [12..14] -> b_tch_loop
 514:calypso/dsp.c **** 	    bit [15]     -> b_subchannel */
 515:calypso/dsp.c **** 	d_ctrl_tch = (chan_mode  << B_CHAN_MODE) |
 684              		.loc 1 515 0
 685 0018 0EC28CE1 		orr	ip, ip, lr, asl #4
 686 001c 84C78CE1 		orr	ip, ip, r4, asl #15
 687              		.loc 1 501 0
 688 0020 1430DDE5 		ldrb	r3, [sp, #20]	@ zero_extendqisi2
 689              	.LVL57:
 690              		.loc 1 515 0
 691 0024 02C48CE1 		orr	ip, ip, r2, asl #8
 692 0028 82C48CE1 		orr	ip, ip, r2, asl #9
 693 002c 03C68CE1 		orr	ip, ip, r3, asl #12
 694              		.loc 1 501 0
 695 0030 1C309DE5 		ldr	r3, [sp, #28]
 696              		.loc 1 515 0
 697 0034 0CC8A0E1 		mov	ip, ip, asl #16
 516:calypso/dsp.c **** 		     (chan_type  << B_CHAN_TYPE)  |
 517:calypso/dsp.c **** 		     (chan_sub   << B_SUBCHANNEL) |
 518:calypso/dsp.c **** 		     (sync_tch   << B_SYNC_TCH_UL) |
 519:calypso/dsp.c **** 		     (sync_tch   << B_SYNC_TCH_DL) |
 520:calypso/dsp.c **** 		     (tch_loop   << B_TCH_LOOP);
 521:calypso/dsp.c **** 
 522:calypso/dsp.c **** 	/* used for ciphering and TCH traffic */
 523:calypso/dsp.c **** 
 524:calypso/dsp.c **** 	/* d_fn
 525:calypso/dsp.c **** 	   ----
 526:calypso/dsp.c **** 
 527:calypso/dsp.c **** 	   for TCH_F:
 528:calypso/dsp.c **** 	     bit [0..7]  -> b_fn_report = (fn - (tn * 13) + 104) % 104)
 529:calypso/dsp.c **** 	     bit [8..15] -> b_fn_sid    = (fn % 104)
 530:calypso/dsp.c **** 
 531:calypso/dsp.c **** 	   for TCH_H:
 532:calypso/dsp.c **** 	                    tn_report = (tn & ~1) | subchannel
 533:calypso/dsp.c **** 	     bit [0..7]  -> b_fn_report = (fn - tn_report * 13) + 104) % 104)
 534:calypso/dsp.c **** 	     bit [8..15] -> b_fn_sid    = (fn % 104)
 535:calypso/dsp.c **** 
 536:calypso/dsp.c **** 	   for other: irrelevant
 537:calypso/dsp.c **** 	 */
 538:calypso/dsp.c **** 
 539:calypso/dsp.c **** 	if (chan_type == TCH_F) {
 698              		.loc 1 539 0
 699 0038 01005EE3 		cmp	lr, #1
 700              		.loc 1 501 0
 701 003c 0060A0E1 		mov	r6, r0
 540:calypso/dsp.c **** 		fn = ((next_time->fn - (tn * 13) + 104) % 104) |
 702              		.loc 1 540 0
 703 0040 6810A0E3 		mov	r1, #104
 704              	.LVL58:
 705              		.loc 1 515 0
 706 0044 2C78A0E1 		mov	r7, ip, lsr #16
 707              	.LVL59:
 708              		.loc 1 501 0
 709 0048 FF0003E2 		and	r0, r3, #255
 710              	.LVL60:
 711              		.loc 1 539 0
 712 004c 1800001A 		bne	.L64
 713              	.LVL61:
 714              		.loc 1 540 0
 715 0050 0D30A0E3 		mov	r3, #13
 716 0054 930000E0 		mul	r0, r3, r0
 717              	.LVL62:
 718 0058 005096E5 		ldr	r5, [r6, #0]
 719 005c 050060E0 		rsb	r0, r0, r5
 720 0060 010080E0 		add	r0, r0, r1
 721 0064 230000EA 		b	.L70
 722              	.LVL63:
 723              	.L64:
 724              	.LBB7:
 541:calypso/dsp.c **** 		     ((next_time->fn % 104) << 8);
 542:calypso/dsp.c **** 	} else if (chan_type == TCH_H) {
 543:calypso/dsp.c **** 		uint8_t tn_report = (tn & ~1) | chan_sub;
 544:calypso/dsp.c **** 		fn = ((next_time->fn - (tn_report * 13) + 104) % 104) |
 725              		.loc 1 544 0
 726 0068 FE3003E2 		and	r3, r3, #254
 727              	.LBE7:
 728              		.loc 1 542 0
 729 006c 02005EE3 		cmp	lr, #2
 730              	.LBB8:
 731              		.loc 1 544 0
 732 0070 040083E1 		orr	r0, r3, r4
 733              	.LVL64:
 734 0074 6810A0E3 		mov	r1, #104
 735              	.LBE8:
 736              		.loc 1 542 0
 737 0078 0040A0E3 		mov	r4, #0
 738              	.LVL65:
 739 007c 2B00001A 		bne	.L66
 740              	.LBB9:
 741              		.loc 1 544 0
 742 0080 0D30A0E3 		mov	r3, #13
 743 0084 930000E0 		mul	r0, r3, r0
 744 0088 005096E5 		ldr	r5, [r6, #0]
 745 008c 050060E0 		rsb	r0, r0, r5
 746 0090 680080E2 		add	r0, r0, #104
 747              	.LVL66:
 748              	.L70:
 749 0094 FEFFFFEB 		bl	__umodsi3
 750              	.LVL67:
 751 0098 6810A0E3 		mov	r1, #104
 752 009c 0040A0E1 		mov	r4, r0
 753              	.LVL68:
 754 00a0 0500A0E1 		mov	r0, r5
 755 00a4 FEFFFFEB 		bl	__umodsi3
 756 00a8 004484E1 		orr	r4, r4, r0, asl #8
 757 00ac 0448A0E1 		mov	r4, r4, asl #16
 758 00b0 2448A0E1 		mov	r4, r4, lsr #16
 759              	.LVL69:
 760              	.L66:
 761              	.LBE9:
 545:calypso/dsp.c **** 		     ((next_time->fn % 104) << 8);
 546:calypso/dsp.c **** 	} else {
 547:calypso/dsp.c **** 		/* irrelevant */
 548:calypso/dsp.c **** 		fn = 0;
 549:calypso/dsp.c **** 	}
 550:calypso/dsp.c **** 
 551:calypso/dsp.c **** 	/* a_a5fn
 552:calypso/dsp.c **** 	   ------
 553:calypso/dsp.c **** 	     byte[0] bit [0..4]  -> T2
 554:calypso/dsp.c **** 	     byte[0] bit [5..10] -> T3
 555:calypso/dsp.c **** 	     byte[1] bit [0..10] -> T1 */
 556:calypso/dsp.c **** 
 557:calypso/dsp.c **** 	a5fn0 = ((uint16_t)next_time->t3 << 5) |
 558:calypso/dsp.c **** 	         (uint16_t)next_time->t2;
 559:calypso/dsp.c **** 	a5fn1 =  (uint16_t)next_time->t1;
 560:calypso/dsp.c **** 
 561:calypso/dsp.c **** 	dsp_api.db_w->d_fn        = fn;         /* Fn_sid & Fn_report  */
 762              		.loc 1 561 0
 763 00b4 24309FE5 		ldr	r3, .L71
 764              		.loc 1 557 0
 765 00b8 0710D6E5 		ldrb	r1, [r6, #7]	@ zero_extendqisi2
 766 00bc 0620D6E5 		ldrb	r2, [r6, #6]	@ zero_extendqisi2
 767              		.loc 1 559 0
 768 00c0 B400D6E1 		ldrh	r0, [r6, #4]
 769              	.LVL70:
 770              		.loc 1 561 0
 771 00c4 083093E5 		ldr	r3, [r3, #8]
 772              		.loc 1 557 0
 773 00c8 812282E1 		orr	r2, r2, r1, asl #5
 774              	.LVL71:
 562:calypso/dsp.c **** 	dsp_api.db_w->a_a5fn[0]   = a5fn0;      /* ciphering FN part 1 */
 563:calypso/dsp.c **** 	dsp_api.db_w->a_a5fn[1]   = a5fn1;      /* ciphering FN part 2 */
 564:calypso/dsp.c **** 	dsp_api.db_w->d_ctrl_tch  = d_ctrl_tch; /* Channel config.     */
 775              		.loc 1 564 0
 776 00cc B271C3E1 		strh	r7, [r3, #18]	@ movhi
 777              		.loc 1 561 0
 778 00d0 B041C3E1 		strh	r4, [r3, #16]	@ movhi
 779              		.loc 1 562 0
 780 00d4 B821C3E1 		strh	r2, [r3, #24]	@ movhi
 781              		.loc 1 563 0
 782 00d8 BA01C3E1 		strh	r0, [r3, #26]	@ movhi
 565:calypso/dsp.c **** }
 783              		.loc 1 565 0
 784 00dc F080BDE8 		ldmfd	sp!, {r4, r5, r6, r7, pc}
 785              	.L72:
 786              		.align	2
 787              	.L71:
 788 00e0 00000000 		.word	dsp_api
 789              	.LFE32:
 791              		.section	.rodata.str1.4
 792              		.align	2
 793              	.LC2:
 794 0040 416C676F 		.ascii	"Algo A5/%u is not supported!!!\012\000"
 794      2041352F 
 794      25752069 
 794      73206E6F 
 794      74207375 
 795              		.section	.text.dsp_load_ciph_param,"ax",%progbits
 796              		.align	2
 797              		.global	dsp_load_ciph_param
 799              	dsp_load_ciph_param:
 800              	.LFB33:
 566:calypso/dsp.c **** 
 567:calypso/dsp.c **** void dsp_load_ciph_param(int mode, uint8_t *key)
 568:calypso/dsp.c **** {
 801              		.loc 1 568 0
 802              		@ args = 0, pretend = 0, frame = 0
 803              		@ frame_needed = 0, uses_anonymous_args = 0
 804              	.LVL72:
 805 0000 70402DE9 		stmfd	sp!, {r4, r5, r6, lr}
 806              	.LCFI6:
 569:calypso/dsp.c **** 	dsp_api.ndb->d_a5mode = mode;
 807              		.loc 1 569 0
 808 0004 84609FE5 		ldr	r6, .L79
 809 0008 84309FE5 		ldr	r3, .L79+4
 810 000c 002096E5 		ldr	r2, [r6, #0]
 811              		.loc 1 568 0
 812 0010 0050A0E1 		mov	r5, r0
 570:calypso/dsp.c **** 
 571:calypso/dsp.c **** 	if (mode >= 3) /* Only A5/0, A5/1, A5/2 are supported by calypso */
 813              		.loc 1 571 0
 814 0014 020050E3 		cmp	r0, #2
 815              		.loc 1 568 0
 816 0018 0140A0E1 		mov	r4, r1
 572:calypso/dsp.c **** 		printd("Algo A5/%u is not supported!!!\n", mode);
 817              		.loc 1 572 0
 818 001c 74009FE5 		ldr	r0, .L79+8
 819              	.LVL73:
 820              		.loc 1 569 0
 821 0020 B35082E1 		strh	r5, [r2, r3]	@ movhi
 822              		.loc 1 572 0
 823 0024 0510A0E1 		mov	r1, r5
 824              	.LVL74:
 825              		.loc 1 571 0
 826              	.LVL75:
 827              		.loc 1 572 0
 828 0028 FEFFFFCB 		blgt	printf
 829              	.LVL76:
 830              	.L74:
 573:calypso/dsp.c **** 
 574:calypso/dsp.c **** 	if (!mode || !key)
 831              		.loc 1 574 0
 832 002c 000054E3 		cmp	r4, #0
 833 0030 00005513 		cmpne	r5, #0
 834 0034 7080BD08 		ldmeqfd	sp!, {r4, r5, r6, pc}
 575:calypso/dsp.c **** 		return;
 576:calypso/dsp.c **** 
 577:calypso/dsp.c **** 		/* key is expected in the same format as in RSL
 578:calypso/dsp.c **** 		 * Encryption information IE. So we need to load the
 579:calypso/dsp.c **** 		 * bytes backward in A5 unit */
 580:calypso/dsp.c **** 	dsp_api.ndb->a_kc[0] = (uint16_t)key[7] | ((uint16_t)key[6] << 8);
 835              		.loc 1 580 0
 836 0038 0630D4E5 		ldrb	r3, [r4, #6]	@ zero_extendqisi2
 837 003c 0720D4E5 		ldrb	r2, [r4, #7]	@ zero_extendqisi2
 838 0040 001096E5 		ldr	r1, [r6, #0]
 839 0044 032482E1 		orr	r2, r2, r3, asl #8
 840 0048 4C309FE5 		ldr	r3, .L79+12
 841 004c B32081E1 		strh	r2, [r1, r3]	@ movhi
 581:calypso/dsp.c **** 	dsp_api.ndb->a_kc[1] = (uint16_t)key[5] | ((uint16_t)key[4] << 8);
 842              		.loc 1 581 0
 843 0050 0420D4E5 		ldrb	r2, [r4, #4]	@ zero_extendqisi2
 844 0054 0530D4E5 		ldrb	r3, [r4, #5]	@ zero_extendqisi2
 845 0058 023483E1 		orr	r3, r3, r2, asl #8
 846 005c 2D2EA0E3 		mov	r2, #720
 847 0060 B23081E1 		strh	r3, [r1, r2]	@ movhi
 582:calypso/dsp.c **** 	dsp_api.ndb->a_kc[2] = (uint16_t)key[3] | ((uint16_t)key[2] << 8);
 848              		.loc 1 582 0
 849 0064 0220D4E5 		ldrb	r2, [r4, #2]	@ zero_extendqisi2
 850 0068 0330D4E5 		ldrb	r3, [r4, #3]	@ zero_extendqisi2
 851 006c 023483E1 		orr	r3, r3, r2, asl #8
 852 0070 28209FE5 		ldr	r2, .L79+16
 853 0074 B23081E1 		strh	r3, [r1, r2]	@ movhi
 583:calypso/dsp.c **** 	dsp_api.ndb->a_kc[3] = (uint16_t)key[1] | ((uint16_t)key[0] << 8);
 854              		.loc 1 583 0
 855 0078 0020D4E5 		ldrb	r2, [r4, #0]	@ zero_extendqisi2
 856 007c 0130D4E5 		ldrb	r3, [r4, #1]	@ zero_extendqisi2
 857 0080 023483E1 		orr	r3, r3, r2, asl #8
 858 0084 B52FA0E3 		mov	r2, #724
 859 0088 B23081E1 		strh	r3, [r1, r2]	@ movhi
 860 008c 7080BDE8 		ldmfd	sp!, {r4, r5, r6, pc}
 861              	.L80:
 862              		.align	2
 863              	.L79:
 864 0090 00000000 		.word	dsp_api
 865 0094 CE010000 		.word	462
 866 0098 40000000 		.word	.LC2
 867 009c CE020000 		.word	718
 868 00a0 D2020000 		.word	722
 869              	.LFE33:
 871              		.section	.rodata.str1.4
 872              		.align	2
 873              	.LC3:
 874 0060 64737020 		.ascii	"dsp page          : %u\012\000"
 874      70616765 
 874      20202020 
 874      20202020 
 874      20203A20 
 875              		.align	2
 876              	.LC4:
 877 0078 64737020 		.ascii	"dsp code version  : 0x%04x\012\000"
 877      636F6465 
 877      20766572 
 877      73696F6E 
 877      20203A20 
 878              		.align	2
 879              	.LC5:
 880 0094 64737020 		.ascii	"dsp checksum      : 0x%04x\012\000"
 880      63686563 
 880      6B73756D 
 880      20202020 
 880      20203A20 
 881              		.align	2
 882              	.LC6:
 883 00b0 64737020 		.ascii	"dsp patch version : 0x%04x\012\000"
 883      70617463 
 883      68207665 
 883      7273696F 
 883      6E203A20 
 884              		.section	.text.dsp_dump_csum,"ax",%progbits
 885              		.align	2
 887              	dsp_dump_csum:
 888              	.LFB34:
 584:calypso/dsp.c **** }
 585:calypso/dsp.c **** 
 586:calypso/dsp.c **** #define SC_CHKSUM_VER     (BASE_API_W_PAGE_0 + (2 * (0x08DB - 0x800)))
 587:calypso/dsp.c **** static void dsp_dump_csum(void)
 588:calypso/dsp.c **** {
 889              		.loc 1 588 0
 890              		@ args = 0, pretend = 0, frame = 0
 891              		@ frame_needed = 0, uses_anonymous_args = 0
 892              	.LVL77:
 893 0000 10402DE9 		stmfd	sp!, {r4, lr}
 894              	.LCFI7:
 589:calypso/dsp.c **** 	printf("dsp page          : %u\n", dsp_api.ndb->d_dsp_page);
 895              		.loc 1 589 0
 896 0004 40409FE5 		ldr	r4, .L83
 897 0008 003094E5 		ldr	r3, [r4, #0]
 898 000c 3C009FE5 		ldr	r0, .L83+4
 899 0010 B010D3E1 		ldrh	r1, [r3, #0]
 900 0014 FEFFFFEB 		bl	printf
 590:calypso/dsp.c **** 	printf("dsp code version  : 0x%04x\n", dsp_api.db_r->a_pm[0]);
 901              		.loc 1 590 0
 902 0018 043094E5 		ldr	r3, [r4, #4]
 903 001c 30009FE5 		ldr	r0, .L83+8
 904 0020 B811D3E1 		ldrh	r1, [r3, #24]
 905 0024 FEFFFFEB 		bl	printf
 591:calypso/dsp.c **** 	printf("dsp checksum      : 0x%04x\n", dsp_api.db_r->a_pm[1]);
 906              		.loc 1 591 0
 907 0028 043094E5 		ldr	r3, [r4, #4]
 908 002c 24009FE5 		ldr	r0, .L83+12
 909 0030 BA11D3E1 		ldrh	r1, [r3, #26]
 910 0034 FEFFFFEB 		bl	printf
 592:calypso/dsp.c **** 	printf("dsp patch version : 0x%04x\n", readw(SC_CHKSUM_VER));
 911              		.loc 1 592 0
 912 0038 1C309FE5 		ldr	r3, .L83+16
 913 003c 1C009FE5 		ldr	r0, .L83+20
 914 0040 B010D3E1 		ldrh	r1, [r3, #0]
 593:calypso/dsp.c **** }
 915              		.loc 1 593 0
 916 0044 1040BDE8 		ldmfd	sp!, {r4, lr}
 917              		.loc 1 592 0
 918 0048 FEFFFFEA 		b	printf
 919              	.L84:
 920              		.align	2
 921              	.L83:
 922 004c 00000000 		.word	dsp_api
 923 0050 60000000 		.word	.LC3
 924 0054 78000000 		.word	.LC4
 925 0058 94000000 		.word	.LC5
 926 005c B601D0FF 		.word	-3145290
 927 0060 B0000000 		.word	.LC6
 928              	.LFE34:
 930              		.section	.text.dsp_checksum_task,"ax",%progbits
 931              		.align	2
 932              		.global	dsp_checksum_task
 934              	dsp_checksum_task:
 935              	.LFB35:
 594:calypso/dsp.c **** 
 595:calypso/dsp.c **** void dsp_checksum_task(void)
 596:calypso/dsp.c **** {
 936              		.loc 1 596 0
 937              		@ args = 0, pretend = 0, frame = 0
 938              		@ frame_needed = 0, uses_anonymous_args = 0
 939              	.LVL78:
 940 0000 04E02DE5 		str	lr, [sp, #-4]!
 941              	.LCFI8:
 597:calypso/dsp.c **** 	dsp_dump_csum();
 942              		.loc 1 597 0
 943 0004 FEFFFFEB 		bl	dsp_dump_csum
 598:calypso/dsp.c **** 	dsp_api.db_w->d_task_md = CHECKSUM_DSP_TASK;
 944              		.loc 1 598 0
 945 0008 30309FE5 		ldr	r3, .L91
 599:calypso/dsp.c **** 	dsp_api.ndb->d_fb_mode = 1;
 946              		.loc 1 599 0
 947 000c 002093E5 		ldr	r2, [r3, #0]
 948              		.loc 1 598 0
 949 0010 083093E5 		ldr	r3, [r3, #8]
 950 0014 2110A0E3 		mov	r1, #33	@ movhi
 951 0018 B810C3E1 		strh	r1, [r3, #8]	@ movhi
 952              		.loc 1 599 0
 953 001c 0130A0E3 		mov	r3, #1	@ movhi
 954 0020 BA34C2E1 		strh	r3, [r2, #74]	@ movhi
 600:calypso/dsp.c **** 
 601:calypso/dsp.c **** 	dsp_end_scenario();
 955              		.loc 1 601 0
 956 0024 FEFFFFEB 		bl	dsp_end_scenario
 957              	.L86:
 958              	.LBB10:
 959              	.LBB11:
 960              		.loc 1 465 0
 961 0028 14309FE5 		ldr	r3, .L91+4
 962 002c 0030D3E5 		ldrb	r3, [r3, #0]	@ zero_extendqisi2
 963 0030 100013E3 		tst	r3, #16
 964 0034 0800001A 		bne	.L86
 965              	.LBE11:
 966              	.LBE10:
 602:calypso/dsp.c **** 
 603:calypso/dsp.c **** 	wait_for_frame_irq();
 604:calypso/dsp.c **** 
 605:calypso/dsp.c **** 	dsp_dump_csum();
 606:calypso/dsp.c **** }
 967              		.loc 1 606 0
 968 0038 04E09DE4 		ldr	lr, [sp], #4
 969              		.loc 1 605 0
 970 003c FEFFFFEA 		b	dsp_dump_csum
 971              	.L92:
 972              		.align	2
 973              	.L91:
 974 0040 00000000 		.word	dsp_api
 975 0044 0010FFFF 		.word	-61440
 976              	.LFE35:
 978              		.section	.text.dsp_load_apc_dac,"ax",%progbits
 979              		.align	2
 980              		.global	dsp_load_apc_dac
 982              	dsp_load_apc_dac:
 983              	.LFB36:
 607:calypso/dsp.c **** 
 608:calypso/dsp.c **** #define L1D_AUXAPC              0x0012
 609:calypso/dsp.c **** #define L1D_APCRAM              0x0014
 610:calypso/dsp.c **** 
 611:calypso/dsp.c **** void dsp_load_apc_dac(uint16_t apc)
 612:calypso/dsp.c **** {
 984              		.loc 1 612 0
 985              		@ args = 0, pretend = 0, frame = 0
 986              		@ frame_needed = 0, uses_anonymous_args = 0
 987              		@ link register save eliminated.
 988              	.LVL79:
 613:calypso/dsp.c **** 	dsp_api.db_w->d_power_ctl = (apc << 6) | L1D_AUXAPC;
 989              		.loc 1 613 0
 990 0000 14309FE5 		ldr	r3, .L95
 991              		.loc 1 612 0
 992 0004 0008A0E1 		mov	r0, r0, asl #16
 993              	.LVL80:
 994              		.loc 1 613 0
 995 0008 083093E5 		ldr	r3, [r3, #8]
 996 000c 2005A0E1 		mov	r0, r0, lsr #10
 997 0010 120080E3 		orr	r0, r0, #18
 998              		.loc 1 612 0
 999              		@ lr needed for prologue
 1000              		.loc 1 613 0
 1001 0014 BC01C3E1 		strh	r0, [r3, #28]	@ movhi
 614:calypso/dsp.c **** }
 1002              		.loc 1 614 0
 1003 0018 1EFF2FE1 		bx	lr
 1004              	.L96:
 1005              		.align	2
 1006              	.L95:
 1007 001c 00000000 		.word	dsp_api
 1008              	.LFE36:
 1010              		.section	.rodata.str1.4
 1011              		.align	2
 1012              	.LC7:
 1013 00cc 41737365 		.ascii	"Assert DSP into Reset\012\000"
 1013      72742044 
 1013      53502069 
 1013      6E746F20 
 1013      52657365 
 1014 00e3 00       		.align	2
 1015              	.LC8:
 1016 00e4 4C6F6164 		.ascii	"Loading initial DSP bootcode (API boot mode)\012\000"
 1016      696E6720 
 1016      696E6974 
 1016      69616C20 
 1016      44535020 
 1017 0112 0000     		.align	2
 1018              	.LC9:
 1019 0114 52656C65 		.ascii	"Releasing DSP from Reset\012\000"
 1019      6173696E 
 1019      67204453 
 1019      50206672 
 1019      6F6D2052 
 1020              		.section	.text.dsp_pre_boot,"ax",%progbits
 1021              		.align	2
 1023              	dsp_pre_boot:
 1024              	.LFB19:
 1025              		.loc 1 178 0
 1026              		@ args = 0, pretend = 0, frame = 0
 1027              		@ frame_needed = 0, uses_anonymous_args = 0
 1028              	.LVL81:
 1029 0000 10402DE9 		stmfd	sp!, {r4, lr}
 1030              	.LCFI9:
 1031              		.loc 1 178 0
 1032 0004 0040A0E1 		mov	r4, r0
 1033              		.loc 1 179 0
 1034 0008 70009FE5 		ldr	r0, .L106
 1035              	.LVL82:
 1036 000c FEFFFFEB 		bl	puts
 1037              		.loc 1 180 0
 1038 0010 0200A0E3 		mov	r0, #2
 1039 0014 0110A0E3 		mov	r1, #1
 1040 0018 FEFFFFEB 		bl	calypso_reset_set
 1041              		.loc 1 182 0
 1042 001c 000054E3 		cmp	r4, #0
 1043 0020 1000000A 		beq	.L98
 1044              		.loc 1 183 0
 1045 0024 58009FE5 		ldr	r0, .L106+4
 1046 0028 FEFFFFEB 		bl	puts
 1047              		.loc 1 184 0
 1048 002c 0400A0E1 		mov	r0, r4
 1049 0030 0E1AA0E3 		mov	r1, #57344
 1050 0034 FEFFFFEB 		bl	dsp_upload_sections_api
 1051              		.loc 1 186 0
 1052 0038 48309FE5 		ldr	r3, .L106+8
 1053 003c 0020A0E3 		mov	r2, #0	@ movhi
 1054 0040 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1055 0044 120000EA 		b	.L100
 1056              	.L98:
 1057              		.loc 1 188 0
 1058 0048 0A00A0E3 		mov	r0, #10
 1059 004c FEFFFFEB 		bl	delay_ms
 1060              	.L100:
 1061              		.loc 1 190 0
 1062 0050 34009FE5 		ldr	r0, .L106+12
 1063 0054 FEFFFFEB 		bl	puts
 1064              		.loc 1 191 0
 1065 0058 0200A0E3 		mov	r0, #2
 1066 005c 0010A0E3 		mov	r1, #0
 1067 0060 FEFFFFEB 		bl	calypso_reset_set
 1068              		.loc 1 194 0
 1069 0064 6400A0E3 		mov	r0, #100
 1070 0068 FEFFFFEB 		bl	delay_ms
 1071              	.L101:
 1072              	.LBB12:
 1073              	.LBB13:
 1074              		.loc 1 108 0
 1075 006c 14309FE5 		ldr	r3, .L106+8
 1076 0070 B030D3E1 		ldrh	r3, [r3, #0]
 1077 0074 010053E3 		cmp	r3, #1
 1078 0078 1900001A 		bne	.L101
 1079              	.LBE13:
 1080              	.LBE12:
 1081              		.loc 1 197 0
 1082 007c 1080BDE8 		ldmfd	sp!, {r4, pc}
 1083              	.L107:
 1084              		.align	2
 1085              	.L106:
 1086 0080 CC000000 		.word	.LC7
 1087 0084 E4000000 		.word	.LC8
 1088 0088 FE0FD0FF 		.word	-3141634
 1089 008c 14010000 		.word	.LC9
 1090              	.LFE19:
 1092              		.section	.rodata.str1.4
 1093 012e 0000     		.align	2
 1094              	.LC10:
 1095 0130 52656769 		.ascii	"Registers\000"
 1095      73746572 
 1095      7300
 1096 013a 0000     		.align	2
 1097              	.LC11:
 1098 013c 44524F4D 		.ascii	"DROM\000"
 1098      00
 1099 0141 000000   		.align	2
 1100              	.LC12:
 1101 0144 5044524F 		.ascii	"PDROM\000"
 1101      4D00
 1102 014a 0000     		.align	2
 1103              	.LC13:
 1104 014c 50524F4D 		.ascii	"PROM0\000"
 1104      3000
 1105 0152 0000     		.align	2
 1106              	.LC14:
 1107 0154 50524F4D 		.ascii	"PROM1\000"
 1107      3100
 1108 015a 0000     		.align	2
 1109              	.LC15:
 1110 015c 50524F4D 		.ascii	"PROM2\000"
 1110      3200
 1111 0162 0000     		.align	2
 1112              	.LC16:
 1113 0164 50524F4D 		.ascii	"PROM3\000"
 1113      3300
 1114              		.section	.rodata
 1115              		.align	2
 1118              	dr.2465:
 1119 0018 30010000 		.word	.LC10
 1120 001c 00000000 		.word	0
 1121 0020 60000000 		.word	96
 1122 0024 03000000 		.word	3
 1123 0028 3C010000 		.word	.LC11
 1124 002c 00900000 		.word	36864
 1125 0030 00500000 		.word	20480
 1126 0034 05000000 		.word	5
 1127 0038 44010000 		.word	.LC12
 1128 003c 00E00000 		.word	57344
 1129 0040 00200000 		.word	8192
 1130 0044 05000000 		.word	5
 1131 0048 4C010000 		.word	.LC13
 1132 004c 00700000 		.word	28672
 1133 0050 00700000 		.word	28672
 1134 0054 04000000 		.word	4
 1135 0058 54010000 		.word	.LC14
 1136 005c 00800100 		.word	98304
 1137 0060 00800000 		.word	32768
 1138 0064 04000000 		.word	4
 1139 0068 5C010000 		.word	.LC15
 1140 006c 00800200 		.word	163840
 1141 0070 00800000 		.word	32768
 1142 0074 04000000 		.word	4
 1143 0078 64010000 		.word	.LC16
 1144 007c 00800300 		.word	229376
 1145 0080 00200000 		.word	8192
 1146 0084 04000000 		.word	4
 1147 0088 00000000 		.word	0
 1148 008c 00000000 		.word	0
 1149 0090 00000000 		.word	0
 1150 0094 FFFFFFFF 		.word	-1
 1151              		.section	.rodata.str1.4
 1152 016a 0000     		.align	2
 1153              	.LC17:
 1154 016c 44535020 		.ascii	"DSP bootloader version 0x%04x\012\000"
 1154      626F6F74 
 1154      6C6F6164 
 1154      65722076 
 1154      65727369 
 1155 018b 00       		.align	2
 1156              	.LC18:
 1157 018c 44535020 		.ascii	"DSP dump: %s [%05lx-%05lx]\012\000"
 1157      64756D70 
 1157      3A202573 
 1157      205B2530 
 1157      356C782D 
 1158              		.align	2
 1159              	.LC19:
 1160 01a8 2530356C 		.ascii	"%05lx : \000"
 1160      78203A20 
 1160      00
 1161 01b1 000000   		.align	2
 1162              	.LC20:
 1163 01b4 25303468 		.ascii	"%04hx%c\000"
 1163      78256300 
 1164              		.align	2
 1165              	.LC21:
 1166 01bc 0A00     		.ascii	"\012\000"
 1167              		.section	.text.dsp_dump,"ax",%progbits
 1168              		.align	2
 1169              		.global	dsp_dump
 1171              	dsp_dump:
 1172              	.LFB38:
 615:calypso/dsp.c **** 
 616:calypso/dsp.c **** 
 617:calypso/dsp.c **** static void _dsp_dump_range(uint32_t addr, uint32_t size, int mode)
 618:calypso/dsp.c **** {
 619:calypso/dsp.c **** 	uint32_t bs;
 620:calypso/dsp.c **** 
 621:calypso/dsp.c **** 	/* Mode selection */
 622:calypso/dsp.c **** 	writew(mode, BASE_API_RAM);
 623:calypso/dsp.c **** 	writew(BL_CMD_COPY_MODE, BL_CMD_STATUS);
 624:calypso/dsp.c **** 	dsp_bl_wait_ready();
 625:calypso/dsp.c **** 
 626:calypso/dsp.c **** 	/* Block by block dump */
 627:calypso/dsp.c **** 	while (size) {
 628:calypso/dsp.c **** 		volatile uint16_t *api = (volatile uint16_t *)BASE_API_RAM;
 629:calypso/dsp.c **** 
 630:calypso/dsp.c **** 		bs = (size > BL_MAX_BLOCK_SIZE) ? BL_MAX_BLOCK_SIZE : size;
 631:calypso/dsp.c **** 		size -= bs;
 632:calypso/dsp.c **** 
 633:calypso/dsp.c **** 		writew(addr >> 16, BL_ADDR_HI);
 634:calypso/dsp.c **** 		writew(addr & 0xffff, BL_ADDR_LO);
 635:calypso/dsp.c **** 		writew(bs, BL_SIZE);
 636:calypso/dsp.c **** 		writew(BL_CMD_COPY_BLOCK, BL_CMD_STATUS);
 637:calypso/dsp.c **** 
 638:calypso/dsp.c **** 		dsp_bl_wait_ready();
 639:calypso/dsp.c **** 
 640:calypso/dsp.c **** 		while (bs--) {
 641:calypso/dsp.c **** 			/* FIXME workaround: small delay to prevent overflowing
 642:calypso/dsp.c **** 			 * the sercomm buffer */
 643:calypso/dsp.c **** 			delay_ms(2);
 644:calypso/dsp.c **** 			if ((addr&15)==0)
 645:calypso/dsp.c **** 				printf("%05lx : ", addr);
 646:calypso/dsp.c **** 			printf("%04hx%c", *api++, ((addr&15)==15)?'\n':' ');
 647:calypso/dsp.c **** 			addr++;
 648:calypso/dsp.c **** 		}
 649:calypso/dsp.c **** 	};
 650:calypso/dsp.c **** 	puts("\n");
 651:calypso/dsp.c **** }
 652:calypso/dsp.c **** 
 653:calypso/dsp.c **** void dsp_dump(void)
 654:calypso/dsp.c **** {
 1173              		.loc 1 654 0
 1174              		@ args = 0, pretend = 0, frame = 0
 1175              		@ frame_needed = 0, uses_anonymous_args = 0
 1176              	.LVL83:
 1177 0000 F0472DE9 		stmfd	sp!, {r4, r5, r6, r7, r8, r9, sl, lr}
 1178              	.LCFI10:
 655:calypso/dsp.c **** 	static const struct {
 656:calypso/dsp.c **** 		const char *name;
 657:calypso/dsp.c **** 		uint32_t addr;
 658:calypso/dsp.c **** 		uint32_t size;
 659:calypso/dsp.c **** 		int mode;
 660:calypso/dsp.c **** 	} dr[] = {
 661:calypso/dsp.c **** 		{ "Registers",	0x00000, 0x0060, BL_MODE_DATA_READ },
 662:calypso/dsp.c **** 		{ "DROM",	0x09000, 0x5000, BL_MODE_DROM_READ },
 663:calypso/dsp.c **** 		{ "PDROM",	0x0e000, 0x2000, BL_MODE_DROM_READ },
 664:calypso/dsp.c **** 		{ "PROM0",	0x07000, 0x7000, BL_MODE_PROM_READ },
 665:calypso/dsp.c **** 		{ "PROM1",	0x18000, 0x8000, BL_MODE_PROM_READ },
 666:calypso/dsp.c **** 		{ "PROM2",	0x28000, 0x8000, BL_MODE_PROM_READ },
 667:calypso/dsp.c **** 		{ "PROM3",	0x38000, 0x2000, BL_MODE_PROM_READ },
 668:calypso/dsp.c **** 		{ NULL, 0, 0, -1 }
 669:calypso/dsp.c **** 	};
 670:calypso/dsp.c **** 
 671:calypso/dsp.c **** 	int i;
 672:calypso/dsp.c **** 
 673:calypso/dsp.c **** 	/* Start DSP up to bootloader */
 674:calypso/dsp.c **** 	dsp_pre_boot(dsp_bootcode);
 1179              		.loc 1 674 0
 1180 0004 98319FE5 		ldr	r3, .L139
 1181 0008 000093E5 		ldr	r0, [r3, #0]
 1182 000c FEFFFFEB 		bl	dsp_pre_boot
 675:calypso/dsp.c **** 
 676:calypso/dsp.c **** 	/* Load and execute our dump code in the DSP */
 677:calypso/dsp.c **** 	dsp_upload_sections_api(dsp_dumpcode, DSP_BASE_API);
 1183              		.loc 1 677 0
 1184 0010 90019FE5 		ldr	r0, .L139+4
 1185 0014 021BA0E3 		mov	r1, #2048
 1186 0018 FEFFFFEB 		bl	dsp_upload_sections_api
 1187              	.LBB14:
 1188              	.LBB15:
 1189              		.loc 1 113 0
 1190 001c 88319FE5 		ldr	r3, .L139+8
 1191 0020 0020A0E3 		mov	r2, #0	@ movhi
 1192 0024 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1193              		.loc 1 114 0
 1194 0028 043083E2 		add	r3, r3, #4
 1195 002c 012AA0E3 		mov	r2, #4096	@ movhi
 1196 0030 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1197              		.loc 1 115 0
 1198 0034 023043E2 		sub	r3, r3, #2
 1199 0038 0020A0E3 		mov	r2, #0	@ movhi
 1200 003c B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1201              		.loc 1 116 0
 1202 0040 043083E2 		add	r3, r3, #4
 1203 0044 0220A0E3 		mov	r2, #2	@ movhi
 1204 0048 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1205              	.L109:
 1206              	.LBE15:
 1207              	.LBE14:
 1208              	.LBB16:
 1209              	.LBB17:
 1210              		.loc 1 108 0
 1211 004c 5C219FE5 		ldr	r2, .L139+12
 1212 0050 B030D2E1 		ldrh	r3, [r2, #0]
 1213 0054 010053E3 		cmp	r3, #1
 1214 0058 1100001A 		bne	.L109
 1215              	.LBE17:
 1216              	.LBE16:
 678:calypso/dsp.c **** 	dsp_bl_start_at(DSP_DUMPCODE_START);
 679:calypso/dsp.c **** 
 680:calypso/dsp.c **** 		/* our dump code actually simulates the boot loader
 681:calypso/dsp.c **** 		 * but with added read commands */
 682:calypso/dsp.c **** 	dsp_bl_wait_ready();
 683:calypso/dsp.c **** 
 684:calypso/dsp.c **** 	/* Test the 'version' command */
 685:calypso/dsp.c **** 	writew(0xffff, BL_CMD_STATUS);
 1217              		.loc 1 685 0
 1218 005c 0030E0E3 		mvn	r3, #0	@ movhi
 1219 0060 B030C2E1 		strh	r3, [r2, #0]	@ movhi
 1220              	.L111:
 1221              	.LBB18:
 1222              	.LBB19:
 1223              		.loc 1 108 0
 1224 0064 44319FE5 		ldr	r3, .L139+12
 1225 0068 B030D3E1 		ldrh	r3, [r3, #0]
 1226 006c 010053E3 		cmp	r3, #1
 1227 0070 1700001A 		bne	.L111
 1228              	.LBE19:
 1229              	.LBE18:
 686:calypso/dsp.c **** 	dsp_bl_wait_ready();
 687:calypso/dsp.c **** 	printf("DSP bootloader version 0x%04x\n", readw(BASE_API_RAM));
 1230              		.loc 1 687 0
 1231 0074 38319FE5 		ldr	r3, .L139+16
 1232 0078 38019FE5 		ldr	r0, .L139+20
 1233 007c B010D3E1 		ldrh	r1, [r3, #0]
 1234 0080 FEFFFFEB 		bl	printf
 1235 0084 30A19FE5 		ldr	sl, .L139+24
 1236 0088 630000EA 		b	.L113
 1237              	.LVL84:
 1238              	.L114:
 688:calypso/dsp.c **** 
 689:calypso/dsp.c **** 	/* Dump each range */
 690:calypso/dsp.c **** 	for (i=0; dr[i].name; i++) {
 691:calypso/dsp.c **** 		printf("DSP dump: %s [%05lx-%05lx]\n", dr[i].name,
 1239              		.loc 1 691 0
 1240              	.LVL85:
 1241 008c 30009AE9 		ldmib	sl, {r4, r5}	@ phole ldm
 1242 0090 053084E0 		add	r3, r4, r5
 1243 0094 013043E2 		sub	r3, r3, #1
 1244 0098 0420A0E1 		mov	r2, r4
 1245 009c 1C019FE5 		ldr	r0, .L139+28
 1246 00a0 FEFFFFEB 		bl	printf
 1247              	.LBB20:
 1248              	.LBB21:
 1249              		.loc 1 622 0
 1250 00a4 BC20DAE1 		ldrh	r2, [sl, #12]
 1251 00a8 04319FE5 		ldr	r3, .L139+16
 1252 00ac B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1253              		.loc 1 623 0
 1254 00b0 F8309FE5 		ldr	r3, .L139+12
 1255 00b4 0420A0E3 		mov	r2, #4	@ movhi
 1256 00b8 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1257              	.LBE21:
 1258              	.LBE20:
 692:calypso/dsp.c **** 			dr[i].addr, dr[i].addr+dr[i].size-1);
 693:calypso/dsp.c **** 		_dsp_dump_range(dr[i].addr, dr[i].size, dr[i].mode);
 1259              		.loc 1 693 0
 1260 00bc 0460A0E1 		mov	r6, r4
 1261 00c0 0580A0E1 		mov	r8, r5
 1262              	.L115:
 1263              	.LBB22:
 1264              	.LBB23:
 1265              	.LBB24:
 1266              	.LBB25:
 1267              		.loc 1 108 0
 1268 00c4 E4309FE5 		ldr	r3, .L139+12
 1269 00c8 B030D3E1 		ldrh	r3, [r3, #0]
 1270 00cc 010053E3 		cmp	r3, #1
 1271 00d0 5E00000A 		beq	.L138
 1272 00d4 2F0000EA 		b	.L115
 1273              	.LVL86:
 1274              	.L117:
 1275              	.LBE25:
 1276              	.LBE24:
 1277              	.LBB26:
 1278              		.loc 1 633 0
 1279 00d8 CC309FE5 		ldr	r3, .L139+8
 1280              		.loc 1 630 0
 1281 00dc 7F0E58E3 		cmp	r8, #2032
 1282 00e0 0870A031 		movcc	r7, r8
 1283 00e4 7F7EA023 		movcs	r7, #2032
 1284              		.loc 1 634 0
 1285 00e8 0628A0E1 		mov	r2, r6, asl #16
 1286              		.loc 1 633 0
 1287 00ec 2618A0E1 		mov	r1, r6, lsr #16
 1288 00f0 B010C3E1 		strh	r1, [r3, #0]	@ movhi
 1289              		.loc 1 634 0
 1290 00f4 2228A0E1 		mov	r2, r2, lsr #16
 1291 00f8 043083E2 		add	r3, r3, #4
 1292              		.loc 1 635 0
 1293 00fc 0708A0E1 		mov	r0, r7, asl #16
 1294              		.loc 1 634 0
 1295 0100 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1296              		.loc 1 635 0
 1297 0104 2008A0E1 		mov	r0, r0, lsr #16
 1298 0108 023043E2 		sub	r3, r3, #2
 1299 010c B000C3E1 		strh	r0, [r3, #0]	@ movhi
 1300              		.loc 1 636 0
 1301 0110 0220A0E3 		mov	r2, #2	@ movhi
 1302 0114 043083E2 		add	r3, r3, #4
 1303 0118 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1304              		.loc 1 631 0
 1305 011c 088067E0 		rsb	r8, r7, r8
 1306              	.L118:
 1307              	.LBB27:
 1308              	.LBB28:
 1309              		.loc 1 108 0
 1310 0120 88309FE5 		ldr	r3, .L139+12
 1311 0124 B030D3E1 		ldrh	r3, [r3, #0]
 1312 0128 010053E3 		cmp	r3, #1
 1313 012c 4600001A 		bne	.L118
 1314 0130 7C909FE5 		ldr	r9, .L139+16
 1315 0134 0640A0E1 		mov	r4, r6
 1316 0138 590000EA 		b	.L120
 1317              	.L121:
 1318              	.LBE28:
 1319              	.LBE27:
 1320              		.loc 1 643 0
 1321 013c FEFFFFEB 		bl	delay_ms
 1322              		.loc 1 644 0
 1323 0140 0F5014E2 		ands	r5, r4, #15
 1324              		.loc 1 645 0
 1325 0144 0410A0E1 		mov	r1, r4
 1326 0148 74009FE5 		ldr	r0, .L139+32
 1327              		.loc 1 647 0
 1328 014c 014084E2 		add	r4, r4, #1
 1329              		.loc 1 644 0
 1330              		.loc 1 645 0
 1331 0150 FEFFFF0B 		bleq	printf
 1332              	.LVL87:
 1333              	.L122:
 1334              		.loc 1 646 0
 1335 0154 0F0055E3 		cmp	r5, #15
 1336 0158 B210D9E0 		ldrh	r1, [r9], #2
 1337 015c 2020A013 		movne	r2, #32
 1338 0160 0A20A003 		moveq	r2, #10
 1339 0164 5C009FE5 		ldr	r0, .L139+36
 1340 0168 FEFFFFEB 		bl	printf
 1341              	.L120:
 1342              		.loc 1 640 0
 1343 016c 073086E0 		add	r3, r6, r7
 1344 0170 030054E1 		cmp	r4, r3
 1345              		.loc 1 643 0
 1346 0174 0200A0E3 		mov	r0, #2
 1347              		.loc 1 640 0
 1348 0178 4D00001A 		bne	.L121
 1349 017c 0460A0E1 		mov	r6, r4
 1350              	.L138:
 1351              	.LBE26:
 1352              		.loc 1 627 0
 1353 0180 000058E3 		cmp	r8, #0
 1354 0184 3400001A 		bne	.L117
 1355              		.loc 1 650 0
 1356 0188 3C009FE5 		ldr	r0, .L139+40
 1357 018c FEFFFFEB 		bl	puts
 1358 0190 10A08AE2 		add	sl, sl, #16
 1359              	.L113:
 1360              	.LBE23:
 1361              	.LBE22:
 1362              		.loc 1 690 0
 1363 0194 00109AE5 		ldr	r1, [sl, #0]
 1364 0198 000051E3 		cmp	r1, #0
 1365 019c 2100001A 		bne	.L114
 694:calypso/dsp.c **** 	}
 695:calypso/dsp.c **** }
 1366              		.loc 1 695 0
 1367 01a0 F087BDE8 		ldmfd	sp!, {r4, r5, r6, r7, r8, r9, sl, pc}
 1368              	.L140:
 1369              		.align	2
 1370              	.L139:
 1371 01a4 00000000 		.word	dsp_bootcode
 1372 01a8 00000000 		.word	dsp_dumpcode
 1373 01ac F80FD0FF 		.word	-3141640
 1374 01b0 FE0FD0FF 		.word	-3141634
 1375 01b4 0000D0FF 		.word	-3145728
 1376 01b8 6C010000 		.word	.LC17
 1377 01bc 18000000 		.word	dr.2465
 1378 01c0 8C010000 		.word	.LC18
 1379 01c4 A8010000 		.word	.LC19
 1380 01c8 B4010000 		.word	.LC20
 1381 01cc BC010000 		.word	.LC21
 1382              	.LFE38:
 1384              		.section	.rodata.str1.4
 1385 01be 0000     		.align	2
 1386              	.LC22:
 1387 01c0 53657474 		.ascii	"Setting some dsp_api.ndb values\012\000"
 1387      696E6720 
 1387      736F6D65 
 1387      20647370 
 1387      5F617069 
 1388 01e1 000000   		.align	2
 1389              	.LC23:
 1390 01e4 53657474 		.ascii	"Setting API NDB parameters\012\000"
 1390      696E6720 
 1390      41504920 
 1390      4E444220 
 1390      70617261 
 1391              		.align	2
 1392              	.LC24:
 1393 0200 46696E69 		.ascii	"Finishing download phase\012\000"
 1393      7368696E 
 1393      6720646F 
 1393      776E6C6F 
 1393      61642070 
 1394 021a 0000     		.section	.text.dsp_power_on,"ax",%progbits
 1395              		.align	2
 1396              		.global	dsp_power_on
 1398              	dsp_power_on:
 1399              	.LFB27:
 1400              		.loc 1 448 0
 1401              		@ args = 0, pretend = 0, frame = 0
 1402              		@ frame_needed = 0, uses_anonymous_args = 0
 1403              	.LVL88:
 1404 0000 10402DE9 		stmfd	sp!, {r4, lr}
 1405              	.LCFI11:
 1406              		.loc 1 450 0
 1407 0004 0119A0E3 		mov	r1, #16384
 1408 0008 FC029FE5 		ldr	r0, .L155
 1409 000c FEFFFFEB 		bl	dsp_api_memset
 1410              	.LBB29:
 1411              	.LBB30:
 1412              		.loc 1 205 0
 1413 0010 F8329FE5 		ldr	r3, .L155+4
 1414 0014 000093E5 		ldr	r0, [r3, #0]
 1415 0018 FEFFFFEB 		bl	dsp_pre_boot
 1416              		.loc 1 209 0
 1417 001c F0029FE5 		ldr	r0, .L155+8
 1418 0020 FEFFFFEB 		bl	puts
 1419              		.loc 1 210 0
 1420 0024 EC329FE5 		ldr	r3, .L155+12
 1421 0028 003093E5 		ldr	r3, [r3, #0]
 1422 002c 0000A0E3 		mov	r0, #0	@ movhi
 1423 0030 5B2FA0E3 		mov	r2, #364
 1424 0034 B20083E1 		strh	r0, [r3, r2]	@ movhi
 1425              		.loc 1 211 0
 1426 0038 022082E2 		add	r2, r2, #2
 1427 003c B20083E1 		strh	r0, [r3, r2]	@ movhi
 1428              		.loc 1 212 0
 1429 0040 022082E2 		add	r2, r2, #2
 1430 0044 B20083E1 		strh	r0, [r3, r2]	@ movhi
 1431              		.loc 1 216 0
 1432 0048 3A2BE0E3 		mvn	r2, #59392
 1433 004c B621C3E1 		strh	r2, [r3, #22]	@ movhi
 1434              		.loc 1 222 0
 1435 0050 C4229FE5 		ldr	r2, .L155+16
 1436              		.loc 1 223 0
 1437 0054 051AA0E3 		mov	r1, #20480	@ movhi
 1438              		.loc 1 222 0
 1439 0058 B229C3E1 		strh	r2, [r3, #146]	@ movhi
 1440              		.loc 1 223 0
 1441 005c B419C3E1 		strh	r1, [r3, #148]	@ movhi
 1442              		.loc 1 213 0
 1443 0060 7420A0E3 		mov	r2, #116	@ movhi
 1444              		.loc 1 214 0
 1445 0064 0100A0E3 		mov	r0, #1	@ movhi
 1446              		.loc 1 215 0
 1447 0068 551FA0E3 		mov	r1, #340	@ movhi
 1448              		.loc 1 213 0
 1449 006c B021C3E1 		strh	r2, [r3, #16]	@ movhi
 1450              		.loc 1 214 0
 1451 0070 B201C3E1 		strh	r0, [r3, #18]	@ movhi
 1452              		.loc 1 217 0
 1453 0074 0720A0E3 		mov	r2, #7	@ movhi
 1454              		.loc 1 218 0
 1455 0078 0000A0E3 		mov	r0, #0	@ movhi
 1456              		.loc 1 215 0
 1457 007c B411C3E1 		strh	r1, [r3, #20]	@ movhi
 1458              		.loc 1 219 0
 1459 0080 0310A0E3 		mov	r1, #3	@ movhi
 1460              		.loc 1 217 0
 1461 0084 B821C3E1 		strh	r2, [r3, #24]	@ movhi
 1462              		.loc 1 218 0
 1463 0088 BA01C3E1 		strh	r0, [r3, #26]	@ movhi
 1464              		.loc 1 219 0
 1465 008c BC11C3E1 		strh	r1, [r3, #28]	@ movhi
 1466              		.loc 1 220 0
 1467 0090 BE05C3E1 		strh	r0, [r3, #94]	@ movhi
 1468              		.loc 1 221 0
 1469 0094 B006C3E1 		strh	r0, [r3, #96]	@ movhi
 1470              		.loc 1 225 0
 1471 0098 80029FE5 		ldr	r0, .L155+20
 1472 009c FEFFFFEB 		bl	puts
 1473 00a0 7C129FE5 		ldr	r1, .L155+24
 1474 00a4 7C229FE5 		ldr	r2, .L155+28
 1475              	.LVL89:
 1476              	.L142:
 1477              		.loc 1 227 0
 1478 00a8 B230D1E0 		ldrh	r3, [r1], #2
 1479 00ac B230C2E0 		strh	r3, [r2], #2	@ movhi
 1480              		.loc 1 226 0
 1481 00b0 74329FE5 		ldr	r3, .L155+32
 1482 00b4 030052E1 		cmp	r2, r3
 1483 00b8 2800001A 		bne	.L142
 1484              		.loc 1 229 0
 1485 00bc FEFFFFEB 		bl	dsp_dump_version
 1486              	.LVL90:
 1487              		.loc 1 231 0
 1488 00c0 68029FE5 		ldr	r0, .L155+36
 1489 00c4 FEFFFFEB 		bl	puts
 1490              	.LBB31:
 1491              	.LBB32:
 1492              		.loc 1 113 0
 1493 00c8 64329FE5 		ldr	r3, .L155+40
 1494 00cc 0000A0E3 		mov	r0, #0	@ movhi
 1495 00d0 B000C3E1 		strh	r0, [r3, #0]	@ movhi
 1496              		.loc 1 114 0
 1497 00d4 071AA0E3 		mov	r1, #28672	@ movhi
 1498 00d8 043083E2 		add	r3, r3, #4
 1499 00dc B010C3E1 		strh	r1, [r3, #0]	@ movhi
 1500              		.loc 1 115 0
 1501 00e0 023043E2 		sub	r3, r3, #2
 1502 00e4 B000C3E1 		strh	r0, [r3, #0]	@ movhi
 1503              		.loc 1 116 0
 1504 00e8 0220A0E3 		mov	r2, #2	@ movhi
 1505 00ec 043083E2 		add	r3, r3, #4
 1506 00f0 B020C3E1 		strh	r2, [r3, #0]	@ movhi
 1507              	.LBE32:
 1508              	.LBE31:
 1509              		.loc 1 234 0
 1510 00f4 FEFFFFEB 		bl	dsp_dump_version
 1511              	.LBE30:
 1512              	.LBE29:
 1513              	.LBB33:
 1514              	.LBB34:
 1515              		.loc 1 377 0
 1516 00f8 18329FE5 		ldr	r3, .L155+12
 1517 00fc 002093E5 		ldr	r2, [r3, #0]
 1518              	.LVL91:
 1519 0100 10C0A0E3 		mov	ip, #16
 1520 0104 0210A0E1 		mov	r1, r2
 1521              	.L144:
 1522              		.loc 1 386 0
 1523 0108 01304CE2 		sub	r3, ip, #1
 1524              		.loc 1 385 0
 1525 010c FFC013E2 		ands	ip, r3, #255
 1526              		.loc 1 386 0
 1527 0110 1400A0E3 		mov	r0, #20	@ movhi
 1528 0114 773FA0E3 		mov	r3, #476
 1529 0118 B30081E1 		strh	r0, [r1, r3]	@ movhi
 1530 011c 021081E2 		add	r1, r1, #2
 1531              		.loc 1 385 0
 1532 0120 4000001A 		bne	.L144
 1533              		.loc 1 395 0
 1534 0124 0C329FE5 		ldr	r3, .L155+44
 1535 0128 B634C2E1 		strh	r3, [r2, #70]	@ movhi
 1536              		.loc 1 397 0
 1537 012c 08329FE5 		ldr	r3, .L155+48
 1538 0130 BA33C2E1 		strh	r3, [r2, #58]	@ movhi
 1539              		.loc 1 398 0
 1540 0134 04329FE5 		ldr	r3, .L155+52
 1541 0138 BC33C2E1 		strh	r3, [r2, #60]	@ movhi
 1542              		.loc 1 399 0
 1543 013c 023083E2 		add	r3, r3, #2
 1544 0140 BE33C2E1 		strh	r3, [r2, #62]	@ movhi
 1545              		.loc 1 402 0
 1546 0144 F8319FE5 		ldr	r3, .L155+56
 1547 0148 B434C2E1 		strh	r3, [r2, #68]	@ movhi
 1548              		.loc 1 406 0
 1549 014c 733F43E2 		sub	r3, r3, #460
 1550              		.loc 1 411 0
 1551 0150 4010A0E3 		mov	r1, #64	@ movhi
 1552              		.loc 1 406 0
 1553 0154 B833C2E1 		strh	r3, [r2, #56]	@ movhi
 1554              		.loc 1 411 0
 1555 0158 F73083E2 		add	r3, r3, #247
 1556 015c B31082E1 		strh	r1, [r2, r3]	@ movhi
 1557              		.loc 1 412 0
 1558 0160 3C3083E2 		add	r3, r3, #60
 1559              		.loc 1 413 0
 1560 0164 0000E0E3 		mvn	r0, #0	@ movhi
 1561              		.loc 1 412 0
 1562 0168 B3C082E1 		strh	ip, [r2, r3]	@ movhi
 1563              		.loc 1 413 0
 1564 016c 043083E2 		add	r3, r3, #4
 1565 0170 B30082E1 		strh	r0, [r2, r3]	@ movhi
 1566              		.loc 1 414 0
 1567 0174 4D3F43E2 		sub	r3, r3, #308
 1568 0178 B3C082E1 		strh	ip, [r2, r3]	@ movhi
 1569              		.loc 1 415 0
 1570 017c 043083E2 		add	r3, r3, #4
 1571 0180 B30082E1 		strh	r0, [r2, r3]	@ movhi
 1572              		.loc 1 416 0
 1573 0184 653F83E2 		add	r3, r3, #404
 1574 0188 B3C082E1 		strh	ip, [r2, r3]	@ movhi
 1575              		.loc 1 417 0
 1576 018c 043083E2 		add	r3, r3, #4
 1577 0190 B30082E1 		strh	r0, [r2, r3]	@ movhi
 1578              		.loc 1 418 0
 1579 0194 173E43E2 		sub	r3, r3, #368
 1580 0198 B3C082E1 		strh	ip, [r2, r3]	@ movhi
 1581              		.loc 1 419 0
 1582 019c 043083E2 		add	r3, r3, #4
 1583 01a0 B30082E1 		strh	r0, [r2, r3]	@ movhi
 1584              		.loc 1 420 0
 1585 01a4 E23083E2 		add	r3, r3, #226
 1586 01a8 B31082E1 		strh	r1, [r2, r3]	@ movhi
 1587              		.loc 1 421 0
 1588 01ac 043083E2 		add	r3, r3, #4
 1589 01b0 B30082E1 		strh	r0, [r2, r3]	@ movhi
 1590              		.loc 1 422 0
 1591 01b4 503043E2 		sub	r3, r3, #80
 1592 01b8 B3C082E1 		strh	ip, [r2, r3]	@ movhi
 1593              		.loc 1 433 0
 1594 01bc 553043E2 		sub	r3, r3, #85
 1595 01c0 B430C2E1 		strh	r3, [r2, #4]	@ movhi
 1596              	.LBB35:
 1597              	.LBB36:
 1598              		.loc 1 315 0
 1599 01c4 D63083E2 		add	r3, r3, #214
 1600 01c8 B433C2E1 		strh	r3, [r2, #52]	@ movhi
 1601              		.loc 1 316 0
 1602 01cc 74319FE5 		ldr	r3, .L155+60
 1603 01d0 B633C2E1 		strh	r3, [r2, #54]	@ movhi
 1604              	.LBE36:
 1605              	.LBE35:
 1606              		.loc 1 392 0
 1607 01d4 2B30A0E3 		mov	r3, #43	@ movhi
 1608 01d8 B233C2E1 		strh	r3, [r2, #50]	@ movhi
 1609              		.loc 1 401 0
 1610 01dc 1930A0E3 		mov	r3, #25	@ movhi
 1611              		.loc 1 391 0
 1612 01e0 0110A0E3 		mov	r1, #1	@ movhi
 1613              		.loc 1 396 0
 1614 01e4 1D00A0E3 		mov	r0, #29	@ movhi
 1615              		.loc 1 401 0
 1616 01e8 B234C2E1 		strh	r3, [r2, #66]	@ movhi
 1617              		.loc 1 426 0
 1618 01ec 0A3CA0E3 		mov	r3, #2560	@ movhi
 1619              		.loc 1 391 0
 1620 01f0 B810C2E1 		strh	r1, [r2, #8]	@ movhi
 1621              		.loc 1 396 0
 1622 01f4 B003C2E1 		strh	r0, [r2, #48]	@ movhi
 1623              		.loc 1 400 0
 1624 01f8 1710A0E3 		mov	r1, #23	@ movhi
 1625              		.loc 1 407 0
 1626 01fc 3500A0E3 		mov	r0, #53	@ movhi
 1627              		.loc 1 426 0
 1628 0200 B630C2E1 		strh	r3, [r2, #6]	@ movhi
 1629              	.LBB37:
 1630              	.LBB38:
 1631              		.loc 1 341 0
 1632 0204 0C319FE5 		ldr	r3, .L155+12
 1633              	.LBE38:
 1634              	.LBE37:
 1635              		.loc 1 400 0
 1636 0208 B014C2E1 		strh	r1, [r2, #64]	@ movhi
 1637              		.loc 1 403 0
 1638 020c BE12C2E1 		strh	r1, [r2, #46]	@ movhi
 1639              		.loc 1 407 0
 1640 0210 BC02C2E1 		strh	r0, [r2, #44]	@ movhi
 1641              		.loc 1 409 0
 1642 0214 0110A0E3 		mov	r1, #1	@ movhi
 1643              		.loc 1 428 0
 1644 0218 010CA0E3 		mov	r0, #256	@ movhi
 1645              		.loc 1 409 0
 1646 021c BA14C2E1 		strh	r1, [r2, #74]	@ movhi
 1647              		.loc 1 428 0
 1648 0220 B405C2E1 		strh	r0, [r2, #84]	@ movhi
 1649              	.LBB39:
 1650              	.LBB40:
 1651              		.loc 1 321 0
 1652 0224 011CA0E3 		mov	r1, #256	@ movhi
 1653              	.LBE40:
 1654              	.LBE39:
 1655              		.loc 1 410 0
 1656 0228 B8C4C2E1 		strh	ip, [r2, #72]	@ movhi
 1657              	.LBB41:
 1658              	.LBB42:
 1659              		.loc 1 318 0
 1660 022c B8C6C2E1 		strh	ip, [r2, #104]	@ movhi
 1661              		.loc 1 319 0
 1662 0230 BAC6C2E1 		strh	ip, [r2, #106]	@ movhi
 1663              		.loc 1 341 0
 1664 0234 0C0093E5 		ldr	r0, [r3, #12]
 1665              		.loc 1 321 0
 1666 0238 BE18C2E1 		strh	r1, [r2, #142]	@ movhi
 1667              		.loc 1 329 0
 1668 023c 0130E0E3 		mvn	r3, #1	@ movhi
 1669              		.loc 1 322 0
 1670 0240 BC18C2E1 		strh	r1, [r2, #140]	@ movhi
 1671              		.loc 1 341 0
 1672 0244 0119A0E3 		mov	r1, #16384	@ movhi
 1673              		.loc 1 325 0
 1674 0248 B8C9C2E1 		strh	ip, [r2, #152]	@ movhi
 1675              		.loc 1 324 0
 1676 024c B6C9C2E1 		strh	ip, [r2, #150]	@ movhi
 1677              		.loc 1 329 0
 1678 0250 BA39C2E1 		strh	r3, [r2, #154]	@ movhi
 1679              		.loc 1 330 0
 1680 0254 B23AC2E1 		strh	r3, [r2, #162]	@ movhi
 1681              		.loc 1 331 0
 1682 0258 BA3AC2E1 		strh	r3, [r2, #170]	@ movhi
 1683              		.loc 1 332 0
 1684 025c B23BC2E1 		strh	r3, [r2, #178]	@ movhi
 1685              		.loc 1 333 0
 1686 0260 BA3BC2E1 		strh	r3, [r2, #186]	@ movhi
 1687              		.loc 1 334 0
 1688 0264 B23CC2E1 		strh	r3, [r2, #194]	@ movhi
 1689              		.loc 1 335 0
 1690 0268 BA3CC2E1 		strh	r3, [r2, #202]	@ movhi
 1691              		.loc 1 336 0
 1692 026c B23DC2E1 		strh	r3, [r2, #210]	@ movhi
 1693              		.loc 1 342 0
 1694 0270 1E40A0E3 		mov	r4, #30
 1695              		.loc 1 341 0
 1696 0274 B41EC0E1 		strh	r1, [r0, #228]	@ movhi
 1697              		.loc 1 342 0
 1698 0278 B61AC0E1 		strh	r1, [r0, #166]	@ movhi
 1699 027c 0010A0E1 		mov	r1, r0
 1700              	.L146:
 1701              		.loc 1 346 0
 1702 0280 013044E2 		sub	r3, r4, #1
 1703              		.loc 1 343 0
 1704 0284 FF4013E2 		ands	r4, r3, #255
 1705              		.loc 1 345 0
 1706 0288 0030A0E3 		mov	r3, #0	@ movhi
 1707 028c B63EC1E1 		strh	r3, [r1, #230]	@ movhi
 1708              		.loc 1 346 0
 1709 0290 B83AC1E1 		strh	r3, [r1, #168]	@ movhi
 1710 0294 021081E2 		add	r1, r1, #2
 1711              		.loc 1 343 0
 1712 0298 9E00001A 		bne	.L146
 1713              		.loc 1 361 0
 1714 029c B436D2E1 		ldrh	r3, [r2, #100]
 1715 02a0 1E3BC3E3 		bic	r3, r3, #30720
 1716 02a4 0230C3E3 		bic	r3, r3, #2
 1717 02a8 0A3B83E3 		orr	r3, r3, #10240
 1718 02ac B436C2E1 		strh	r3, [r2, #100]	@ movhi
 1719              		.loc 1 368 0
 1720 02b0 94309FE5 		ldr	r3, .L155+64
 1721              		.loc 1 363 0
 1722 02b4 B049C2E1 		strh	r4, [r2, #144]	@ movhi
 1723              	.LBE42:
 1724              	.LBE41:
 1725              	.LBE34:
 1726              	.LBE33:
 1727              	.LBB43:
 1728              		.loc 1 441 0
 1729 02b8 2410A0E3 		mov	r1, #36
 1730              	.LBE43:
 1731              	.LBB44:
 1732              	.LBB45:
 1733              	.LBB46:
 1734              	.LBB47:
 1735              		.loc 1 366 0
 1736 02bc BC49C0E1 		strh	r4, [r0, #156]	@ movhi
 1737              		.loc 1 368 0
 1738 02c0 B236C2E1 		strh	r3, [r2, #98]	@ movhi
 1739              		.loc 1 372 0
 1740 02c4 BA4DC2E1 		strh	r4, [r2, #218]	@ movhi
 1741              	.LBE47:
 1742              	.LBE46:
 1743              	.LBE45:
 1744              	.LBE44:
 1745              	.LBB48:
 1746              		.loc 1 441 0
 1747 02c8 3C009FE5 		ldr	r0, .L155
 1748 02cc FEFFFFEB 		bl	dsp_api_memset
 1749              	.LVL92:
 1750              		.loc 1 442 0
 1751 02d0 78009FE5 		ldr	r0, .L155+68
 1752 02d4 2410A0E3 		mov	r1, #36
 1753 02d8 FEFFFFEB 		bl	dsp_api_memset
 1754              		.loc 1 443 0
 1755 02dc 70009FE5 		ldr	r0, .L155+72
 1756 02e0 2810A0E3 		mov	r1, #40
 1757 02e4 FEFFFFEB 		bl	dsp_api_memset
 1758              		.loc 1 444 0
 1759 02e8 68009FE5 		ldr	r0, .L155+76
 1760 02ec 2810A0E3 		mov	r1, #40
 1761 02f0 FEFFFFEB 		bl	dsp_api_memset
 1762              	.LBE48:
 1763              		.loc 1 455 0
 1764 02f4 1C309FE5 		ldr	r3, .L155+12
 1765              		.loc 1 456 0
 1766 02f8 104083E5 		str	r4, [r3, #16]
 1767              		.loc 1 455 0
 1768 02fc 1C4083E5 		str	r4, [r3, #28]
 1769              		.loc 1 456 0
 1770 0300 184083E5 		str	r4, [r3, #24]
 1771 0304 144083E5 		str	r4, [r3, #20]
 1772              		.loc 1 457 0
 1773 0308 1080BDE8 		ldmfd	sp!, {r4, pc}
 1774              	.L156:
 1775              		.align	2
 1776              	.L155:
 1777 030c 0000D0FF 		.word	-3145728
 1778 0310 00000000 		.word	dsp_bootcode
 1779 0314 C0010000 		.word	.LC22
 1780 0318 00000000 		.word	dsp_api
 1781 031c 13520000 		.word	21011
 1782 0320 E4010000 		.word	.LC23
 1783 0324 D8000000 		.word	dsp_params
 1784 0328 6208D0FF 		.word	-3143582
 1785 032c 8609D0FF 		.word	-3143290
 1786 0330 00020000 		.word	.LC24
 1787 0334 F80FD0FF 		.word	-3141640
 1788 0338 4DB0FFFF 		.word	-20403
 1789 033c 17100000 		.word	4119
 1790 0340 C53F0000 		.word	16325
 1791 0344 D1020000 		.word	721
 1792 0348 8D190000 		.word	6541
 1793 034c 01040000 		.word	1025
 1794 0350 2800D0FF 		.word	-3145688
 1795 0354 5000D0FF 		.word	-3145648
 1796 0358 7800D0FF 		.word	-3145608
 1797              	.LFE27:
 2065              	.Letext0:
DEFINED SYMBOLS
                            *ABS*:0000000000000000 dsp.c
     /tmp/ccl20Dqi.s:15     .data:0000000000000000 dsp_api
     /tmp/ccl20Dqi.s:16     .data:0000000000000000 $d
     /tmp/ccl20Dqi.s:27     .rodata:0000000000000000 dsp_dumpcode
     /tmp/ccl20Dqi.s:28     .rodata:0000000000000000 $d
     /tmp/ccl20Dqi.s:38     .data:0000000000000020 __compound_literal.0
     /tmp/ccl20Dqi.s:132    .bss:0000000000000000 dsp_bootcode
     /tmp/ccl20Dqi.s:138    .data:00000000000000d8 dsp_params
     /tmp/ccl20Dqi.s:230    .text.dsp_dump_version:0000000000000000 dsp_dump_version
     /tmp/ccl20Dqi.s:237    .text.dsp_dump_version:0000000000000000 $a
     /tmp/ccl20Dqi.s:257    .text.dsp_dump_version:0000000000000030 $d
     /tmp/ccl20Dqi.s:266    .text.dsp_upload_sections_api:0000000000000000 dsp_upload_sections_api
     /tmp/ccl20Dqi.s:272    .text.dsp_upload_sections_api:0000000000000000 $a
     /tmp/ccl20Dqi.s:338    .text.dsp_api_memset:0000000000000000 dsp_api_memset
     /tmp/ccl20Dqi.s:345    .text.dsp_api_memset:0000000000000000 $a
     /tmp/ccl20Dqi.s:371    .text.dsp_memcpy_to_api:0000000000000000 dsp_memcpy_to_api
     /tmp/ccl20Dqi.s:378    .text.dsp_memcpy_to_api:0000000000000000 $a
     /tmp/ccl20Dqi.s:464    .text.dsp_memcpy_from_api:0000000000000000 dsp_memcpy_from_api
     /tmp/ccl20Dqi.s:471    .text.dsp_memcpy_from_api:0000000000000000 $a
     /tmp/ccl20Dqi.s:558    .text.dsp_end_scenario:0000000000000000 dsp_end_scenario
     /tmp/ccl20Dqi.s:564    .text.dsp_end_scenario:0000000000000000 $a
     /tmp/ccl20Dqi.s:589    .text.dsp_end_scenario:0000000000000034 $d
     /tmp/ccl20Dqi.s:596    .text.dsp_load_rx_task:0000000000000000 dsp_load_rx_task
     /tmp/ccl20Dqi.s:604    .text.dsp_load_rx_task:0000000000000000 $a
     /tmp/ccl20Dqi.s:625    .text.dsp_load_rx_task:0000000000000028 $d
     /tmp/ccl20Dqi.s:632    .text.dsp_load_tx_task:0000000000000000 dsp_load_tx_task
     /tmp/ccl20Dqi.s:640    .text.dsp_load_tx_task:0000000000000000 $a
     /tmp/ccl20Dqi.s:661    .text.dsp_load_tx_task:0000000000000028 $d
     /tmp/ccl20Dqi.s:669    .text.dsp_load_tch_param:0000000000000000 dsp_load_tch_param
     /tmp/ccl20Dqi.s:675    .text.dsp_load_tch_param:0000000000000000 $a
     /tmp/ccl20Dqi.s:788    .text.dsp_load_tch_param:00000000000000e0 $d
     /tmp/ccl20Dqi.s:799    .text.dsp_load_ciph_param:0000000000000000 dsp_load_ciph_param
     /tmp/ccl20Dqi.s:805    .text.dsp_load_ciph_param:0000000000000000 $a
     /tmp/ccl20Dqi.s:864    .text.dsp_load_ciph_param:0000000000000090 $d
     /tmp/ccl20Dqi.s:887    .text.dsp_dump_csum:0000000000000000 dsp_dump_csum
     /tmp/ccl20Dqi.s:893    .text.dsp_dump_csum:0000000000000000 $a
     /tmp/ccl20Dqi.s:922    .text.dsp_dump_csum:000000000000004c $d
     /tmp/ccl20Dqi.s:934    .text.dsp_checksum_task:0000000000000000 dsp_checksum_task
     /tmp/ccl20Dqi.s:940    .text.dsp_checksum_task:0000000000000000 $a
     /tmp/ccl20Dqi.s:974    .text.dsp_checksum_task:0000000000000040 $d
     /tmp/ccl20Dqi.s:982    .text.dsp_load_apc_dac:0000000000000000 dsp_load_apc_dac
     /tmp/ccl20Dqi.s:990    .text.dsp_load_apc_dac:0000000000000000 $a
     /tmp/ccl20Dqi.s:1007   .text.dsp_load_apc_dac:000000000000001c $d
     /tmp/ccl20Dqi.s:1023   .text.dsp_pre_boot:0000000000000000 dsp_pre_boot
     /tmp/ccl20Dqi.s:1029   .text.dsp_pre_boot:0000000000000000 $a
     /tmp/ccl20Dqi.s:1086   .text.dsp_pre_boot:0000000000000080 $d
     /tmp/ccl20Dqi.s:1118   .rodata:0000000000000018 dr.2465
     /tmp/ccl20Dqi.s:1171   .text.dsp_dump:0000000000000000 dsp_dump
     /tmp/ccl20Dqi.s:1177   .text.dsp_dump:0000000000000000 $a
     /tmp/ccl20Dqi.s:1371   .text.dsp_dump:00000000000001a4 $d
     /tmp/ccl20Dqi.s:1398   .text.dsp_power_on:0000000000000000 dsp_power_on
     /tmp/ccl20Dqi.s:1404   .text.dsp_power_on:0000000000000000 $a
     /tmp/ccl20Dqi.s:1777   .text.dsp_power_on:000000000000030c $d

UNDEFINED SYMBOLS
printf
tpu_dsp_frameirq_enable
tpu_frame_irq_en
__umodsi3
puts
calypso_reset_set
delay_ms
